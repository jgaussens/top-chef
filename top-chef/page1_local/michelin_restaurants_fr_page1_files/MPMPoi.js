JSEPackage("ViaMichelin.Api.Model.MPMPoi"),JSEImportApi("ViaMichelin.Api.Constants.MPMPoi"),JSEImportApi("ViaMichelin.Api.Model.AbstractObject"),JSEImportApi("ViaMichelin.Api.Util"),ViaMichelin.Api.Model.MPMPoi=function(t){this.nature="poi",this.extend(ViaMichelin.Api.Model.AbstractObject),this.update(t)},ViaMichelin.Api.Model.MPMPoi.prototype={VOUCHER_TYPE_BILL_DISCOUNT:"bill_discount",VOUCHER_TYPE_BILL_DISCOUNT_PERCENT:"percent",VOUCHER_TYPE_BILL_DISCOUNT_CURRENCY:"currency",VOUCHER_TYPE_MENU_DISCOUNT:"menu_discount",VOUCHER_TYPE_TREAT:"treat",VOUCHER_TYPE_TREAT_APERITIVE:"aperitif",VOUCHER_TYPE_TREAT_DESSERT:"dessert",VOUCHER_TYPE_TREAT_COFFEE:"coffee",VOUCHER_TYPE_TREAT_OTHER:"other",VOUCHER_TYPE_SPECIAL_MENU:"special_menu",_vouchersList:null,_defaultProvider:"AGG",update:function(t){for(var e in t)this[e]=t[e]},getId:function(){return this.poi_id},getType:function(){return this.type},getName:function(t){var e=this._getField("name",t);return null!=e?e:""},getAddress:function(t){var e=this._getField("address",t);return null!=e?e:""},getCity:function(t){var e=this._getField("city",t);return null!=e?e:""},getFormattedAddressLine:function(t){var e=this._getField("formated_address_line",t);return null!=e?e:""},getFormattedCityLine:function(t){var e=this._getField("formated_city_line",t);return null!=e?e:""},getPostcode:function(t){var e=this._getField("postcode",t);return null!=e?e:""},getURL:function(){$isDefined(ViaMichelin.Api.Constants.System.ApiGM21WebRoot)||(ViaMichelin.Api.Constants.System.ApiGM21WebRoot="http://restaurant.michelin.fr/");var t;return this.isPoiRestaurant()?t=ViaMichelin.Api.Constants.System.ApiGM21WebRoot+"/restaurant/p/v/n/"+this.getId():""},getLatitude:function(t){var e=this._getField("latitude",t);return null!=e?e:""},getLongitude:function(t){var e=this._getField("longitude",t);return null!=e?e:""},getDistanceFromPoint:function(t){var e=this.getLatitude(),i=this.getLongitude(),n=6371200,s=Math.PI/180;if(!(!$isEmpty(t)&&"lat"in t&&"lon"in t))return null;if(null===e||null===i)return null;if(t.lon==i&&t.lat==e)return 0;var r=e*s,o=i*s,a=t.lat*s,u=t.lon*s,l=Math.cos(r)*Math.cos(a)*Math.cos(u-o)+Math.sin(r)*Math.sin(a),h=n*Math.acos(l);return Math.round(h)},getDefaultPhoto:function(t){var e,i=null,n=this._getField("medias",t);if(!n)return null;for(e=0;e<n.length;e++)if("image/jpeg"==n[e].type){if(t&&n[e].provider==t)return n[e];i||(i=n[e])}return i},getObjectType:function(){return"poi"},getObjectSubType:function(){return"_"},getVouchersList:function(){return null===this._vouchersList&&this._buildVouchers(),this._vouchersList},isMichelinGuideSelection:function(t){var e=this._getField("michelin_guide_selection",t);return 1==e},isValid:function(){return $isNotEmpty(this.poi_id)&&$isNotEmpty(this.type)&&$isNotEmpty(this.datasheets)&&this.datasheets.length>0},isBookable:function(){var t=this._getField("affiliated_resa"),e=this._getField("resa_provider");return"1"===t&&"string"==typeof e&&null!==e.match(/poiId:[^|]+/)},isPoiMPM:function(){return!0},isPoiRestaurant:function(){return this.type==ViaMichelin.Api.Constants.MPMPoi.RESTAURANT},isPoiHotel:function(){return this.type==ViaMichelin.Api.Constants.MPMPoi.HOTEL},isPoiTourism:function(){return this.type==ViaMichelin.Api.Constants.MPMPoi.TOURISM},isPoiLeisure:function(){return this.type==ViaMichelin.Api.Constants.MPMPoi.LEISURE},isPoiLoisir:function(){return this.type==ViaMichelin.Api.Constants.MPMPoi.LEISURE},_buildVouchers:function(){this._vouchersList=[];var t=this._getField("vouchers");if($isNotEmpty(t)){var e,i,n,s,r,o=ViaMichelin.Api.Util.getDomObjectFromXMLString(t),a=null;for(e=o.firstChild.childNodes,i=0;i<e.length;i++)if(a=e[i],r={},a.getAttribute("id")){r.id=a.getAttribute("id");var u=a.getAttribute("type")?a.getAttribute("type"):null;if(u==this.VOUCHER_TYPE_SPECIAL_MENU||u==this.VOUCHER_TYPE_TREAT||u==this.VOUCHER_TYPE_BILL_DISCOUNT||u==this.VOUCHER_TYPE_MENU_DISCOUNT){r.type=u,a.getAttribute("start")&&(r.start=new Date(a.getAttribute("start").replaceAll("-","/")+" 00:00:00")),a.getAttribute("end")&&(r.end=new Date(a.getAttribute("end").replaceAll("-","/")+" 00:00:00")),a.getAttribute("service")&&(r.service=a.getAttribute("service")),a.getAttribute("provider")&&(r.provider=a.getAttribute("provider"));t:for(n=0;n<a.childNodes.length;n++)switch(s=a.childNodes[n],s.nodeName.toLowerCase()){case"name":r.name=s.firstChild.nodeValue;break;case"constraints":this._parseVoucherConstraints(s,r);break;case"inclusions":this._parseVoucherInclusions(s,r);break;case"exclusions":this._parseVoucherExclusions(s,r);break;default:continue t}this._vouchersList.push(r)}}}},_parseVoucherConstraints:function(t,e){var i,n;for(n=0;n<t.childNodes.length;n++)if(i=t.childNodes[n],"constraint"===i.nodeName.toLowerCase())switch(i.getAttribute("type")){case"people":e.people={},i.getAttribute("min")&&(e.people.min=Number(i.getAttribute("min"))),i.getAttribute("max")&&(e.people.max=Number(i.getAttribute("max")));break;case"couple":e.people={min:2,max:2}}},_parseVoucherInclusions:function(t,e){var i,n,s,r,o=null;for($isDefined(e.inclusions)||(e.inclusions=[]),s=0;s<t.childNodes.length;s++)if(i=t.childNodes[s],"inclusion"===i.nodeName.toLowerCase()){for(o={},r=0;r<i.childNodes.length;r++)switch(n=i.childNodes[r],n.nodeName.toLowerCase()){case"detail":o.detail=$isDefined(n.firstChild)?n.firstChild.nodeValue:""}i.getAttribute("type")&&(o.type=i.getAttribute("type")),($isDefined(o.type)||$isDefined(o.detail))&&e.inclusions.push(o)}},_parseVoucherExclusions:function(t,e){var i,n,s,r,o=null;for($isDefined(e.exclusions)||(e.exclusions=[]),s=0;s<t.childNodes.length;s++)if(i=t.childNodes[s],"exclusion"===i.nodeName.toLowerCase()){for(o={},r=0;r<i.childNodes.length;r++)switch(n=i.childNodes[r],n.nodeName.toLowerCase()){case"detail":o.detail=$isDefined(n.firstChild)?n.firstChild.nodeValue:""}i.getAttribute("type")&&(o.type=i.getAttribute("type")),($isDefined(o.type)||$isDefined(o.detail))&&e.exclusions.push(o)}},_getDatasheetByProvider:function(t){if($isDefined(this.datasheets))for(var e=0;e<this.datasheets.length;e++)if($isNotEmpty(this.datasheets[e].provider)&&("AGG"==t&&-1!=this.datasheets[e].provider.indexOf("|")||this.datasheets[e].provider==t))return this.datasheets[e];return null},_getDatasheetPropertyByProvider:function(t,e){var i=this._getDatasheetByProvider(t);return null!=i&&$isDefined(i[e])?i[e]:null},_getField:function(t,e){var i,n;if(e||(e=this._defaultProvider),i=this._getDatasheetPropertyByProvider(e,t))return i;if($isDefined(this.datasheets))for(n=0;n<this.datasheets.length;n++)if(this.datasheets[n][t])return this.datasheets[n][t];return null},toString:function(){return"[ViaMichelin.Api.Model.MPMPoi]"}};