JSEPackage("ViaMichelin.Api.Customer.NewsletterManager"),JSEImportApi("JSE.HTTP.ApiRestRequest"),JSEImportApi("JSE.HTTP.AsyncJSHTTPRequest"),JSEImportApi("ViaMichelin.Api.Util"),ViaMichelin.Api.Customer.NewsletterManager=function(e){this.prepare(),this._context=e},ViaMichelin.Api.Customer.NewsletterManager.prototype={JSEwireHub:{Error:[],NotLogged:[],EmailFormat:[],NewsletterFound:[],NewsletterCreated:[],NewsletterUpdatedOrDeleted:[]},_context:null,_jseNewsletterSearch:{JSEtype:"JSE.HTTP.ApiRestRequest",JSEwires:[{event:"responseLoaded",method:"JSEInstance._jseNewsletterSearchCallback",thisObj:"JSEInstance"},{event:"responseCancelled",method:"JSEInstance._checkErrorsCallbackCancelled",thisObj:"JSEInstance"},{event:"responseError",method:"JSEInstance._internalErrorCallback",thisObj:"JSEInstance"}]},_jseNewsletterCreate:{JSEtype:"JSE.HTTP.ApiRestRequest",JSEwires:[{event:"responseLoaded",method:"JSEInstance._jseNewsletterCreateCallback",thisObj:"JSEInstance"},{event:"responseCancelled",method:"JSEInstance._checkErrorsCallbackCancelled",thisObj:"JSEInstance"},{event:"responseError",method:"JSEInstance._internalErrorCallback",thisObj:"JSEInstance"}]},_jseNewsletterUpdateDelete:{JSEtype:"JSE.HTTP.AsyncJSHTTPRequest",JSEwires:[{event:"responseLoaded",method:"JSEInstance._jseNewsletterUpdateDeleteCallback",thisObj:"JSEInstance"},{event:"responseCancelled",method:"JSEInstance._checkErrorsCallbackCancelled",thisObj:"JSEInstance"}]},release:function(){this._jseNewsletterSearch.isolate(),this._jseNewsletterSearch.release(),this._jseNewsletterCreate.isolate(),this._jseNewsletterCreate.release(),this._jseNewsletterUpdateDelete.isolate(),this._jseNewsletterUpdateDelete.release()},searchNewsletter:function(e){this._jseNewsletterSearch.request("myvm.json/newsletter",this._buildBaseParams()+this._buildSignatureParams(e))},_jseNewsletterSearchCallback:function(e){this._checkErrorsCallback(e,"NewsletterFound")},createNewsletter:function(e){this._jseNewsletterCreate.request("myvm.json/newsletter/create",this._buildBaseParams()+this._buildNewsletterParams(e),11)},_jseNewsletterCreateCallback:function(e){this._checkErrorsCallback(e,"NewsletterCreated")},updateOrDeleteNewsletter:function(e){this._jseNewsletterUpdateDelete.request("myvm.json/newsletter/"+ViaMichelin.Api.CookieManager.getCookie("yMTC")+"/update",this._buildBaseParams()+this._buildNewsletterParams(e))},_jseNewsletterUpdateDeleteCallback:function(e){this._checkErrorsCallback(e,"NewsletterUpdatedOrDeleted")},_buildBaseParams:function(){return"context="+encodeURIComponent(this._context)+"&lang="+encodeURIComponent(ViaMichelin.Api.Constants.System.ApiRestLang)},_buildEmailParams:function(e){return"&email="+encodeURIComponent(e)},_buildSignatureParams:function(e){return"&s="+encodeURIComponent(e)},_buildNewsletterParams:function(e){var t="";return $isDefined(e.signature)&&(t+=this._buildSignatureParams(e.signature)),$isDefined(e.email)&&(t+=this._buildEmailParams(e.email)),$isDefined(e.mobility)&&(t+="&optinCarsMotoring="+encodeURIComponent(e.mobility)),$isDefined(e.travel)&&(t+="&optinTourism="+encodeURIComponent(e.travel)),$isDefined(e.gastronomy)&&(t+="&optinGastronomy="+encodeURIComponent(e.gastronomy)),$isDefined(e.partnersOffers)&&(t+="&optinPartnersOffers="+encodeURIComponent(e.partnersOffers)),$isDefined(e.origin)&&($isDefined(e.origin.device)&&(t+="&originDevice="+e.origin.device),$isDefined(e.origin.universe)&&(t+="&originUniverse="+e.origin.universe)),t},_checkErrorsCallback:function(e,t){e.error?0===e.error.errorCode?this.stimulate("NotLogged",e):1==e.error.errorCode?this.stimulate("EmailFormat",e):this.stimulate("Error",e):($isDefined(e.newsletter)&&JSE.extend(e.newsletter,JSEObject),this.stimulate(t,this._convertDates(e)))},_checkErrorsCallbackCancelled:function(e,t){this._checkErrorsCallback(t)},_internalErrorCallback:function(e){this.stimulate("Error",e)},_convertDates:function(e){return $isDefined(e.newsletter)&&this._convertNewsletterDates(e.newsletter),e},_convertNewsletterDates:function(e){$isDefined(e)&&($isDefined(e.creationDate)&&(e.creationDate=this._buildDateFromXMLString(e.creationDate)),$isDefined(e.lastUpdate)&&(e.lastUpdate=this._buildDateFromXMLString(e.lastUpdate)))},_buildDateFromArray:function(e){if(0===e.length)return null;var t=e[0],r=e[1],s=e[2];if(3==e.length)return new Date(t,r,s);var n=e[3],a=e[4],i=e[5];return new Date(t,r,s,n,a,i)},_buildDateFromXMLString:function(e){var t=e.split("T"),r=t[0].split("-"),s=r[0],n=parseInt(r[1],10)-1,a=parseInt(r[2],10),i=t[1].split(":"),l=parseInt(i[0],10),o=parseInt(i[1],10),c=parseInt(i[2],10);return new Date(s,n,a,l,o,c)}};