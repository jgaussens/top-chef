JSEPackage("ViaMichelin.Api.Util.Drawing"),JSEImportApi("JSE.HTML"),JSEImportApi("ViaMichelin.Api.Util.Color"),JSEImportApi("ViaMichelin.Api.Util.Css"),JSEImportApi("ViaMichelin.Api.Util.Browser"),JSEImportApi("ViaMichelin.Api.Util.Drawing.Canvas"),JSEImportApi("ViaMichelin.Api.Util.Drawing.SVG"),JSEImportApi("ViaMichelin.Api.Util.Drawing.VML"),ViaMichelin.Api.Util.Drawing=function(i,e,t,n){var o;ViaMichelin.Api.Util.Core.extend(this,ViaMichelin.Api.Util.Drawing.Canvas),ViaMichelin.Api.Util.Core.extend(this,ViaMichelin.Api.Util.Drawing.SVG),ViaMichelin.Api.Util.Core.extend(this,ViaMichelin.Api.Util.Drawing.VML),$isDefined(i)&&(this._container="string"==typeof i?document.getElementById(i):i);for(o in n)n.hasOwnProperty(o)&&(this._options[o]=n[o]);this._width=parseInt(e,10),this._height=parseInt(t,10),this._chooseContainer(),this._prepareContainer(),this.shapes=[];for(var r=0;e>r;r++)this.shapes[r]=new Array(t);this._addStyleForVML(".lvml { behavior: url(#default#VML); display: inline-block; position: absolute; }","lvml")},ViaMichelin.Api.Util.Drawing.prototype={_width:0,_height:0,_container:null,_canvas:null,_options:{rendering:"auto",className:null},_defaultStyle:{shadowBlur:1,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0},mouseoverElement:null,_plugEventListeners:function(i,e,t){i.expando=this,i.jsObject=t,i.onclick=e,i.onmousedown=e,i.onmouseup=e,i.onmousemove=e,i.onmouseover=e,i.onmouseout=e,i.oncontextmenu=e,i.addEventListener&&i.addEventListener("DOMMouseScroll",e,!1),i.onmousewheel=e},_addStyleForVML:function(i,e){if(ViaMichelin.Api.Util.Browser.vml){if(e&&ViaMichelin.Api.Util.Css.isDefinedSelector(e,"position","absolute"))return;var t=document.getElementsByTagName("head")[0],n=document.createElement("style");n.setAttribute("type","text/css"),n.styleSheet?n.styleSheet.cssText=i:n.appendChild(document.createTextNode(i)),t.appendChild(n)}},reportHTMLEvent:function(i){navigator.isIE&&(i=window.event);var e=i.type;"DOMMouseScroll"==i.type&&(e="mousewheel"),this.expando.stimulate("ShapeEvent_"+e,i,this.jsObject)},drawArrow:function(i,e,t){var n,o,r,s,a;s={"stroke-opacity":1,"stroke-width":3,stroke:"#000","fill-opacity":1,fill:"none","stroke-linecap":"butt","stroke-linejoin":"round"},a={"stroke-opacity":1,"stroke-width":3,stroke:"#000","fill-opacity":1,fill:"none","stroke-linecap":"butt","stroke-linejoin":"miter"},$isDefined(e)||(e={}),$isDefined(i[0][0])||$isDefined(i[0][1])||$isDefined(i[1][0])||$isDefined(i[1][1])||(i=[[0,0],[10,10]]),n=this._convertNameStyle(s),o=this._convertNameStyle(a),e=this._convertNameStyle(e),t=this._convertNameStyle(t);for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);for(r in t)t.hasOwnProperty(r)&&(o[r]=t[r]);return this["_drawArrow"+this._options.rendering](i,n,o)},drawCircle:function(i,e,t,n){var o,r,s;s={"stroke-opacity":1,"stroke-width":3,stroke:"#000","fill-opacity":1,fill:"none"},o=this._convertNameStyle(s),$isDefined(i[0])||$isDefined(i[1])||(i=[0,0]),"function"==typeof t?t=this._convertNameStyle(t(n)):($isDefined(t)||(t={}),t=this._convertNameStyle(t));for(r in t)t.hasOwnProperty(r)&&(o[r]=t[r]);return this["_drawCircle"+this._options.rendering](i,e,o,n)},drawPath:function(i,e){var t,n,o;o={"stroke-opacity":1,"stroke-width":3,stroke:"#000","fill-opacity":1,fill:"none","stroke-linecap":"butt","stroke-linejoin":"round"},$isDefined(e)||(e={}),$isDefined(i[0][0])||$isDefined(i[0][1])||(i=[[0,0]]),t=this._convertNameStyle(o),e=this._convertNameStyle(e);for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return this["_drawPath"+this._options.rendering](i,t)},drawImage:function(i,e,t,n){return this["_drawImage"+this._options.rendering](i,e,t,n)},_convertNameStyle:function(i){function e(i){return 0===i.indexOf("#")?ViaMichelin.Api.Util.Color.hexToRgb(i):ViaMichelin.Api.Util.Color.colorToRgb(i)}var t,n,o,r={};t={fill:{CANVAS:"fillStyle",VML:"fill",SVG:"fill"},"fill-opacity":{CANVAS:"fill-opacity"},stroke:{CANVAS:"strokeStyle",VML:"stroke",SVG:"stroke"},"stroke-opacity":{CANVAS:"stroke-opacity"},"stroke-width":{CANVAS:"lineWidth",VML:"stroke-width",SVG:"stroke-width"},"stroke-linejoin":{CANVAS:"lineJoin",VML:"stroke-linejoin",SVG:"stroke-linejoin"},"stroke-linecap":{CANVAS:"lineCap",VML:"stroke-linecap",SVG:"stroke-linecap"},type:{CANVAS:"type",VML:"type",SVG:"type"},"shadow-color":{CANVAS:"shadowColor",VML:"shadowColor"},"shadow-blur":{CANVAS:"shadowBlur",VML:"shadowBlur"},"shadow-offsetX":{CANVAS:"shadowOffsetX",VML:"shadowOffsetX"},"shadow-offsetY":{CANVAS:"shadowOffsetY",VML:"shadowOffsetY"}},"CANVAS"==this._options.rendering.toUpperCase()&&(i.fill&&"none"!=i.fill&&i["fill-opacity"]&&i.fill.indexOf("rgba")<0&&(o=e(i.fill),i.fill="rgba("+o.r+","+o.g+","+o.b+","+parseFloat(i["fill-opacity"])+")"),i.stroke&&"none"!=i.stroke&&i["stroke-opacity"]&&i.stroke.indexOf("rgba")<0&&(o=e(i.stroke),i.stroke="rgba("+o.r+","+o.g+","+o.b+","+parseFloat(i["stroke-opacity"])+")"));for(n in i)i.hasOwnProperty(n)&&($isDefined(t[n])?$isDefined(t[n][this._options.rendering])?r[t[n][this._options.rendering]]=i[n]:r[n]=i[n]:"CANVAS"!=this._options.rendering&&(r[n]=i[n]));return r},_chooseContainer:function(){var i=this._options.rendering.toUpperCase();"AUTO"==i?navigator.isIE?(this._options.rendering="VML",this._canvas=this._createContainerVML()):(this._options.rendering="SVG",this._canvas=this._createContainerSVG()):("VML"==i||"SVG"==i||"CANVAS"==i)&&(this._options.rendering=this._options.rendering.toUpperCase(),this._canvas=this["_createContainer"+i]()),$isDefined(this._container)&&this._container.appendChild(this._canvas)},clear:function(){var i=this._options.rendering.toUpperCase();"AUTO"==i?navigator.isIE?this._clearContainerVML():this._clearContainerSVG():("VML"==i||"SVG"==i||"CANVAS"==i)&&this["_clearContainer"+i](),this.shapes=[];for(var e=0;e<this._width;e++)this.shapes[e]=new Array(this._height)},resize:function(i){this._width=i.x,this._height=i.y,this._canvas&&(this._canvas.width=i.x,this._canvas.height=i.y,this._canvas.style.width=i.x+"px",this._canvas.style.height=i.y+"px")},_prepareContainer:function(){var i;"SVG"==this._options.rendering&&(i=document.createElementNS("http://www.w3.org/2000/svg","defs"),this._canvas.appendChild(i)),"CANVAS"==this._options.rendering&&(this._context=this._canvas.getContext("2d"),this._plugCanvasListener())},_division:function(i,e){return 0===e?i/(e+1e-6):i/e},_heightArrow:function(i,e){return Math.tan(e)*i},_rotate:function(i,e,t){return[(e[0]-i[0])*Math.cos(t)-(e[1]-i[1])*Math.sin(t)+i[0],(e[0]-i[0])*Math.sin(t)+(e[1]-i[1])*Math.cos(t)+i[1]]},_droite:function(i,e){var t,n;return t=this._division(i[1]-e[1],i[0]-e[0]),n=i[1]-t*i[0],{a:t,b:n}},_point:function(i,e,t,n){var o,r,s,a,l,h,p,c,d,f;return l=i.ptA,h=i.ptB,p=e[0],c=t[0],d=e[1],f=t[1],s=Math.sqrt((p-c)*(p-c)+(d-f)*(d-f)),a=n,o=this._division(-p*c+p*p+h*f-d*f-d*h+d*d-s*a,-c+p-l*f+l*d),r=l*o+h,[o,r]},release:function(){}};