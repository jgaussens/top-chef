JSEPackage("ViaMichelin.Api.UI.Overlay.NewsletterRegister"),JSEImportApi("JSE.HTML.UIComponent"),JSEImportApi("JSE.HTTP.AsyncJSHTTPRequest"),JSEImportApi("JSE.HTTP.JSHTTPRequest"),JSEImportApi("ViaMichelin.Api.UI.Overlay"),JSEImportApi("ViaMichelin.Api.Customer.NewsletterManager"),JSEImportApi("ViaMichelin.Api.CookieManager"),ViaMichelin.Api.UI.Overlay.NewsletterRegister=function(){this.extend(ViaMichelin.Api.UI.Overlay),this._setLeftColumnWidth(0),this.width=400,this.url=ViaMichelin.Api.Constants.System.ApiTplPath+"overlay/tplNewsletterRegister.htm.js",this.prepare()},ViaMichelin.Api.UI.Overlay.NewsletterRegister.prototype={MSG_DEFAULT:"default",MSG_ERROR_EMAIL:"error_email",xmlHttpRequest:{JSEtype:"JSE.HTTP.JSHTTPRequest",JSEtypeParams:["JSEInstance.url"],JSEwires:[{event:"responseLoaded",method:"JSEInstance._templateLoaded",thisObj:"JSEInstance"}]},conf:null,_doClose:!1,_signature:null,_sendMailRequest:{JSEtype:"JSE.HTTP.AsyncJSHTTPRequest",JSEtypeParams:[ViaMichelin.Api.Constants.System.ApiVMWebRoot+"/web/jseMailSender"],JSEwires:[{event:"responseLoaded",method:"JSEInstance._sendMailCallback",thisObj:"JSEInstance"}]},_newsletterManager:{JSEtype:"ViaMichelin.Api.Customer.NewsletterManager",JSEtypeParams:[""],JSEwires:[{event:"NewsletterCreated",method:"JSEInstance._newsletterCreateOK",thisObj:"JSEInstance"},{event:"Error",method:"JSEInstance._newsletterCreateError",thisObj:"JSEInstance"},{event:"EmailFormat",method:"JSEInstance._newsletterCreateErrorEmail",thisObj:"JSEInstance"}]},_newsletterManagerBis:{JSEtype:"ViaMichelin.Api.Customer.NewsletterManager",JSEtypeParams:[""],JSEwires:[{event:"NewsletterCreated",method:"JSEInstance._newsletterCreatePartnerOK",thisObj:"JSEInstance"},{event:"Error",method:"JSEInstance._newsletterCreateError",thisObj:"JSEInstance"}]},init:function(e){if(!$_id("idOverlayNewsletterRegister"+this.dynId)){if($isNotEmpty(e.email)||(e.msg="error_email"),!$isNotEmpty(e.newsletter))throw"Required parameter : 'newsletter'";this.xmlHttpRequest.request(),this.conf=e}},_templateLoaded:function(e){var t=document.createElement("div"),i=e.html;switch(i=i.replaceAll("{id}",this.dynId),t.innerHTML=i,this._appendToMainContent(t),this.show(document.body),this.conf.msg){case this.MSG_DEFAULT:$_id("idRegisterLoading"+this.dynId).style.display="",this._doRegister(this.conf.email);break;case this.MSG_ERROR_EMAIL:$_id("idRegisterTitle"+this.dynId).style.display="none",$_id("idRegisterEmailError"+this.dynId).style.display=""}$_id("idRegisterBtn"+this.dynId).expando=this,$_id("idRegisterBtn"+this.dynId).onclick=this._registerOK,window.stats&&stats({event:"nwl_subscription"})},_registerOK:function(){$isDefined($_id("idRegisterOptPartnerCheckbox"+this.expando.dynId))&&$_id("idRegisterOptPartnerCheckbox"+this.expando.dynId).checked?this.expando.createNewsletterWithPartner():this.expando.close()},_sendEmail:function(e,t){var i="";$isNotEmpty(e.gastronomy)&&e.gastronomy?i="G":$isNotEmpty(e.mobility)&&e.mobility?i="AM":$isNotEmpty(e.travel)&&e.travel?i="T":$isNotEmpty(e.partners)&&e.partners&&(i="PO"),this._sendMailRequest.request("nl="+i+"&service=NewsLetter&action=register&s="+t)},_sendMailCallback:function(){this._doClose&&this.close()},createNewsletterWithPartner:function(){this._newsletterManagerBis.createNewsletter(this._generateNewletterParams(!0))},_doRegister:function(){this._newsletterManager.createNewsletter(this._generateNewletterParams(!1))},_generateNewletterParams:function(e){var t={};if(t.email=this.conf.email,t.partnersOffers=e,$isNotEmpty(this.conf.newsletter))for(var i in this.conf.newsletter)this.conf.newsletter.hasOwnProperty(i)&&(t[i]=this.conf.newsletter[i]);return $isNotEmpty(this.conf.origin)&&(t.origin=this.conf.origin),t},_newsletterCreateOK:function(e){this._signature=e.newsletter.signature,$_id("idRegisterLoading"+this.dynId).style.display="none",$_id("idRegisterOptPartner"+this.dynId).style.display="",$isNotEmpty(this.conf.newsletter)?$isNotEmpty(this.conf.newsletter.mobility)?$_id("idRegisterMobility"+this.dynId).style.display="":$isNotEmpty(this.conf.newsletter.travel)?$_id("idRegisterTravel"+this.dynId).style.display="":$isNotEmpty(this.conf.newsletter.gastronomy)?$_id("idRegisterGastronomy"+this.dynId).style.display="":$_id("idRegisterAll"+this.dynId).style.display="":$_id("idRegisterAll"+this.dynId).style.display=""},_newsletterCreatePartnerOK:function(){this._doClose=!0,this.close()},_newsletterCreateError:function(){$_id("idRegisterLoading"+this.dynId).style.display="none",$_id("idRegisterFailed"+this.dynId).style.display="",$_id("idRegisterTitle"+this.dynId).style.display="none"},_newsletterCreateErrorEmail:function(){$_id("idRegisterLoading"+this.dynId).style.display="none",$_id("idRegisterTitle"+this.dynId).style.display="none",$_id("idRegisterEmailError"+this.dynId).style.display=""},release:function(){this._newsletterManager.isolate(),this._newsletterManager.release(),ViaMichelin.Api.UI.Overlay.prototype.release.call(this)}};