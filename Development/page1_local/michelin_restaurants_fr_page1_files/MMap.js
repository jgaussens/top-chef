JSEPackage("JSE.HTML"),JSE.HTML={findPosition:function(i){if(i.offsetParent){for(var t=0,e=0;i;i=i.offsetParent)t+=i.offsetLeft,e+=i.offsetTop,i.scrollTop&&"body"!==i.nodeName.toLowerCase()&&(e-=i.scrollTop),i.scrollLeft&&"body"!==i.nodeName.toLowerCase()&&(t-=i.scrollLeft);return[t,e]}return[i.x,i.y]},clear:function(i){var t;for(t in i)if("src"!=t&&"innerHTML"!=t&&"outerHTML"!=t)try{i[t]=""}catch(e){}},getStyle:function(i,t){var e;return e=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(i,"").getPropertyValue(t.replace(/[A-Z]/g,function(i){return"-"+i.toLowerCase()})):i.currentStyle?i.currentStyle[t]:!1},getChild:function(i,t,e){for(var n=e.getElementsByTagName(i),o=n.length,a=0;o>a;a++)if(n[a].id==t)return n[a]},toogleDisplay:function(i,t){"undefined"==typeof t&&(t=""),i.style.display=i.style.display==t?"none":t},toogleClass:function(i,t,e){var n=i.className;"undefined"==typeof e&&(e=""),-1==n.indexOf(t)?(""!==e&&n.indexOf(e)>-1&&(n=n.replaceAll(e,"")),n+=" "+t):(""!==t&&n.indexOf(t)>-1&&(n=n.replaceAll(t,"")),""!==e&&(n+=" "+e)),n=n.replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s{2}/g," "),i.className=n},replaceClass:function(i,t){$isDefined(i)&&$isDefined(t)&&(i.setAttribute("class",t),i.setAttribute("className",t))},getClassName:function(i){if($isDefined(i)){var t=i.getAttribute("class");return $isNotEmpty(t)||(t=i.getAttribute("className")),t}return null},isClassExist:function(i,t){if("undefined"==typeof i.getAttribute)return!1;var e=i.getAttribute("class");if(("undefined"==typeof e||""===e||null==e||"null"==e)&&(e=i.getAttribute("className")),$isDefined(e))for(var n=e.split(" "),o=0;o<n.length;o++)if(n[o]==t)return!0;return!1},addClass:function(i,t){if($isDefined(i)&&$isNotEmpty(t)&&!JSE.HTML.isClassExist(i,t)){var e=i.getAttribute("class");("undefined"==typeof e||""===e||null==e||"null"==e)&&(e=i.getAttribute("className")),$isNotEmpty(e)?e+=" ":e="",e+=t,e=e.replaceAll("  "," "),i.setAttribute("class",e),i.setAttribute("className",e)}},removeClass:function(i,t){if($isDefined(i)&&$isNotEmpty(t)){var e=JSE.HTML.getClassName(i);if($isNotEmpty(e)){for(var n=e.split(" "),o=[],a=0;a<n.length;a++)n[a]!=t&&o.push(n[a]);e=o.join(" "),JSE.HTML.replaceClass(i,e)}}},getPNGBackgroundStyle:function(i,t){var e="string"==typeof t?",sizingMethod='"+t+"'":"",n=navigator.isIE6?"filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+i+"'"+e+");":"background-image:url("+i+");";return n},getPNG:function(i,t){i.onload="";var e=i.src;if(i.src=ViaMichelin.Api.Constants.System.ApiImgPath+"all/s.gif",navigator.isIE6){var n="string"==typeof t?",sizingMethod='"+t+"'":"";i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"'"+n+")"}else i.style.backgroundImage="url("+e+")"},loadPNGForBackground:function(i,t,e){var n=document.createElement("img");n.obj=i,n.sizingMethod=e,n.onload=function(){if(navigator.isIE6){var t="string"==typeof this.sizingMethod?",sizingMethod='"+this.sizingMethod+"'":"";i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+this.src+"'"+t+");"}else i.style.backgroundImage="url("+this.src+")";this.onload=""},n.src=t},isDefinedSelector:function(i){var t=document.createElement("div");t.className=i;var e=null;try{e=getComputedStyle(t,null)}catch(n){}if(null==e)try{e=document.defaultView.getComputedStyle(t,null)}catch(n){}if(null!=e){var o="none"===e.display;return o}return!1},getDefinedCss:function(i){if(!document.styleSheets)return"";"string"==typeof i&&(i=RegExp("\\b"+i+"\\b","i"));for(var t,e,n=document.styleSheets,o=n.length,a=[];o;)try{e=n[--o],t=e.rules?e.rules:e.cssRules;for(var r=0;r<t.length;r++){var s=t[r].selectorText?[t[r].selectorText,t[r].style.cssText]:[t[r]+""];i.test(s[0])&&(a[a.length]=s)}}catch(l){}return a.join("\n\n")}},ToJSEObject(JSE.HTML),JSEPackage("JSE.HTML.UIComponent"),JSE.HTML.UIComponent=function(i){this.prepare(),this.HTMLElement=i?"string"==typeof i?document.createElement(i):i:document.createElement("div"),this.HTMLElement.expando=this,this.HTMLElement.ondblclick=this.reportHTMLEvent,this.HTMLElement.onclick=this.reportHTMLEvent,this.HTMLElement.onmousedown=this.reportHTMLEvent,this.HTMLElement.onmouseup=this.reportHTMLEvent,this.HTMLElement.onmousemove=this.reportHTMLEvent,this.HTMLElement.onmouseover=this.reportHTMLEvent,this.HTMLElement.onmouseout=this.reportHTMLEvent,this.HTMLElement.oncontextmenu=this.reportHTMLEvent,this.HTMLElement.ontouchstart=this.reportHTMLEvent,this.HTMLElement.ontouchmove=this.reportHTMLEvent,this.HTMLElement.ontouchend=this.reportHTMLEvent,this.HTMLElement.ongesturestart=this.reportHTMLEvent,this.HTMLElement.ongesturechange=this.reportHTMLEvent,this.HTMLElement.ongestureend=this.reportHTMLEvent,this.HTMLElement.addEventListener&&this.HTMLElement.addEventListener("DOMMouseScroll",this.reportHTMLEvent,!1),this.HTMLElement.onmousewheel=this.reportHTMLEvent},JSE.HTML.UIComponent.prototype={JSEwireHub:{HTMLEvent_click:[],HTMLEvent_mousedown:[],HTMLEvent_mouseup:[],HTMLEvent_mousemove:[],HTMLEvent_contextmenu:[],HTMLEvent_mousewheel:[]},childComponents:[],appendToHTMLElement:function(i){i.appendChild(this.HTMLElement)},appendChildComponent:function(i){this.childComponents.push(i),this.HTMLElement.appendChild(i.HTMLElement)},release:function(){this.clearDOM()},isInDOMTree:function(){return!!this.HTMLElement.parentNode},clearDOM:function(){this.HTMLElement&&(this.HTMLElement.expando="",this.HTMLElement.onclick="",this.HTMLElement.onmousedown="",this.HTMLElement.onmouseup="",this.HTMLElement.onmousemove="",this.HTMLElement.oncontextmenu="",this.HTMLElement.onmouseover="",this.HTMLElement.onmouseout="",this.HTMLElement.removeEventListener&&this.HTMLElement.removeEventListener("DOMMouseScroll",this.reportHTMLEvent,!1),this.HTMLElement.onmousewheel=""),this.HTMLElement=null},reportHTMLEvent:function(i){navigator.isIE&&(i=window.event);var t=i.type;"DOMMouseScroll"==i.type&&(t="mousewheel"),this.expando.stimulate("HTMLEvent_"+t,i,this.expando)},preventDefAction:function(i){var t=$isDefined(i)?i:event;$isDefined(t.preventDefault)?t.preventDefault():t.returnValue=!1},cancelBubbling:function(i){var t=$isDefined(i)?i:event;$isDefined(t.stopPropagation)?t.stopPropagation():t.cancelBubble=!0}},ToJSEObject(JSE.HTML.UIComponent),JSEPackage("JSE.HTTP"),JSE.HTTP={JSEwireHub:{responseLoaded:[],onRequestLaunched:[],onRequestLoaded:[],onRequestCancelled:[]},currentRequest:-1,isRequesting:!1,requests:[],asyncRequests:[],freeze:!1,addRequest:function(i,t){this.requests.push([i,t+"&charset=UTF-8"]),this.nextHTTPCall()},addAsyncRequest:function(i){if(this.freeze)return this.addAsyncRequest(i);this.freeze=!0,this.asyncRequests.push(i);var t=this.asyncRequests.length-1;return this.freeze=!1,i.unplugWire(new JSEWire("requestLaunched",this._stimulateLaunch,this)),i.unplugWire(new JSEWire("responseLoaded",this._stimulateLoaded,this)),i.unplugWire(new JSEWire("responseCancelled",this._stimulateCancelled,this)),i.plugWire(new JSEWire("requestLaunched",this._stimulateLaunch,this)),i.plugWire(new JSEWire("responseLoaded",this._stimulateLoaded,this)),i.plugWire(new JSEWire("responseCancelled",this._stimulateCancelled,this)),t},_stimulateLaunch:function(){this.stimulate("onRequestLaunched")},_stimulateLoaded:function(){this.stimulate("onRequestLoaded")},_stimulateCancelled:function(){this.stimulate("onRequestCancelled")},nextHTTPCall:function(){if(!this.isRequesting)if(this.currentRequest++,this.requests.length>this.currentRequest){this.isRequesting=!0;var i=this.requests[this.currentRequest][0].JSEwireHub.responseLoaded;this.JSEwireHub.responseLoaded=[];for(var t=0;t<i.length;t++)this.plugWire(i[t]);this.requests[this.currentRequest][0].JSEwireHub.responseLoaded=[],this.requests[this.currentRequest][0].plugWire({event:"responseLoaded",method:JSE.HTTP._responseLoaded,thisObj:JSE.HTTP}),this.requests[this.currentRequest][0]._doRequest(this.requests[this.currentRequest][1])}else this.currentRequest--},_responseLoaded:function(){var i=this.JSEwireHub.responseLoaded;this.requests[this.currentRequest][0].JSEwireHub.responseLoaded=[];for(var t=0;t<i.length;t++)this.requests[this.currentRequest][0].plugWire(i[t]);this.stimulate("responseLoaded",this.requests[this.currentRequest][0].response),this.isRequesting=!1,this.nextHTTPCall()}},ToJSEObject(JSE.HTTP),JSEPackage("JSE.HTTP.ApiMicrosoftRequest"),JSE.HTTP.ApiMicrosoftRequest=function(i){this.extend(JSE.HTML.UIComponent),this.prepare(),this.url=i,this.HTMLElement.style.display="none",this.appendToHTMLElement(document.body)},JSE.HTTP.ApiMicrosoftRequest.prototype={JSEwireHub:{responseLoaded:[]},response:{JSEhint:"Response from the server call",JSEtype:"Object"},url:{JSEhint:"URL to call",JSEtype:"String"},params:{JSEhint:"Parameters string for the request",JSEtype:"String"},timeout:-1,request:function(i,t){t+="&jsonp=HTTPMicrosoftResponse",this.scriptElement=document.createElement("script"),this.scriptElement.expando=this,this.scriptElement.setAttribute("type","text/javascript"),navigator.isIE?this.scriptElement.onreadystatechange=this.HTTPResponseReady:this.scriptElement.onload=this.HTTPResponseLoaded;var e=ViaMichelin.Api.Util.Http.protocolAdapter(this.url+i+"?"+t);this.scriptElement.setAttribute("src",e),this.HTMLElement.appendChild(this.scriptElement)},_doCancel:function(){navigator.isIE?this.scriptElement.onreadystatechange="":this.scriptElement.onload="",this.HTMLElement.removeChild(this.scriptElement),this.stimulate("responseCancelled",this)},HTTPResponseReady:function(){("loaded"==this.readyState||"complete"==this.readyState)&&this.expando.HTTPResponseLoaded.apply(this)},HTTPResponseLoaded:function(){this.expando.response=HTTPResponse,this.expando.stimulate("responseLoaded",this.expando.response),this.expando.scriptElement=null,this.expando="",this.onload="",this.onreadystatechange=""}},HTTPMicrosoftResponse=function(i){HTTPResponse=i},ToJSEObject(JSE.HTTP.ApiMicrosoftRequest),JSEPackage("JSE.HTTP.ApiRestRequest"),JSEImportApi("ViaMichelin.Api.Constants.Exception"),JSE.HTTP.ApiRestRequest=function(){this.extend(JSE.HTML.UIComponent),this.prepare(),this.HTMLElement.style.display="none",this.appendToHTMLElement(document.body),this.scriptElements=[],this.timeouts=[]},JSE.HTTP.ApiRestRequest.prototype={JSEwireHub:{requestLaunched:[],responseLoaded:[],responseCancelled:[],responseError:[]},response:{JSEhint:"Response from the server call",JSEtype:"Object"},url:{JSEhint:"URL to call",JSEtype:"String"},params:{JSEhint:"Parameters string for the request",JSEtype:"String"},timeout:-1,lang:null,setTimeout:function(i){this.timeout=i},request:function(i,t,e){var n,o,a=ViaMichelin.Api.Constants.System.ApiRestRoot.replace("/1/","/");this.url=$isDefined(e)?a+e+"/"+i:a+this._getVersionService(i)+"/"+i,n=JSE.HTTP.addAsyncRequest(this),t=this._formatsParams(t,n),o=this._createUrl(this.url,t),this._doRequest(o)},_formatsParams:function(i,t){var e,n;return i="string"!=typeof i?"":i,n=null!==this.lang?this.lang:ViaMichelin.Api.Constants.System.ApiRestLang,i.match(/obfuscation=/i)||(i+="undefined"!=typeof ViaMichelin.Api.Constants.System.useObfuscation?"&obfuscation="+ViaMichelin.Api.Constants.System.useObfuscation:"&obfuscation=false"),i+="&ie=UTF-8&charset=UTF-8&callback=JSE.HTTP.asyncRequests["+t+"].HTTPResponseLoaded",i+="&authKey="+ViaMichelin.Api.Constants.System.ApiRestKey,-1==i.indexOf("&lg=")&&(i+="&lg="+n),e=new Date,i+="&nocache="+e.getTime(),i=i.replace(/^&(.*)/,"$1")},_doRequest:function(i){var t=document.createElement("script");t.expando=this,t.setAttribute("type","text/javascript"),t.setAttribute("src",i),navigator.isIE?t.onreadystatechange=this.readyStateChange:t.onload=this.loadComplete,t.onerror=this.componentLoadingError,this.isInDOMTree()||this.appendToHTMLElement(document.body),this.stimulate("requestLaunched",i),this.HTMLElement.appendChild(t)},_createUrl:function(i,t){return ViaMichelin.Api.Util.Http.protocolAdapter(i+"?"+t)},componentLoadingError:function(){var i=new ViaMichelin.Api.Exception(ViaMichelin.Api.Constants.Exception.SERVICE_NOT_AVAILABLE,"Service not available","url:"+this.expando.url);this.expando.stimulate("responseError",i),JSE.HTTP.stimulate("onError",i)},_doCancel:function(i){this.HTMLElement.removeChild(this.scriptElements[i]),this.stimulate("responseCancelled",this)},_getVersionService:function(i){var t=1;switch(i=i.split(".")[0]){case"geocode3f":case"geocode4f":case"getAppData":case"location":case"rgeocode":case"myvm":t=1;break;case"MsToken":case"TiledMapOfAdmin":case"tiledMapOfPlace":case"tiledMap":case"tiledBestMap":case"TiledMapOfPOI":case"ProductParametersValues":case"PoiCrit":case"POD":case"weather":t=1;break;case"iti":t=2;break;default:t=1}return t},HTTPResponseLoaded:function(i){-1!=this.timeout&&clearTimeout(this.timer),$isDefined(i.error)?(this.response=i,this.stimulate("responseCancelled",new ViaMichelin.Api.Exception(i.error.errorCode,i.error.errorMsg),i)):this.stimulate("responseLoaded",i)},readyStateChange:function(){("loaded"==this.readyState||"complete"==this.readyState)&&(this.onreadystatechange="",JSE.HTTP.ApiRestRequest.prototype.loadComplete.call(this))},loadComplete:function(){this.parentNode.removeChild(this)}},ToJSEObject(JSE.HTTP.ApiRestRequest),JSEPackage("JSE.HTTP.AsyncJSHTTPRequest"),JSE.HTTP.AsyncJSHTTPRequest=function(i){this.extend(JSE.HTML.UIComponent),this.prepare(),this.url=i,this.HTMLElement.style.display="none",this.appendToHTMLElement(document.body),this.scriptElements=[],this.timeouts=[]},JSE.HTTP.AsyncJSHTTPRequest.prototype={JSEwireHub:{requestLaunched:[],responseLoaded:[],responseCancelled:[]},response:{JSEhint:"Response from the server call",JSEtype:"Object"},url:{JSEhint:"URL to call",JSEtype:"String"},params:{JSEhint:"Parameters string for the request",JSEtype:"String"},timeout:-1,setTimeout:function(i){this.timeout=i},request:function(i){i="undefined"==typeof i?"":i;var t=JSE.HTTP.addAsyncRequest(this);this._doRequest(i,t)},_doRequest:function(i,t){var e=ViaMichelin.Api.Constants.System.ApiLang;i="undefined"==typeof i?"":i,i+="&charset=UTF-8&callBack=JSE.HTTP.asyncRequests["+t+"].HTTPResponseLoaded",-1==i.indexOf("&lang=")&&(i+="&lang="+e);var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",this.url+"?"+i),navigator.isIE?n.onreadystatechange=this.readyStateChange:n.onload=this.loadComplete,this.isInDOMTree()||this.appendToHTMLElement(document.body),this.stimulate("requestLaunched",this.url+"?"+i),this.HTMLElement.appendChild(n)},_doCancel:function(i){this.HTMLElement.removeChild(this.scriptElements[i]),this.stimulate("responseCancelled",this)},HTTPResponseLoaded:function(i){-1!=this.timeout&&clearTimeout(this.timer),this.stimulate("responseLoaded",i)},readyStateChange:function(){("loaded"==this.readyState||"complete"==this.readyState)&&(this.onreadystatechange="",JSE.HTTP.AsyncJSHTTPRequest.prototype.loadComplete.call(this))},loadComplete:function(){this.parentNode.removeChild(this)}},ToJSEObject(JSE.HTTP.AsyncJSHTTPRequest),JSEPackage("JSE.HTTP.JSHTTPRequest"),JSE.HTTP.JSHTTPRequest=function(i){this.extend(JSE.HTML.UIComponent),this.prepare(),this.url=i,this.HTMLElement.style.display="none",this.appendToHTMLElement(document.body)},JSE.HTTP.JSHTTPRequest.prototype={JSEwireHub:{responseLoaded:[]},response:{JSEhint:"Response from the server call",JSEtype:"Object"},url:{JSEhint:"URL to call",JSEtype:"String"},params:{JSEhint:"Parameters string for the request",JSEtype:"String"},timeout:-1,request:function(i){JSE.HTTP.addRequest(this,i)},_doRequest:function(i){i="undefined"==typeof i?"":i,i+="&charset=UTF-8",i+="&callBackObject=HTTPResponse&version=",i+="&lang="+ViaMichelin.Api.Constants.System.ApiLang,this.scriptElement=document.createElement("script"),this.scriptElement.expando=this,this.scriptElement.setAttribute("type","text/javascript"),navigator.isIE?this.scriptElement.onreadystatechange=this.HTTPResponseReady:this.scriptElement.onload=this.HTTPResponseLoaded,this.scriptElement.setAttribute("src",this.url+"?"+i),this.HTMLElement.appendChild(this.scriptElement)},_doCancel:function(){navigator.isIE?this.scriptElement.onreadystatechange="":this.scriptElement.onload="",this.HTMLElement.removeChild(this.scriptElement),this.stimulate("responseCancelled",this)},HTTPResponseReady:function(){("loaded"==this.readyState||"complete"==this.readyState)&&this.expando.HTTPResponseLoaded.apply(this)},HTTPResponseLoaded:function(){this.expando.response=HTTPResponse,this.expando.stimulate("responseLoaded",this.expando.response),this.expando.scriptElement=null,this.expando="",this.onload="",this.onreadystatechange=""}},HTTPResponse=null,ToJSEObject(JSE.HTTP.JSHTTPRequest),JSEPackage("JSE.HTTP.UniqueApiRestRequest"),JSEImportApi("ViaMichelin.Api.Constants.Exception"),JSE.HTTP.UniqueApiRestRequest=function(){this.extend(JSE.HTML.UIComponent),this.prepare(),this.HTMLElement.style.display="none",this.appendToHTMLElement(document.body),this.scriptElements=[],this.timeouts=[]},JSE.HTTP.UniqueApiRestRequest.prototype={JSEwireHub:{requestLaunched:[],responseLoaded:[],responseCancelled:[],responseError:[]},response:{JSEhint:"Response from the server call",JSEtype:"Object"},unique:!0,url:{JSEhint:"URL to call",JSEtype:"String"},params:{JSEhint:"Parameters string for the request",JSEtype:"String"},timeout:-1,index:-1,lang:null,setTimeout:function(i){this.timeout=i},request:function(i,t,e){this._doCancel(),t="undefined"==typeof t?"":t;var n,o=ViaMichelin.Api.Constants.System.ApiRestRoot.replace("/1/","/");this.url=$isDefined(e)?o+e+"/"+i:o+this._getVersionService(i)+"/"+i,this.index=JSE.HTTP.addAsyncRequest(this),t=this._formatsParams(t,this.index),n=this._createUrl(this.url,t),this._doRequest(n)},_createUrl:function(i,t){return ViaMichelin.Api.Util.Http.protocolAdapter(i+"?"+t)},_formatsParams:function(i,t){var e,n;return i="string"!=typeof i?"":i,n=null!==this.lang?this.lang:ViaMichelin.Api.Constants.System.ApiRestLang,i.match(/obfuscation=/i)||(i+="undefined"!=typeof ViaMichelin.Api.Constants.System.useObfuscation?"&obfuscation="+ViaMichelin.Api.Constants.System.useObfuscation:"&obfuscation=false"),i+="&ie=UTF-8&charset=UTF-8&callback=JSE.HTTP.asyncRequests["+t+"].HTTPResponseLoaded",i+="&authKey="+ViaMichelin.Api.Constants.System.ApiRestKey,-1===i.indexOf("&lg=")&&(i+="&lg="+n),e=new Date,i+="&nocache="+e.getTime(),i=i.replace(/^&(.*)/,"$1")},_doRequest:function(i){var t=document.createElement("script");t.expando=this,t.setAttribute("type","text/javascript"),t.setAttribute("src",i),navigator.isIE?t.onreadystatechange=this.readyStateChange:t.onload=this.loadComplete,t.onerror=this.componentLoadingError,this.scriptElement=t,-1!=this.timeout&&(this.timer=setTimeout("JSE.HTTP.asyncJSRequests["+index+"]._doCancel()",this.timeout)),this.isInDOMTree()||this.appendToHTMLElement(document.body),this.stimulate("requestLaunched",i),this.HTMLElement.appendChild(t)},componentLoadingError:function(){var i=new ViaMichelin.Api.Exception(ViaMichelin.Api.Constants.Exception.SERVICE_NOT_AVAILABLE,"Service not available","url:"+this.expando.url);this.expando.stimulate("responseError",i),JSE.HTTP.stimulate("onError",i)},_doCancel:function(){-1!=this.index&&(JSE.HTTP.asyncRequests[this.index]={HTTPResponseLoaded:function(){}},this.scriptElement=null,this.stimulate("responseCancelled",this))},_getVersionService:function(i){var t=1;switch(i=i.split(".")[0]){case"geocode3f":case"geocode4f":case"getAppData":case"location":case"rgeocode":case"myvm":t=1;break;case"MsToken":case"TiledMapOfAdmin":case"tiledMapOfPlace":case"tiledMap":case"tiledBestMap":case"TiledMapOfPOI":case"ProductParametersValues":case"PoiCrit":case"POD":case"weather":t=1;break;case"iti":t=2;break;default:t=1}return t},HTTPResponseLoaded:function(i){-1!=this.timeout&&clearTimeout(this.timer),this.scriptElement=null,this.index=-1,$isDefined(i.error)?(this.response=i,this.stimulate("responseCancelled",new ViaMichelin.Api.Exception(i.error.errorCode,i.error.errorMsg),i)):this.stimulate("responseLoaded",i)},readyStateChange:function(){("loaded"==this.readyState||"complete"==this.readyState)&&(this.onreadystatechange="",JSE.HTTP.ApiRestRequest.prototype.loadComplete.call(this))},loadComplete:function(){this.parentNode&&this.parentNode.removeChild(this)},release:function(){this._doCancel(),this.clearDOM()}},ToJSEObject(JSE.HTTP.UniqueApiRestRequest),JSEPackage("ViaMichelin.Api.AsyncUniqueJSHTTPRequest"),ViaMichelin.Api.AsyncUniqueJSHTTPRequest=function(i){this.extend(JSE.HTML.UIComponent),this.prepare(),this.url=i,this.HTMLElement.style.display="none",this.appendToHTMLElement(document.body),this.scriptElements=[],this.timeouts=[]},ViaMichelin.Api.AsyncUniqueJSHTTPRequest.prototype={JSEwireHub:{requestLaunched:[],responseLoaded:[],responseCancelled:[]},response:{JSEhint:"Response from the server call",JSEtype:"Object"},url:{JSEhint:"URL to call",JSEtype:"String"},params:{JSEhint:"Parameters string for the request",JSEtype:"String"},callbackParam:"callBack",timeout:-1,index:-1,setTimeout:function(i){this.timeout=i},request:function(i){this._doCancel(),this.index=JSE.HTTP.addAsyncRequest(this),this._doRequest(i,this.index)},_doRequest:function(i,t){var e=ViaMichelin.Api.Constants.System.ApiLang;"int"===ViaMichelin.Api.Constants.System.ApiLang&&(e="gbr"),i+="&charset=UTF-8&"+this.callbackParam+"=JSE.HTTP.asyncRequests["+t+"].HTTPResponseLoaded&version=",i+="&lang="+e;var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",this.url+"?"+i),navigator.isIE?n.onreadystatechange=this.readyStateChange:n.onload=this.loadComplete,this.scriptElement=n,-1!==this.timeout&&(this.timer=setTimeout("JSE.HTTP.asyncJSRequests["+t+"]._doCancel()",this.timeout)),this.stimulate("requestLaunched",this.url+"?"+i),this.HTMLElement.appendChild(n)},_doCancel:function(){-1!==this.index&&(JSE.HTTP.asyncRequests[this.index]={HTTPResponseLoaded:function(){}},this.scriptElement=null,this.stimulate("responseCancelled",this))},HTTPResponseLoaded:function(i){-1!==this.timeout&&clearTimeout(this.timer),this.scriptElement=null,this.index=-1,this.stimulate("responseLoaded",i)},readyStateChange:function(){("loaded"===this.readyState||"complete"===this.readyState)&&(this.onreadystatechange="",JSE.HTTP.AsyncJSHTTPRequest.prototype.loadComplete.call(this))},loadComplete:function(){this.parentNode.removeChild(this)}},ToJSEObject(ViaMichelin.Api.AsyncUniqueJSHTTPRequest),JSEPackage("ViaMichelin.Api.Constants.Map"),ViaMichelin.Api.Constants.Map={TYPE:{ROADMAP:"ROADMAP",SATELLITE:"SATELLITE",HYBRID:"HYBRID",EMPTY:"EMPTY",LIGHT:"LIGHT",VIAMICHELIN:"VIAMICHELIN"},STYLE:{SATELLITE:"satellite",HYBRID:"htbrid",VIAMICHELIN:"viamichelin",EMPTY:"empty",SMEG:"smeg"},NAVIGATION:{STATIC:"STATIC",DRAG:"DRAG",DRAGZOOM:"DRAGZOOM",CONTROL:{DEFAULT:"DEFAULT",MINI:"MINI"}},POI:{MODE:{MORE:"MORE",LESS:"LESS",ALL:"ALL"}},FROM_GEOLOCATION:"FROM GEOLOCATION",SKIN:{DEFAULT:"Default",NAVIGATOR1:"Navigator1",MOBILE1:"Mobile1",MOBILE2:"Mobile2",MOBILE3:"Mobile3",WEB:"Default",MOBILE:{SMALL:"Mobile1",MEDIUM:"Mobile2",LARGE:"Mobile3"}},DELAY_LOADING:"DELAY_LOADING"},ToJSEObject(ViaMichelin.Api.Constants.Map),JSEPackage("ViaMichelin.Api.CookieManager"),ViaMichelin.Api.CookieManager={setTimedCookie:function(i,t,e){var n=new Date;n.setTime(n.getTime()+24*e*3600*1e3),document.cookie=i+"="+encodeURIComponent(t)+"; expires="+n.toGMTString()+"; path=/"},setTimedCookies:function(i,t){for(var e in i)ViaMichelin.Api.CookieManager.setTimedCookie(e,i[e],t)},delCookie:function(i){ViaMichelin.Api.CookieManager.setTimedCookie(i,"",-1)},delCookies:function(i){for(var t=0;t<i.length;t++)ViaMichelin.Api.CookieManager.delCookie(i[t])},setCookie:function(i,t,e){document.cookie=i+"="+encodeURIComponent(t)+(e?"; path=/":"")},setCookies:function(i,t){for(var e in i)ViaMichelin.Api.CookieManager.setCookie(e,i[e],t)},getCookieLast:function(i){if(!$isDefined(i))return"";var t=i;$isNotEmpty(t)||(t=t.replace(/^\s+/,"").replace(/\s+$/,""));for(var e=document.cookie.split(";"),n=0;n<e.length;n++){var o=e[n].split("="),a=o[0].replace(/^\s+/,"").replace(/\s+$/,"");if(a==t&&o.length>1)return decodeURIComponent(o[1].replace(/^\s+/,"").replace(/\s+$/,""))}return""},getCookie:function(i){var t=i;$isNotEmpty(t)||(t=ViaMichelin.Api.Util.Core.trim(t));var e=new RegExp(t+"=([^;]*)"),n=document.cookie.match(e);return n&&n.length>0?decodeURIComponent(ViaMichelin.Api.Util.Core.trim(n[1])):""},getCookieValue:function(i,t){var e=t.indexOf(i+":");return-1==e?null:-1==t.indexOf(",",e)?t.substring(t.indexOf(i+":")+i.length+1):t.substring(e+i.length+1,t.indexOf(",",e))}},ToJSEObject(ViaMichelin.Api.CookieManager),JSEPackage("ViaMichelin.Api.Exception"),ViaMichelin.Api.Exception=function(i,t,e){this.code=this.errorCode=i,this.message=this.errorMsg=t?t:"",this.detail=this.errorDetail=e?e:""},ViaMichelin.Api.Exception.prototype={errorCode:null,errorMsg:null,errorDetail:null,toString:function(){return"{ViaMichelin.Api.Exception} - code: "+this.errorCode+", msg: '"+this.errorMsg+"', detail: '"+this.errorDetail+"'"}},ToJSEObject(ViaMichelin.Api.Exception),JSEPackage("ViaMichelin.Api.MMap"),JSEImportApi("ViaMichelin.Api.MMap.Module.Traffic.Layer.RefreshTraffic"),JSEImportApi("ViaMichelin.Api.MMap.Module.Itinerary.MarkerFollower"),ViaMichelin.Api.MMap=function(){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Map)},ViaMichelin.Api.MMap.prototype={_microCatalog:null,options:{tileOpacity:1},init:function(i){var t;t={loadInternalCss:!0,skin:"Default",mapStyle:ViaMichelin.Api.Constants.Map.STYLE.VIAMICHELIN,lang:ViaMichelin.Api.Constants.System.ApiLang,traffic:!1,controls:{scale:!0,scalePosition:"bottomright",copyright:!0,copyrightPosition:"bottomright",logo:!0,logoPosition:"bottomleft"},locale:"fr_FR"},ViaMichelin.Api.Constants.System.ApiLocale&&(t.locale=ViaMichelin.Api.Constants.System.ApiLocale),this._loadModules(),ViaMichelin.Api.Util.Object.mixAttributes(t,i),ViaMichelin.Api.MMap.Core.Map.prototype.initialize.apply(this,[t]),this._load()},_loadModules:function(){this.loadModule(ViaMichelin.Api.MMap.Module.Core.Weather),this.loadModule(ViaMichelin.Api.MMap.Module.Core.Traffic)},_load:function(){var i=new ViaMichelin.Api.Util.TaskRunner,t=this;i.plugWire("end",function(){"empty"!==t.options.mapStyle&&t.setMapStyle(t.options.mapStyle),this._controls(),t.stimulate("onSuccess",t)},this),i.push(function(i){var e,n;e=new ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Request,n=e.getStoredVersion(),e.request(function(e){if(e.error){var o=new ViaMichelin.Api.Exception(ViaMichelin.Api.Constants.Exception.SERVICE_ERROR,"Error MicroCatalog",e.error);return t.stimulate("onError",o),t.release(),!1}if(t._microCatalog=new ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog(e,t,t.options.lang),n){var a=new ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Request;a.request(function(i){(i.error||t._microCatalogNotValid)&&t._eraseMicroCatalogStorage()},!0)}i()})}),this.options.loadInternalCss&&i.push(function(i){t._loadCSS(i)}),i.run()},_controls:function(){if(this.options.controls){var i;if(this.options.controls.copyright){var t;i=this.options.controls.scalePosition?this.options.controls.scalePosition:"bottomright",t=new ViaMichelin.Api.MMap.Module.Control.Copyright({position:i}),this.addControl(t)}if(this.options.controls.scale){var e;i=this.options.controls.scalePosition?this.options.controls.scalePosition:"bottomright",e=new ViaMichelin.Api.MMap.Module.Control.Scale({position:i}),this.addControl(e)}if(this.options.controls.logo){var n;i=this.options.controls.logoPosition?this.options.controls.logoPosition:"bottomleft",n=new ViaMichelin.Api.MMap.Module.Control.Logo({position:i}),this.addControl(n)}}},getNorthWest:function(){return this.containerPointToLatLon(new ViaMichelin.Api.MMap.Core.Geometry.Point(0,0))},getNorthEast:function(){return this.containerPointToLatLon(new ViaMichelin.Api.MMap.Core.Geometry.Point(this.getSize().x,0))},getSouthWest:function(){return this.containerPointToLatLon(new ViaMichelin.Api.MMap.Core.Geometry.Point(0,this.getSize().y))},getSouthEast:function(){return this.containerPointToLatLon(new ViaMichelin.Api.MMap.Core.Geometry.Point(this.getSize().x,this.getSize().y))},moveEast:function(i){this.panBy([this.getSize().x,0],i)},moveNorth:function(i){this.panBy([0,-this.getSize().y],i)},moveSouth:function(i){this.panBy([0,this.getSize().y],i)},moveWest:function(i){this.panBy([-this.getSize().x,0],i)},setScrollwheel:function(i){"boolean"==typeof i&&this.scrollWheelZoom&&(i?this.scrollWheelZoom.enabled()||this.scrollWheelZoom.enable():this.scrollWheelZoom.enabled()&&this.scrollWheelZoom.disable())},getTileOpacity:function(){return this.options.tileOpacity},setTileOpacity:function(i){this.options.tileOpacity=i,this.eachLayer(function(t){t.setOpacity&&t.setOpacity(i)},this)},getMapStyle:function(){return this.options.mapStyle},getMapStyleList:function(){return this._microCatalog?this._microCatalog.getMapStyleList():[]},setMapStyle:function(i){var t=this;this._microCatalogNotValid=!1,this.options.mapStyle=i,this._backgroundLayer&&(this._backgroundLayer.removeFrom(this),this._backgroundLayer=null),this._backgroundLayer=new ViaMichelin.Api.MMap.Module.Michelin({microCatalog:this._microCatalog,mapStyle:i.toLowerCase(),lang:this.options.lang});try{if(this._backgroundLayer.addTo(this),("satellite"===i||"hybrid"===i)&&!ViaMichelin.Api.CookieManager.getCookie("metaDataMicrosoft")){var e=new JSE.HTTP.ApiMicrosoftRequest("http://dev.virtualearth.net/REST/v1/Imagery/Metadata/");e.plugWire("responseLoaded",function(i){ViaMichelin.Api.CookieManager.setCookie("metaDataMicrosoft",JSON.stringify(i))},this),e.request("Aerial","output=json&key=AnCvfIz9e84mYEfC1MBXKhm_oKWyk9PZJog39ixo0mrP7O4UfVlK9im3AS95JKR2")}}catch(n){this.removeLayer(this._backgroundLayer),t._microCatalogNotValid=!0,t._eraseMicroCatalogStorage()}this.options.traffic&&this.setTraffic(!0),this.stimulate("mapstyle",i)},resizeTo:function(i){this._container.style.width=i.width+"px",this._container.style.height=i.height+"px",this.invalidateSize()},getLocale:function(){return this.options.locale},_loadCSS:function(i){if($isDefined(this.options.loadInternalCss)&&this.options.loadInternalCss){var t,e,n,o,a,r="ApiMMap";if(t=e=150,a=6*t,n=ViaMichelin.Api.Util.Css.generateUrlCss(r,"",{ie8:!0}),ViaMichelin.Api.Util.Css.loadCss(r,n),n=ViaMichelin.Api.Util.Css.generateUrlCss("skin/"+this.options.skin,""),ViaMichelin.Api.Util.Css.loadCss(this.options.skin,n),ViaMichelin.Api.Util.Css.isDefinedSelector("is"+r+"Imported"))return void setTimeout(i,0);var s=setInterval(function(){o=ViaMichelin.Api.Util.Css.isDefinedSelector("is"+r+"Imported"),(o||t>=a)&&(clearInterval(s),i()),t+=e},e)}},_eraseMicroCatalogStorage:function(){var i=new ViaMichelin.Api.StorageManager;i.removeItem("microCatalog")},release:function(){this.remove()},toString:function(){return"[ViaMichelin.Api.MMap]"}},JSEPackage("ViaMichelin.Api.MMap.Core.Control"),ViaMichelin.Api.MMap.Core.Control=function(){},ViaMichelin.Api.MMap.Core.Control.prototype={options:{position:"topright"},getPosition:function(){return this.options.position},setPosition:function(i){var t=this._map;return t&&t.removeControl(this),this.options.position=i,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(i){this._map=i;var t=this._container=this.onAdd(i),e=this.getPosition(),n=i._controlCorners[e];return ViaMichelin.Api.Util.Dom.addClass(t,"mmap-control"),-1!==e.indexOf("bottom")?n.insertBefore(t,n.firstChild):n.appendChild(t),this},removeFrom:function(i){var t=this.getPosition(),e=i._controlCorners[t];return e.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(i),this},toString:function(){return"[ViaMichelin.Api.MMap.Core.Control]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Control),JSEPackage("ViaMichelin.Api.MMap.Core.Control.Navigation"),ViaMichelin.Api.MMap.Core.Control.Navigation=function(i){this.options={},ViaMichelin.Api.Util.Object.mixAttributes(this.options,i),$isNotEmpty(this.options.custom)&&(this.options.Custom=this.options.custom,this.options.skin="Custom"),this._getAvailableSkin(this.options.skin,this.options.type)
},ViaMichelin.Api.MMap.Core.Control.Navigation.prototype={_container:null,_gap:0,_type:null,_skin:null,options:{skin:"Default"},_scroll:{Default:{scroll:{min:20,max:110},cursor:{height:20,width:24},size:{height:130,width:24},level:{min:2,max:16}}},_changeZoomIndicator:function(){if($isNotEmpty(this.zoomBarIndicator)&&$isNotEmpty(this._map)){var i=this.getZoomBarTools();this.zoomBarIndicator.style.top=i.scroll.min+(i.level.max-this._map.getZoom()<0?0:i.level.max-this._map.getZoom())*this.getZoomBarGap()-this.getZoomBarGap()+"px",this.zoomBarIndicator.style.display=""}},_getAvailableSkin:function(i,t){if(i==ViaMichelin.Api.Constants.Map.SKIN.DEFAULT)t==ViaMichelin.Api.Constants.Map.NAVIGATION.CONTROL.MINI&&(this._type=ViaMichelin.Api.Constants.Map.NAVIGATION.CONTROL.MINI),this._skin=i;else if(i==ViaMichelin.Api.Constants.Map.SKIN.MOBILE1||i==ViaMichelin.Api.Constants.Map.SKIN.MOBILE2||i==ViaMichelin.Api.Constants.Map.SKIN.MOBILE3)this._skin=i,this._type=ViaMichelin.Api.Constants.Map.NAVIGATION.CONTROL.MINI;else if("Custom"==i)return this._skin=i,!1;return!0},_getEvents:function(){return{zoomend:this._changeZoomIndicator}},_initEvents:function(i){var t,e=this._getEvents();i=i||"on";for(t in e)"on"===i?this._map.plugWire(t,e[t],this):this._map.unplugWire(t,e[t],this)},_initLayout:function(){var i=this;if(this._container=document.createElement("div"),this._container.className="ui-navigation-control",this._container.id="idNavigationControl"+this.uniqueIdSuffix,"Mobile1"===this._skin||"Mobile2"===this._skin||"Mobile3"===this._skin||this._skin===ViaMichelin.Api.Constants.Map.SKIN.DEFAULT&&this._type===ViaMichelin.Api.Constants.Map.NAVIGATION.CONTROL.MINI){this._container.className="ui-navigation-control-mini";var t=document.createElement("div");t.className="ui-navigation-minus button default",t.expando=this,t.onclick=function(){i._map.zoomOut()};var e=document.createElement("img");e.src=ViaMichelin.Api.Constants.System.ApiImgPath+"all/s.gif",t.appendChild(e);var n=document.createElement("div");n.className="ui-navigation-plus button default",n.expando=this,n.onclick=function(){i._map.zoomIn()};var o=document.createElement("img");o.src=ViaMichelin.Api.Constants.System.ApiImgPath+"all/s.gif",n.appendChild(o),this._container.appendChild(n),this._container.appendChild(t)}else if(this._skin===ViaMichelin.Api.Constants.Map.SKIN.DEFAULT){var a=document.createElement("img");a.src=ViaMichelin.Api.Constants.System.ApiImgPath+"all/s.gif",a.className="ui-navigation-control-bg",a.setAttribute("useMap","#zoomBarMap"+this.uniqueIdSuffix),this._container.appendChild(a);var r;try{r=document.createElement('<map name="zoomBarMap'+this.uniqueIdSuffix+'" />')}catch(s){r=document.createElement("map"),r.setAttribute("name","zoomBarMap"+this.uniqueIdSuffix)}r.id="idZoomBarMap"+this.uniqueIdSuffix,this._container.appendChild(r);var l=this._scroll[this._skin],h=l.scroll.min,c=l.level.max-l.level.min;this._gap=Math.floor((l.scroll.max-l.scroll.min)/c);for(var p=l.level.min,u=l.level.max,M=u;M>=p;M--){var m=document.createElement("area");m.expando=this,m.indice=M,m.setAttribute("shape","rect"),m.setAttribute("coords","0,"+h+","+l.size.width+","+(h+this.getZoomBarGap())),m.onclick=function(){i._map.setZoom(this.indice)},r.appendChild(m),h+=this.getZoomBarGap()}var d=document.createElement("area");d.expando=this,d.setAttribute("shape","rect"),d.setAttribute("coords","0,0,"+l.size.width+","+l.scroll.min),d.onclick=function(){i._map.zoomIn()};var _=document.createElement("area");_.expando=this,_.setAttribute("shape","rect"),_.setAttribute("coords","0,"+l.scroll.max+","+l.size.width+","+l.size.height),_.onclick=function(){i._map.zoomOut()},r.appendChild(d),r.appendChild(_),this.zoomBarIndicator=document.createElement("div"),this.zoomBarIndicator.className="ui-item-indicator",this.zoomBarIndicator.id="idZoomBarIndicator"+this.uniqueIdSuffix,this.zoomBarIndicator.src=ViaMichelin.Api.Constants.System.ApiImgPath+"all/s.gif",this._container.appendChild(this.zoomBarIndicator),$isNotEmpty(l.level)&&(ViaMichelin.Api.Util.DomEvent.on(this.zoomBarIndicator,"mousedown",this._onDown,this),this._changeZoomIndicator())}return this._container},_onDown:function(i){ViaMichelin.Api.Util.DomEvent.stopPropagation(i),ViaMichelin.Api.Util.Dom.disableImageDrag(),ViaMichelin.Api.Util.Dom.disableTextSelection(),this._startY=parseInt(this.zoomBarIndicator.style.top,10),this._lastY=this._startY,this.zoomBarIndicator.delta=1,this._mouseStartY=navigator.isMozilla?i.pageY:i.clientY+document.documentElement.scrollTop,navigator.isSafari&&(this._mouseStartY=i.pageY+document.body.offsetTop),ViaMichelin.Api.Util.DomEvent.on(document,"mousemove",this._onMove,this).on(document,"mouseup",this._onUp,this)},_onUp:function(){var i=this.getZoomBarTools().scroll.min-this.getZoomBarCursorSize().height/2;this._map.setZoom(16-parseInt((parseInt(this.zoomBarIndicator.style.top,10)-i)/this.getZoomBarGap(),10)),ViaMichelin.Api.Util.Dom.enableImageDrag(),ViaMichelin.Api.Util.Dom.enableTextSelection(),ViaMichelin.Api.Util.DomEvent.off(document,"mousemove",this._onMove,this).off(document,"mouseup",this._onUp,this)},_onMove:function(i){var t=navigator.isMozilla?i.pageY:i.clientY+document.documentElement.scrollTop;navigator.isSafari&&(t=i.pageY+document.body.offsetTop);var e=this.getZoomBarMin()-parseInt(this.getZoomBarCursorSize().height,10)/2,n=parseInt(this.getZoomBarMaxi(),10)-parseInt(this.getZoomBarCursorSize().height,10)/2,o=t-this._mouseStartY+this._startY;e>o&&(o=e),o>n&&(o=n),this.zoomBarIndicator.style.top=o+"px",ViaMichelin.Api.Util.DomEvent.preventDefault(i)},addTo:function(i){return this._map=i,this._initEvents("on"),this._initLayout()},getZoomBarTools:function(){return this._scroll[this._skin]},getZoomBarMin:function(){return this.getZoomBarTools().scroll.min},getZoomBarMaxi:function(){return this.getZoomBarTools().scroll.max},getZoomBarCursorSize:function(){return this.getZoomBarTools().cursor},getZoomBarGap:function(){return this._gap},remove:function(){this._initEvents("off"),this._container&&this._container.parentNode.removeChild(this._container),this._container=null},toString:function(){return"[ViaMichelin.Api.MMap.Core.Control.Navigation]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Control.Navigation),JSEPackage("ViaMichelin.Api.MMap.Core.Control.NavigationMode"),ViaMichelin.Api.MMap.Core.Control.NavigationMode=function(i){this.options={},ViaMichelin.Api.Util.Object.mixAttributes(this.options,i)},ViaMichelin.Api.MMap.Core.Control.NavigationMode.prototype={addTo:function(i){return this._map=i,this._initEvents("on"),this._initLayout()},remove:function(){this._initEvents("off"),this._container&&this._container.parentNode.removeChild(this._container),this._container=null},switchMapNavigationMode:function(){var i=this._map.getNavigationMode();this._map.setNavigationMode(i===ViaMichelin.Api.Constants.Map.NAVIGATION.DRAG?ViaMichelin.Api.Constants.Map.NAVIGATION.DRAGZOOM:ViaMichelin.Api.Constants.Map.NAVIGATION.DRAG)},_changeNavigationMode:function(){this._container.className=this._map.getNavigationMode()===ViaMichelin.Api.Constants.Map.NAVIGATION.DRAGZOOM?"ui-navigation-mode-hand":"ui-navigation-mode-selector"},_initLayout:function(){var i=this;return this._container=document.createElement("div"),this._container.className="ui-navigation-mode-selector",this._container.onclick=function(t){i.switchMapNavigationMode(),ViaMichelin.Api.Util.DomEvent.stopPropagation(t)},this._changeNavigationMode(),this._container},_getEvents:function(){return{navigationmodechange:this._changeNavigationMode}},_initEvents:function(i){var t,e=this._getEvents();i=i||"on";for(t in e)"on"===i?this._map.plugWire(t,e[t],this):this._map.unplugWire(t,e[t],this)}},ToJSEObject(ViaMichelin.Api.MMap.Core.Control.NavigationMode),JSEPackage("ViaMichelin.Api.MMap.Core.Control.VerticalBar"),ViaMichelin.Api.MMap.Core.Control.VerticalBar=function(i){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Control),this.initialize(i)},ViaMichelin.Api.MMap.Core.Control.VerticalBar.prototype={options:{position:"topleft"},_controls:null,_navigationControl:null,_navigationModeControl:null,initialize:function(i){ViaMichelin.Api.Util.Object.setOptions(this,i)},onAdd:function(i){return this._map=i,this._controls=document.createElement("div"),this._onAdd(),this._controls},_onAdd:function(){$isTrue(this.options.navigationModeControl)&&this.options.skin===ViaMichelin.Api.Constants.Map.SKIN.DEFAULT&&(this.options.navigationModeControlOptions.skin=this.options.skin,this._navigationModeControl=new ViaMichelin.Api.MMap.Core.Control.NavigationMode(this.options.navigationModeControlOptions),this._controls.appendChild(this._navigationModeControl.addTo(this._map))),$isTrue(this.options.navigationControl)&&(this.options.navigationControlOptions.skin=this.options.skin,this._navigationControl=new ViaMichelin.Api.MMap.Core.Control.Navigation(this.options.navigationControlOptions),this._controls.appendChild(this._navigationControl.addTo(this._map)))},onRemove:function(){this._onRemove()},_onRemove:function(){this._navigationModeControl&&(this._navigationModeControl.remove(),this._navigationModeControl=null),this._navigationControl&&(this._navigationControl.remove(),this._navigationControl=null)},refresh:function(){this._onRemove(),this._onAdd()},setOptions:function(i){ViaMichelin.Api.Util.Object.mixAttributes(this.options,i),this.refresh()},toString:function(){return"[ViaMichelin.Api.MMap.Core.Control.VerticalBar]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Control.VerticalBar),JSEPackage("ViaMichelin.Api.MMap.Core.Control.Zoom"),ViaMichelin.Api.MMap.Core.Control.Zoom=function(){this.prepare()},ViaMichelin.Api.MMap.Core.Control.Zoom.prototype={init:function(){},release:function(){},toString:function(){return"[ViaMichelin.Api.MMap.Core.Control.Zoom]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Control.Zoom),JSEPackage("ViaMichelin.Api.MMap.Core.Dom.Animation.Position"),ViaMichelin.Api.MMap.Core.Dom.Animation.Position=function(){ViaMichelin.Api.Util.Dom.TRANSITION||ViaMichelin.Api.Util.Core.extend(this,ViaMichelin.Api.MMap.Core.Dom.Animation.PositionTimer.prototype)},ViaMichelin.Api.MMap.Core.Dom.Animation.Position.prototype={_el:null,run:function(i,t,e,n){this.stop(),this._el=i,this._inProgress=!0,this._newPos=t,this.stimulate("start"),i.style[ViaMichelin.Api.Util.Dom.TRANSITION]="all "+(e||.25)+"s cubic-bezier(0,0,"+(n||.5)+",1)",ViaMichelin.Api.Util.DomEvent.on(i,ViaMichelin.Api.Util.Dom.TRANSITION_END,this._onTransitionEnd,this),ViaMichelin.Api.Util.Dom.setPosition(i,t),ViaMichelin.Api.Util.Core.falseFn(i.offsetWidth),this._stepTimer=setInterval(ViaMichelin.Api.Util.Core.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(this._newPos=this._getPos(),this._newPos&&ViaMichelin.Api.Util.Dom.setPosition(this._el,this._newPos),this._onTransitionEnd(),ViaMichelin.Api.Util.Core.falseFn(this._el.offsetWidth))},_onStep:function(){var i=this._getPos();return i?(this._el._mmap_pos=i,void this.stimulate("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var i,t,e,n=this._el,o=window.getComputedStyle(n);if(ViaMichelin.Api.Util.Browser.any3d){if(e=o[ViaMichelin.Api.Util.Dom.TRANSFORM].match(this._transformRe),!e)return;i=parseFloat(e[1]),t=parseFloat(e[2])}else i=parseFloat(o.left),t=parseFloat(o.top);return new ViaMichelin.Api.MMap.Core.Geometry.Point(i,t,!0)},_onTransitionEnd:function(){ViaMichelin.Api.Util.DomEvent.off(this._el,ViaMichelin.Api.Util.Dom.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[ViaMichelin.Api.Util.Dom.TRANSITION]="",this._el._mmap_pos=this._newPos,clearInterval(this._stepTimer),this.stimulate("step"),this.stimulate("end"))},toString:function(){return"[ViaMichelin.Api.MMap.Core.Dom.Animation.Position]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Dom.Animation.Position),JSEPackage("ViaMichelin.Api.MMap.Core.Dom.Animation.PositionTimer"),ViaMichelin.Api.MMap.Core.Dom.Animation.PositionTimer.prototype={run:function(i,t,e,n){this.stop(),this._el=i,this._inProgress=!0,this._duration=e||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=ViaMichelin.Api.Util.Dom.getPosition(i),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.stimulate("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=ViaMichelin.Api.Util.Core.requestAnimFrame(this._animate,this),this._step()},_step:function(){var i=+new Date-this._startTime,t=1e3*this._duration;t>i?this._runFrame(this._easeOut(i/t)):(this._runFrame(1),this._complete())},_runFrame:function(i){var t=this._startPos.add(this._offset.multiplyBy(i));ViaMichelin.Api.Util.Dom.setPosition(this._el,t),this.stimulate("step")},_complete:function(){ViaMichelin.Api.Util.Core.cancelAnimFrame(this._animId),this._inProgress=!1,this.stimulate("end")},_easeOut:function(i){return 1-Math.pow(1-i,this._easeOutPower)},toString:function(){return"[ViaMichelin.Api.MMap.Core.Dom.Animation.PositionTimer]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Dom.Animation.PositionTimer),JSEPackage("ViaMichelin.Api.MMap.Core.Dom.Draggable"),ViaMichelin.Api.MMap.Core.Dom.Draggable=function(i,t){this._element=i,this._dragStartTarget=t||i},ViaMichelin.Api.MMap.Core.Dom.Draggable.prototype={_element:null,_moved:!1,START:function(){return ViaMichelin.Api.Util.Browser.touch?["touchstart","mousedown"]:["mousedown"]},END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},enable:function(){this._enabled||(ViaMichelin.Api.Util.DomEvent.on(this._dragStartTarget,this.START().join(" "),this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ViaMichelin.Api.Util.DomEvent.off(this._dragStartTarget,this.START().join(" "),this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(i){if(this._moved=!1,!(i.shiftKey||1!==i.which&&1!==i.button&&!i.touches||(ViaMichelin.Api.Util.DomEvent.stopPropagation(i),ViaMichelin.Api.MMap.Core.Dom.Draggable._disabled||(ViaMichelin.Api.Util.Dom.disableImageDrag(),ViaMichelin.Api.Util.Dom.disableTextSelection(),this._moving)))){this.stimulate("down");var t=i.touches?i.touches[0]:i;this._startPoint=new ViaMichelin.Api.MMap.Core.Geometry.Point(t.clientX,t.clientY),this._startPos=this._newPos=ViaMichelin.Api.Util.Dom.getPosition(this._element),ViaMichelin.Api.Util.DomEvent.on(document,this.MOVE[i.type],this._onMove,this).on(document,this.END[i.type],this._onUp,this)}},_onMove:function(i){if(i.touches&&i.touches.length>1)return void(this._moved=!0);var t=i.touches&&1===i.touches.length?i.touches[0]:i,e=new ViaMichelin.Api.MMap.Core.Geometry.Point(t.clientX,t.clientY),n=e.subtract(this._startPoint);(n.x||n.y)&&(ViaMichelin.Api.Util.Browser.touch&&Math.abs(n.x)+Math.abs(n.y)<3||(ViaMichelin.Api.Util.DomEvent.preventDefault(i),this._moved||(this.stimulate("dragstart"),this._moved=!0,this._startPos=ViaMichelin.Api.Util.Dom.getPosition(this._element).subtract(n),ViaMichelin.Api.Util.Dom.addClass(document.body,"mmap-dragging"),this._lastTarget=i.target||i.srcElement,ViaMichelin.Api.Util.Dom.addClass(this._lastTarget,"mmap-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,ViaMichelin.Api.Util.Core.cancelAnimFrame(this._animRequest),this._animRequest=ViaMichelin.Api.Util.Core.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.stimulate("predrag"),ViaMichelin.Api.Util.Dom.setPosition(this._element,this._newPos),this.stimulate("drag")},_onUp:function(){ViaMichelin.Api.Util.Dom.removeClass(document.body,"mmap-dragging"),this._lastTarget&&(ViaMichelin.Api.Util.Dom.removeClass(this._lastTarget,"mmap-drag-target"),this._lastTarget=null);for(var i in this.MOVE)ViaMichelin.Api.Util.DomEvent.off(document,this.MOVE[i],this._onMove,this).off(document,this.END[i],this._onUp,this);ViaMichelin.Api.Util.Dom.enableImageDrag(),ViaMichelin.Api.Util.Dom.enableTextSelection(),this._moved&&this._moving&&(ViaMichelin.Api.Util.Core.cancelAnimFrame(this._animRequest),this.stimulate("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}},ToJSEObject(ViaMichelin.Api.MMap.Core.Dom.Draggable),JSEPackage("ViaMichelin.Api.MMap.Core.Geo.Crs"),ViaMichelin.Api.MMap.Core.Geo.Crs={getProjectedBounds:function(i){if(this.infinite)return null;var t=this.projection.bounds(),e=this.scale(i),n=this.transformation.transform(t.min,e),o=this.transformation.transform(t.max,e);return ViaMichelin.Api.MMap.Core.Geometry.bounds(n,o)},latLonToPoint:function(i,t){var e=this.projection.project(i),n=this.scale(t);return this.transformation._transform(e,n)},pointToLatLon:function(i,t){var e=this.scale(t),n=this.transformation.untransform(i,e);return this.projection.unproject(n)},project:function(i){return this.projection.project(i)},unproject:function(i){return this.projection.unproject(i)},scale:function(i){return 256*Math.pow(2,i)},wrapLatLon:function(i){var t=this.wrapLon?ViaMichelin.Api.Util.Core.wrapNum(i.lon,this.wrapLon,!0):i.lon,e=this.wrapLat?ViaMichelin.Api.Util.Core.wrapNum(i.lat,this.wrapLat,!0):i.lat;return ViaMichelin.Api.MMap.Core.Geo.latLon(e,t)}},ToJSEObject(ViaMichelin.Api.MMap.Core.Geo.Crs),JSEPackage("ViaMichelin.Api.MMap.Core.Geo.Crs.EPSG3857"),ViaMichelin.Api.MMap.Core.Geo.Crs.EPSG3857=function(){this.extend(ViaMichelin.Api.MMap.Core.Geo.Crs.Earth),this.projection=ViaMichelin.Api.MMap.Core.Geo.Projection.SphericalMercator,this.transformation=function(){var i=.5/(Math.PI*ViaMichelin.Api.MMap.Core.Geo.Projection.SphericalMercator.R);return new ViaMichelin.Api.MMap.Core.Geometry.Transformation(i,.5,-i,.5)}()},ViaMichelin.Api.MMap.Core.Geo.Crs.EPSG3857.prototype={code:"EPSG:3857",projection:"",transformation:""},ToJSEObject(ViaMichelin.Api.MMap.Core.Geo.Crs.EPSG3857),JSEPackage("ViaMichelin.Api.MMap.Core.Geo.Crs.Earth"),ViaMichelin.Api.MMap.Core.Geo.Crs.Earth=function(){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Geo.Crs)},ViaMichelin.Api.MMap.Core.Geo.Crs.Earth.prototype={wrapLon:[-180,180],R:6378137,distance:function(i,t){var e=Math.PI/180,n=i.lat*e,o=t.lat*e,a=Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos((t.lon-i.lon)*e);return this.R*Math.acos(Math.min(a,1))}},ToJSEObject(ViaMichelin.Api.MMap.Core.Geo.Crs.Earth),JSEPackage("ViaMichelin.Api.MMap.Core.Geo.LatLon"),ViaMichelin.Api.MMap.Core.Geo.LatLon=function(i,t,e){if(i=parseFloat(i),t=parseFloat(t),isNaN(i)||isNaN(t))throw new Error("Invalid LatLon object: ("+i+", "+t+")");this.lat=i,this.lon=t,void 0!==e&&(this.alt=parseFloat(e))},ViaMichelin.Api.MMap.Core.Geo.LatLon.prototype={equals:function(i,t){if(!i)return!1;i=ViaMichelin.Api.MMap.Core.Geo.latLon(i);var e=Math.max(Math.abs(this.lat-i.lat),Math.abs(this.lon-i.lon));return(void 0===t?1e-9:t)>=e},toString:function(i){return"LatLon("+ViaMichelin.Api.Util.Core.formatNum(this.lat,i)+", "+ViaMichelin.Api.Util.Core.formatNum(this.lon,i)+")"},distanceTo:function(i){i=ViaMichelin.Api.MMap.Core.Geo.latLon(i);var t=6378137,e=Math.PI/180,n=(i.lat-this.lat)*e,o=(i.lon-this.lon)*e,a=this.lat*e,r=i.lat*e,s=Math.sin(n/2),l=Math.sin(o/2),h=s*s+l*l*Math.cos(a)*Math.cos(r);return 2*t*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))}},ViaMichelin.Api.MMap.Core.Geo.latLon=function(i,t){return i instanceof ViaMichelin.Api.MMap.Core.Geo.LatLon?i:ViaMichelin.Api.Util.Core.isArray(i)?"number"==typeof i[0]||"string"==typeof i[0]?new ViaMichelin.Api.MMap.Core.Geo.LatLon(i[0],i[1],i[2]):null:void 0===i||null===i?i:"object"==typeof i&&"lat"in i?new ViaMichelin.Api.MMap.Core.Geo.LatLon(i.lat,i.lon):void 0===t?null:new ViaMichelin.Api.MMap.Core.Geo.LatLon(i,t)},ToJSEObject(ViaMichelin.Api.MMap.Core.Geo.LatLon),JSEPackage("ViaMichelin.Api.MMap.Core.Geo.LatLonBounds"),ViaMichelin.Api.MMap.Core.Geo.LatLonBounds=function(i,t){if(i)for(var e=t?[i,t]:i,n=0,o=e.length;o>n;n++)this.extend(e[n])},ViaMichelin.Api.MMap.Core.Geo.LatLonBounds.prototype={extend:function(i){var t,e,n=this._southWest,o=this._northEast;if(i instanceof ViaMichelin.Api.MMap.Core.Geo.LatLon)t=i,e=i;else{if(!(i instanceof ViaMichelin.Api.MMap.Core.Geo.LatLonBounds))return i?this.extend(ViaMichelin.Api.MMap.Core.Geo.latLon(i)||ViaMichelin.Api.MMap.Core.Geo.latLonBounds(i)):this;if(t=i._southWest,e=i._northEast,!t||!e)return this}return n||o?(n.lat=Math.min(t.lat,n.lat),n.lon=n.lon=Math.min(t.lon,n.lon),o.lat=Math.max(e.lat,o.lat),o.lon=o.lon=Math.max(e.lon,o.lon)):(this._southWest=new ViaMichelin.Api.MMap.Core.Geo.LatLon(t.lat,t.lon),this._northEast=new ViaMichelin.Api.MMap.Core.Geo.LatLon(e.lat,e.lon)),this},pad:function(i){var t=this._southWest,e=this._northEast,n=Math.abs(t.lat-e.lat)*i,o=Math.abs(t.lon-e.lon)*i;return new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds(new ViaMichelin.Api.MMap.Core.Geo.LatLon(t.lat-n,t.lon-o),new ViaMichelin.Api.MMap.Core.Geo.LatLon(e.lat+n,e.lon+o))},getCenter:function(){return new ViaMichelin.Api.MMap.Core.Geo.LatLon((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lon+this._northEast.lon)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new ViaMichelin.Api.MMap.Core.Geo.LatLon(this.getNorth(),this.getWest())},getSouthEast:function(){return new ViaMichelin.Api.MMap.Core.Geo.LatLon(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lon},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lon},getNorth:function(){return this._northEast.lat},contains:function(i){i="number"==typeof i[0]||i instanceof ViaMichelin.Api.MMap.Core.Geo.LatLon?ViaMichelin.Api.MMap.Core.Geo.latLon(i):ViaMichelin.Api.MMap.Core.Geo.latLonBounds(i);var t,e,n=this._southWest,o=this._northEast;return i instanceof ViaMichelin.Api.MMap.Core.Geo.LatLonBounds?(t=i.getSouthWest(),e=i.getNorthEast()):t=e=i,t.lat>=n.lat&&e.lat<=o.lat&&t.lon>=n.lon&&e.lon<=o.lon},constraint:function(i){function t(i,t){return t.lat=t.lat>=i.getNorth()?i.getNorth():t.lat<=i.getSouth()?i.getSouth():t.lat,t.lon=t.lon>=i.getEast()?i.getEast():t.lon<=i.getWest()?i.getWest():t.lon,t}var e,n;return i=ViaMichelin.Api.MMap.Core.Geo.latLonBounds(i),e=t(this,i.getSouthWest()),n=t(this,i.getNorthEast()),new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds(e,n)},intersects:function(i){i=ViaMichelin.Api.MMap.Core.Geo.latLonBounds(i);var t=this._southWest,e=this._northEast,n=i.getSouthWest(),o=i.getNorthEast(),a=o.lat>=t.lat&&n.lat<=e.lat,r=o.lon>=t.lon&&n.lon<=e.lon;return a&&r},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},toString:function(){return"LatLonBounds [ sw: ["+this.getSouthWest().lat+","+this.getSouthWest().lon+"], ne: ["+this.getNorthEast().lat+","+this.getNorthEast().lon+"] ]"},equals:function(i){return i?(i=ViaMichelin.Api.MMap.Core.Geo.latLonBounds(i),this._southWest.equals(i.getSouthWest())&&this._northEast.equals(i.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},ViaMichelin.Api.MMap.Core.Geo.latLonBounds=function(i,t){return!i||i instanceof ViaMichelin.Api.MMap.Core.Geo.LatLonBounds?i:new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds(i,t)},ToJSEObject(ViaMichelin.Api.MMap.Core.Geo.LatLonBounds),JSEPackage("ViaMichelin.Api.MMap.Core.Geo.Projection"),ViaMichelin.Api.MMap.Core.Geo.Projection={MAX_LATITUDE:85.0511287798,RADIUS:6378137,project:function(i){var t=Math.PI/180,e=this.MAX_LATITUDE,n=this.RADIUS*i.lon*t,o=Math.max(Math.min(e,i.lat),-e)*t;return o=this.RADIUS*Math.log(Math.tan(Math.PI/4+o/2)),new ViaMichelin.Api.MMap.Core.Geometry.Point(n,o)},unproject:function(i){var t=180/Math.PI,e=i.x*t/this.RADIUS,n=(2*Math.atan(Math.exp(i.y/this.RADIUS))-Math.PI/2)*t;return new ViaMichelin.Api.MMap.Core.Geo.LatLon(n,e)},bounds:function(){var i=6378137*Math.PI;return ViaMichelin.Api.MMap.Core.Geometry.bounds([-i,-i],[i,i])}},ToJSEObject(ViaMichelin.Api.MMap.Core.Geo.Projection),JSEPackage("ViaMichelin.Api.MMap.Core.Geo.Projection.SphericalMercator"),ViaMichelin.Api.MMap.Core.Geo.Projection.SphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(i){var t=Math.PI/180,e=this.MAX_LATITUDE,n=this.R*i.lon*t,o=Math.max(Math.min(e,i.lat),-e)*t;return o=this.R*Math.log(Math.tan(Math.PI/4+o/2)),new ViaMichelin.Api.MMap.Core.Geometry.Point(n,o)},unproject:function(i){var t=180/Math.PI,e=i.x*t/this.R,n=(2*Math.atan(Math.exp(i.y/this.R))-Math.PI/2)*t;return new ViaMichelin.Api.MMap.Core.Geo.LatLon(n,e)},bounds:function(){var i=6378137*Math.PI;return ViaMichelin.Api.MMap.Core.Geometry.bounds([-i,-i],[i,i])}},ToJSEObject(ViaMichelin.Api.MMap.Core.Geo.Projection.SphericalMercator),JSEPackage("ViaMichelin.Api.MMap.Core.Geometry.Bounds"),ViaMichelin.Api.MMap.Core.Geometry.Bounds=function(i,t){if(i)for(var e=t?[i,t]:i,n=0,o=e.length;o>n;n++)this.extend(e[n])},ViaMichelin.Api.MMap.Core.Geometry.Bounds.prototype={extend:function(i){return i=ViaMichelin.Api.MMap.Core.Geometry.point(i),this.min||this.max?(this.min.x=Math.min(i.x,this.min.x),this.max.x=Math.max(i.x,this.max.x),this.min.y=Math.min(i.y,this.min.y),this.max.y=Math.max(i.y,this.max.y)):(this.min=i.clone(),this.max=i.clone()),this},getCenter:function(i){return new ViaMichelin.Api.MMap.Core.Geometry.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,i)},getBottom:function(){return this.max.y},getBottomLeft:function(){return new ViaMichelin.Api.MMap.Core.Geometry.Point(this.min.x,this.max.y)},getLeft:function(){return this.min.x},getTop:function(){return this.min.y},getTopRight:function(){return new ViaMichelin.Api.MMap.Core.Geometry.Point(this.max.x,this.min.y)},getRight:function(){return this.max.x},getSize:function(){return this.max.subtract(this.min)},contains:function(i){var t,e;return i="number"==typeof i[0]||i instanceof ViaMichelin.Api.MMap.Core.Geometry.Point?ViaMichelin.Api.MMap.Core.Geometry.point(i):ViaMichelin.Api.MMap.Core.Geometry.bounds(i),i instanceof ViaMichelin.Api.MMap.Core.Geometry.Bounds?(t=i.min,e=i.max):t=e=i,t.x>=this.min.x&&e.x<=this.max.x&&t.y>=this.min.y&&e.y<=this.max.y},intersects:function(i){i=ViaMichelin.Api.MMap.Core.Geometry.bounds(i);var t=this.min,e=this.max,n=i.min,o=i.max,a=o.x>=t.x&&n.x<=e.x,r=o.y>=t.y&&n.y<=e.y;return a&&r},isValid:function(){return!(!this.min||!this.max)},multiplyBy:function(i){return this.clone()._multiplyBy(i)},_multiplyBy:function(i){var t=this.getCenter();return this.min=t.add(this.min.subtract(t).multiplyBy(i)).floor(),this.max=t.add(this.max.subtract(t).multiplyBy(i)).ceil(),this},clone:function(){return new ViaMichelin.Api.MMap.Core.Geometry.Bounds([this.min.x,this.min.y],[this.max.x,this.max.y])},toString:function(){return"Bounds [ min: ["+this.min.x+","+this.min.y+"], max: ["+this.max.x+","+this.max.y+"] ]"}},ViaMichelin.Api.MMap.Core.Geometry.bounds=function(i,t){return!i||i instanceof ViaMichelin.Api.MMap.Core.Geometry.Bounds?i:new ViaMichelin.Api.MMap.Core.Geometry.Bounds(i,t)},ToJSEObject(ViaMichelin.Api.MMap.Core.Geometry.Bounds),JSEPackage("ViaMichelin.Api.MMap.Core.Geometry.LineUtil"),ViaMichelin.Api.MMap.Core.Geometry.LineUtil={simplify:function(i,t){if(!t||!i.length)return i.slice();var e=t*t;return i=this._reducePoints(i,e),i=this._simplifyDP(i,e)},pointToSegmentDistance:function(i,t,e){return Math.sqrt(this._sqClosestPointOnSegment(i,t,e,!0))},closestPointOnSegment:function(i,t,e){return this._sqClosestPointOnSegment(i,t,e,!1)},_simplifyDP:function(i,t){var e=i.length,n=typeof Uint8Array!=void 0+""?Uint8Array:Array,o=new n(e);o[0]=o[e-1]=1,this._simplifyDPStep(i,o,t,0,e-1);var a,r=[];for(a=0;e>a;a++)o[a]&&r.push(i[a]);return r},_simplifyDPStep:function(i,t,e,n,o){var a,r,s,l=0;for(r=n+1;o-1>=r;r++)s=this._sqClosestPointOnSegment(i[r],i[n],i[o],!0),s>l&&(a=r,l=s);l>e&&(t[a]=1,this._simplifyDPStep(i,t,e,n,a),this._simplifyDPStep(i,t,e,a,o))},_reducePoints:function(i,t){for(var e=[i[0]],n=1,o=0,a=i.length;a>n;n++)this._sqDist(i[n],i[o])>t&&(e.push(i[n]),o=n);return a-1>o&&e.push(i[a-1]),e},clipSegment:function(i,t,e,n){var o,a,r,s=n?this._lastCode:this._getBitCode(i,e),l=this._getBitCode(t,e);for(this._lastCode=l;;){if(!(s|l))return[i,t];if(s&l)return!1;o=s||l,a=this._getEdgeIntersection(i,t,o,e),r=this._getBitCode(a,e),o===s?(i=a,s=r):(t=a,l=r)}},_getEdgeIntersection:function(i,t,e,n){var o,a,r=t.x-i.x,s=t.y-i.y,l=n.min,h=n.max;return 8&e?(o=i.x+r*(h.y-i.y)/s,a=h.y):4&e?(o=i.x+r*(l.y-i.y)/s,a=l.y):2&e?(o=h.x,a=i.y+s*(h.x-i.x)/r):1&e&&(o=l.x,a=i.y+s*(l.x-i.x)/r),new ViaMichelin.Api.MMap.Core.Geometry.Point(o,a,!0)},_getBitCode:function(i,t){var e=0;return i.x<t.min.x?e|=1:i.x>t.max.x&&(e|=2),i.y<t.min.y?e|=4:i.y>t.max.y&&(e|=8),e},_sqDist:function(i,t){var e=t.x-i.x,n=t.y-i.y;return e*e+n*n},_sqClosestPointOnSegment:function(i,t,e,n){var o,a=t.x,r=t.y,s=e.x-a,l=e.y-r,h=s*s+l*l;return h>0&&(o=((i.x-a)*s+(i.y-r)*l)/h,o>1?(a=e.x,r=e.y):o>0&&(a+=s*o,r+=l*o)),s=i.x-a,l=i.y-r,n?s*s+l*l:new ViaMichelin.Api.MMap.Core.Geometry.Point(a,r)},toString:function(){return"[ViaMichelin.Api.MMap.Core.Geometry.LineUtil]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Geometry.LineUtil),JSEPackage("ViaMichelin.Api.MMap.Core.Geometry.Point"),ViaMichelin.Api.MMap.Core.Geometry.Point=function(i,t,e){this.x=e?Math.round(i):i,this.y=e?Math.round(t):t},ViaMichelin.Api.MMap.Core.Geometry.Point.prototype={add:function(i){return this.clone()._add(ViaMichelin.Api.MMap.Core.Geometry.point(i))},_add:function(i){return this.x+=i.x,this.y+=i.y,this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},clone:function(){return new ViaMichelin.Api.MMap.Core.Geometry.Point(this.x,this.y,!1)},contains:function(i){return i=ViaMichelin.Api.MMap.Core.Geometry.point(i),Math.abs(i.x)<=Math.abs(this.x)&&Math.abs(i.y)<=Math.abs(this.y)},distanceTo:function(i){i=ViaMichelin.Api.MMap.Core.Geometry.point(i);var t=i.x-this.x,e=i.y-this.y;return Math.sqrt(t*t+e*e)},divideBy:function(i){return this.clone()._divideBy(i)},_divideBy:function(i){return this.x/=i,this.y/=i,this},equals:function(i){return i=ViaMichelin.Api.MMap.Core.Geometry.point(i),i.x===this.x&&i.y===this.y},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},multiplyBy:function(i){return this.clone()._multiplyBy(i)},_multiplyBy:function(i){return this.x*=i,this.y*=i,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},subtract:function(i){return this.clone()._subtract(ViaMichelin.Api.MMap.Core.Geometry.point(i))},_subtract:function(i){return this.x-=i.x,this.y-=i.y,this},toString:function(){return"Point("+ViaMichelin.Api.Util.Core.formatNum(this.x)+", "+ViaMichelin.Api.Util.Core.formatNum(this.y)+")"}},ViaMichelin.Api.MMap.Core.Geometry.point=function(i,t,e){return i instanceof ViaMichelin.Api.MMap.Core.Geometry.Point?i:ViaMichelin.Api.Util.Core.isArray(i)?new ViaMichelin.Api.MMap.Core.Geometry.Point(i[0],i[1]):void 0===i||null===i?i:new ViaMichelin.Api.MMap.Core.Geometry.Point(i,t,e)},ToJSEObject(ViaMichelin.Api.MMap.Core.Geometry.Point),JSEPackage("ViaMichelin.Api.MMap.Core.Geometry.PolyUtil"),ViaMichelin.Api.MMap.Core.Geometry.PolyUtil={clipPolygon:function(i,t){var e,n,o,a,r,s,l,h,c,p=[1,4,2,8],u=ViaMichelin.Api.MMap.Core.Geometry.LineUtil;for(n=0,l=i.length;l>n;n++)i[n]._code=u._getBitCode(i[n],t);for(a=0;4>a;a++){for(h=p[a],e=[],n=0,l=i.length,o=l-1;l>n;o=n++)r=i[n],s=i[o],r._code&h?s._code&h||(c=u._getEdgeIntersection(s,r,h,t),c._code=u._getBitCode(c,t),e.push(c)):(s._code&h&&(c=u._getEdgeIntersection(s,r,h,t),c._code=u._getBitCode(c,t),e.push(c)),e.push(r));i=e}return i}},ToJSEObject(ViaMichelin.Api.MMap.Core.Geometry.PolyUtil),JSEPackage("ViaMichelin.Api.MMap.Core.Geometry.Transformation"),ViaMichelin.Api.MMap.Core.Geometry.Transformation=function(i,t,e,n){this._a=i,this._b=t,this._c=e,this._d=n},ViaMichelin.Api.MMap.Core.Geometry.Transformation.prototype={transform:function(i,t){return this._transform(i.clone(),t)
},_transform:function(i,t){return t=t||1,i.x=t*(this._a*i.x+this._b),i.y=t*(this._c*i.y+this._d),i},untransform:function(i,t){return t=t||1,new ViaMichelin.Api.MMap.Core.Geometry.Point((i.x/t-this._b)/this._a,(i.y/t-this._d)/this._c)}},ToJSEObject(ViaMichelin.Api.MMap.Core.Geometry.Transformation),JSEPackage("ViaMichelin.Api.MMap.Core.Layer"),ViaMichelin.Api.MMap.Core.Layer=function(){ViaMichelin.Api.Util.Core.extend(this,ViaMichelin.Api.MMap.Core.Layer.LayerPopup.prototype)},ViaMichelin.Api.MMap.Core.Layer.prototype={_map:null,options:{pane:"overlayPane"},addTo:function(i){return i.addLayer(this),this},beforeAdd:function(){},remove:function(){return this.removeFrom(this._map)},removeFrom:function(i){return i&&i.removeLayer(this),this},getPane:function(i){return this._map.getPane(i?this.options[i]||i:this.options.pane)},_layerAdd:function(i){var t;if(this._map?t=this._map:i&&(t=i.target),t&&t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.onAdd(t),this.getAttribution&&this._map.attributionControl&&this._map.attributionControl.addAttribution(this.getAttribution()),this.getEvents){var e,n=this.getEvents();for(e in n)t.plugWire(e,n[e],this)}this.stimulate("add"),t.stimulate("layeradd",{layer:this})}}},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.LayerGroup"),ViaMichelin.Api.MMap.Core.Layer.LayerGroup=function(i){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer),this.initialize(i)},ViaMichelin.Api.MMap.Core.Layer.LayerGroup.prototype={bringToBack:function(){},initialize:function(i){this._layers={};var t,e;if(i)for(t=0,e=i.length;e>t;t++)this.addLayer(i[t])},addLayer:function(i){var t=this.getLayerId(i);return this._layers[t]=i,this._map&&this._map.addLayer(i),this},removeLayer:function(i){var t=i in this._layers?i:this.getLayerId(i);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(i){return!!i&&(i in this._layers||this.getLayerId(i)in this._layers)},clearLayers:function(){for(var i in this._layers)this._layers.hasOwnProperty(i)&&this.removeLayer(this._layers[i]);return this},invoke:function(i){var t,e,n=Array.prototype.slice.call(arguments,1);for(t in this._layers)this._layers.hasOwnProperty(t)&&(e=this._layers[t],e[i]&&e[i].apply(e,n));return this},onAdd:function(i){for(var t in this._layers)this._layers.hasOwnProperty(t)&&i.addLayer(this._layers[t])},onRemove:function(i){for(var t in this._layers)this._layers.hasOwnProperty(t)&&i.removeLayer(this._layers[t])},eachLayer:function(i,t){for(var e in this._layers)this._layers.hasOwnProperty(e)&&i.call(t,this._layers[e]);return this},getLayer:function(i){return this._layers[i]},getLayers:function(){var i=[];for(var t in this._layers)this._layers.hasOwnProperty(t)&&i.push(this._layers[t]);return i},setZIndex:function(i){return this.invoke("setZIndex",i)},getLayerId:function(i){return ViaMichelin.Api.Util.Core.stamp(i)},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.LayerGroup]"}},ViaMichelin.Api.MMap.Core.Layer.layerGroup=function(i){return new ViaMichelin.Api.MMap.Core.Layer.LayerGroup(i)},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.LayerGroup),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.LayerPopup"),ViaMichelin.Api.MMap.Core.Layer.LayerPopup.prototype={bindPopup:function(i,t){return i instanceof ViaMichelin.Api.MMap.Core.Layer.Popup?(this._popup=i,i._source=this):((!this._popup||t)&&(this._popup=new ViaMichelin.Api.MMap.Core.Layer.Popup(t,this)),this._popup.setContent(i)),this._popupHandlersAdded||(this.plugWire("click",this._openPopup,this),this.plugWire("remove",this.closePopup,this),this.plugWire("move",this._movePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.unplugWire("click",this._openPopup,this),this.unplugWire("remove",this.closePopup,this),this.unplugWire("move",this._movePopup,this),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(i){return this._popup&&this._map&&this._map.openPopup(this._popup,i||this._latlon||this.getCenter()),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._map?this.closePopup():this.openPopup()),this},setPopupContent:function(i){return this._popup&&this._popup.setContent(i),this},getPopup:function(){return this._popup},_openPopup:function(i){this._map.openPopup(this._popup,i.latlon)},_movePopup:function(i){this._popup.setLatLon(i.latlon)}},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.LayerPopup),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Marker"),ViaMichelin.Api.MMap.Core.Layer.Marker=function(i,t){this.extend(ViaMichelin.Api.MMap.Core.Layer),this._openPopup=this.togglePopup,this.initialize(i,t)},ViaMichelin.Api.MMap.Core.Layer.Marker.prototype={_latlon:{},options:null,_setOptions:function(i){var t={pane:"markerPane",interactive:!0,keyboard:!0,zIndexOffset:0,opacity:1,riseOffset:250};this.options={},ViaMichelin.Api.Util.Object.mixAttributes(this.options,ViaMichelin.Api.MMap.Core.Layer.prototype.options),this.options=t,this.options.icon=new ViaMichelin.Api.MMap.Core.Layer.Marker.Icon.Default,ViaMichelin.Api.Util.Object.mixAttributes(this.options,i)},initialize:function(i,t){this._setOptions(t),this._latlon=ViaMichelin.Api.MMap.Core.Geo.latLon(i)},onAdd:function(i){this._zoomAnimated=this._zoomAnimated&&i.options.markerZoomAnimation,this._initIcon(),this.update()},onRemove:function(){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow()},getBounds:function(){return new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds(this.getLatLon(),this.getLatLon())},getEvents:function(){var i={viewreset:this.update};return this._zoomAnimated&&(i.zoomanim=this._animateZoom),i},getLatLon:function(){return this._latlon},setLatLon:function(i){var t=this._latlon;return this._latlon=ViaMichelin.Api.MMap.Core.Geo.latLon(i),this.update(),this.stimulate("move",{oldLatLon:t,latlon:this._latlon}),this},setZIndexOffset:function(i){return this.options.zIndexOffset=i,this.update()},getIcon:function(){return this._icon},setIcon:function(i){return this.options.icon=i,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},update:function(){if(this._icon){var i=this._map.latLonToLayerPoint(this._latlon).round();this._setPos(i)}return this},_initIcon:function(){var i=this.options,t="mmap-zoom-"+(this._zoomAnimated?"animated":"hide"),e=i.icon.createIcon(this._icon),n=!1;e!==this._icon&&(this._icon&&this._removeIcon(),n=!0,i.title&&(e.title=i.title),i.alt&&(e.alt=i.alt)),ViaMichelin.Api.Util.Dom.addClass(e,t),i.keyboard&&(e.tabIndex="0"),this._icon=e,this._initInteraction(),i.riseOnHover&&ViaMichelin.Api.Util.DomEvent.on(e,{mouseover:this._bringToFront,mouseout:this._resetZIndex},this);var o=i.icon.createShadow(this._shadow),a=!1;o!==this._shadow&&(this._removeShadow(),a=!0),o&&ViaMichelin.Api.Util.Dom.addClass(o,t),this._shadow=o,i.opacity<1&&this._updateOpacity(),n&&this.getPane().appendChild(this._icon),o&&a&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&ViaMichelin.Api.Util.DomEvent.off(this._icon,{mouseover:this._bringToFront,mouseout:this._resetZIndex},this),ViaMichelin.Api.Util.Dom.remove(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ViaMichelin.Api.Util.Dom.remove(this._shadow),this._shadow=null},_setPos:function(i){ViaMichelin.Api.Util.Dom.setPosition(this._icon,i),this._shadow&&ViaMichelin.Api.Util.Dom.setPosition(this._shadow,i),this._zIndex=i.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(i){this._icon.style.zIndex=this._zIndex+i},_animateZoom:function(i){var t=this._map._latLonToNewLayerPoint(this._latlon,i.zoom,i.center).round();this._setPos(t)},_initInteraction:function(){this.options.interactive&&(ViaMichelin.Api.Util.Dom.addClass(this._icon,"mmap-interactive"),ViaMichelin.Api.Util.DomEvent.on(this._icon,"click dblclick mousedown mouseup mouseover mouseout contextmenu keypress",this._fireMouseEvent,this),ViaMichelin.Api.MMap.Core.Layer.Marker.Drag&&(this.dragging&&this.dragging.disable(),this.dragging=new ViaMichelin.Api.MMap.Core.Layer.Marker.Drag(this),this.options.draggable&&this.dragging.enable()))},_fireMouseEvent:function(i,t){"mousedown"===i.type&&ViaMichelin.Api.Util.DomEvent.preventDefault(i),"keypress"===i.type&&13===i.keyCode&&(t="click"),this._map&&this._map._fireMouseEvent(this,i,t,!0,this._latlon)},setOpacity:function(i){return this.options.opacity=i,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var i=this.options.opacity;ViaMichelin.Api.Util.Dom.setOpacity(this._icon,i),this._shadow&&ViaMichelin.Api.Util.Dom.setOpacity(this._shadow,i)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Marker]"},bindPopup:function(i,t){var e=ViaMichelin.Api.MMap.Core.Geometry.point(this.options.icon.options.popupAnchor||[0,0]).add(ViaMichelin.Api.MMap.Core.Layer.Popup.prototype.options.offset);return t=ViaMichelin.Api.Util.Core.extend({offset:e},t),ViaMichelin.Api.MMap.Core.Layer.prototype.bindPopup.call(this,i,t)},_openPopup:function(){return ViaMichelin.Api.MMap.Core.Layer.prototype.togglePopup.call(this)}},ViaMichelin.Api.MMap.Core.Layer.marker=function(i,t){return new ViaMichelin.Api.MMap.Core.Layer.Marker(i,t)},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Marker),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Marker.DivIcon"),ViaMichelin.Api.MMap.Core.Layer.Marker.DivIcon=function(i){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer.Marker.Icon,i)},ViaMichelin.Api.MMap.Core.Layer.Marker.DivIcon.prototype={options:{iconSize:[12,12],className:"mmap-div-icon",html:!1},createIcon:function(i){var t=i&&"DIV"===i.tagName?i:document.createElement("div"),e=this.options;return t.innerHTML=e.html!==!1?e.html:"",e.bgPos&&(t.style.backgroundPosition=-e.bgPos.x+"px "+-e.bgPos.y+"px"),this._setIconStyles(t,"icon"),t},createShadow:function(){return null},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Marker.DivIcon]"}},ViaMichelin.Api.MMap.Core.Layer.Marker.divIcon=function(i){return new ViaMichelin.Api.MMap.Core.Layer.Marker.DivIcon(i)},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Marker.DivIcon),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Marker.Icon"),ViaMichelin.Api.MMap.Core.Layer.Marker.Icon=function(i){i&&(this.options=i)},ViaMichelin.Api.MMap.Core.Layer.Marker.Icon.prototype={options:{},createIcon:function(i){return this._createIcon("icon",i)},createShadow:function(i){return this._createIcon("shadow",i)},_createIcon:function(i,t){var e=this._getIconUrl(i);if(!e){if("icon"===i)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(e,t&&"IMG"===t.tagName?t:null);return this._setIconStyles(n,i),n},_setIconStyles:function(i,t){var e=this.options,n=ViaMichelin.Api.MMap.Core.Geometry.point(e[t+"Size"]),o=ViaMichelin.Api.MMap.Core.Geometry.point("shadow"===t&&e.shadowAnchor||e.iconAnchor||n&&n.divideBy(2,!0));i.className="mmap-marker-"+t+" "+(e.className||""),o&&(i.style.marginLeft=-o.x+"px",i.style.marginTop=-o.y+"px"),n&&(i.style.width=n.x+"px",i.style.height=n.y+"px")},_createImg:function(i,t){return t=t||document.createElement("img"),t.src=i,t},_getIconUrl:function(i){return ViaMichelin.Api.Util.Browser.retina&&this.options[i+"RetinaUrl"]||this.options[i+"Url"]},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Marker.Icon]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Marker.Icon),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Marker.Icon.Default"),ViaMichelin.Api.MMap.Core.Layer.Marker.Icon.Default=function(){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer.Marker.Icon)},ViaMichelin.Api.MMap.Core.Layer.Marker.Icon.Default.prototype={options:{iconSize:[17,26],iconAnchor:[8,26],popupAnchor:[1,-34],shadowSize:[35,26],shadowAnchor:[0,26]},_getIconUrl:function(i){var t=i+"Url";if(this.options[t])return this.options[t];var e=ViaMichelin.Api.Constants.System.ApiImgPath;return e+"all/marker/marker-"+i+".png"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Marker.Icon.Default),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Popup"),ViaMichelin.Api.MMap.Core.Layer.Popup=function(i,t){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer),this.initialize(i,t)},ViaMichelin.Api.MMap.Core.Layer.Popup.prototype={options:{pane:"popupPane",minWidth:50,maxWidth:300,offset:[0,0],autoPan:!0,autoPanPadding:[5,5],closeButton:!0,zoomAnimation:!0},initialize:function(i,t){ViaMichelin.Api.Util.Object.setOptions(this,i),this._source=t},onAdd:function(i){this._zoomAnimated=this._zoomAnimated&&this.options.zoomAnimation,this._container||this._initLayout(),i._fadeAnimated&&ViaMichelin.Api.Util.Dom.setOpacity(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),i._fadeAnimated&&ViaMichelin.Api.Util.Dom.setOpacity(this._container,1),i.stimulate("popupopen",{popup:this}),this._source&&this._source.stimulate("popupopen",{popup:this},!0)},openOn:function(i){return i.openPopup(this),this},onRemove:function(i){i._fadeAnimated?(ViaMichelin.Api.Util.Dom.setOpacity(this._container,0),this._removeTimeout=setTimeout(ViaMichelin.Api.Util.Core.bind(ViaMichelin.Api.Util.Dom.remove,ViaMichelin.Api.Util.Dom,this._container),200)):ViaMichelin.Api.Util.Dom.remove(this._container),i.stimulate("popupclose",{popup:this}),this._source&&this._source.stimulate("popupclose",{popup:this},!0)},getLatLon:function(){return this._latlon},setLatLon:function(i){return this._latlon=ViaMichelin.Api.MMap.Core.Geo.latLon(i),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(i){return this._content=i,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var i={viewreset:this._updatePosition},t=this.options;return this._zoomAnimated&&(i.zoomanim=this._animateZoom),("closeOnClick"in t?t.closeOnClick:this._map.options.closePopupOnClick)&&(i.preclick=this._close),t.keepInView&&(i.moveend=this._adjustPan),i},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var i="mmap-popup",t=this._container=ViaMichelin.Api.Util.Dom.create("div",i+" "+(this.options.className||"")+" mmap-zoom-"+(this._zoomAnimated?"animated":"hide"));if(this.options.closeButton){var e=this._closeButton=ViaMichelin.Api.Util.Dom.create("a",i+"-close-button",t);e.href="#close",e.innerHTML="&#215;",ViaMichelin.Api.Util.DomEvent.on(e,"click",this._onCloseButtonClick,this)}var n=this._wrapper=ViaMichelin.Api.Util.Dom.create("div",i+"-content-wrapper",t);this._contentNode=ViaMichelin.Api.Util.Dom.create("div",i+"-content",n),ViaMichelin.Api.Util.DomEvent.disableClickPropagation(n).disableScrollPropagation(this._contentNode).plugWire(n,"contextmenu",ViaMichelin.Api.Util.DomEvent.stopPropagation),this._tipContainer=ViaMichelin.Api.Util.Dom.create("div",i+"-tip-container",t),this._tip=ViaMichelin.Api.Util.Dom.create("div",i+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){var i=this._contentNode;if("string"==typeof this._content)i.innerHTML=this._content;else{for(;i.hasChildNodes();)i.removeChild(i.firstChild);i.appendChild(this._content)}this.stimulate("contentupdate")}},_updateLayout:function(){var i=this._contentNode,t=i.style;t.width="",t.whiteSpace="nowrap";var e=i.offsetWidth;e=Math.min(e,this.options.maxWidth),e=Math.max(e,this.options.minWidth),t.width=e+1+"px",t.whiteSpace="",t.height="";var n=i.offsetHeight,o=this.options.maxHeight,a="mmap-popup-scrolled";o&&n>o?(t.height=o+"px",ViaMichelin.Api.Util.Dom.addClass(i,a)):ViaMichelin.Api.Util.Dom.removeClass(i,a),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var i=this._map.latLonToLayerPoint(this._latlon),t=ViaMichelin.Api.MMap.Core.Geometry.point(this.options.offset);this._zoomAnimated?ViaMichelin.Api.Util.Dom.setPosition(this._container,i):t=t.add(i);var e=this._containerBottom=-t.y,n=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=e+"px",this._container.style.left=n+"px"}},_animateZoom:function(i){var t=this._map._latLonToNewLayerPoint(this._latlon,i.zoom,i.center);ViaMichelin.Api.Util.Dom.setPosition(this._container,t)},_adjustPan:function(){if(this.options.autoPan){var i=this._map,t=this._container.offsetHeight,e=this._containerWidth,n=new ViaMichelin.Api.MMap.Core.Geometry.Point(this._containerLeft,-t-this._containerBottom);this._zoomAnimated&&n._add(ViaMichelin.Api.Util.Dom.getPosition(this._container));var o=i.layerPointToContainerPoint(n),a=ViaMichelin.Api.MMap.Core.Geometry.point(this.options.autoPanPadding),r=ViaMichelin.Api.MMap.Core.Geometry.point(this.options.autoPanPaddingTopLeft||a),s=ViaMichelin.Api.MMap.Core.Geometry.point(this.options.autoPanPaddingBottomRight||a),l=i.getSize(),h=0,c=0;o.x+e+s.x>l.x&&(h=o.x+e-l.x+s.x),o.x-h-r.x<0&&(h=o.x-r.x),o.y+t+s.y>l.y&&(c=o.y+t-l.y+s.y),o.y-c-r.y<0&&(c=o.y-r.y),(h||c)&&(i.stimulate("autopanstart"),i.panBy([h,c]))}},_onCloseButtonClick:function(i){this._close(),ViaMichelin.Api.Util.DomEvent.stop(i)},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Popup]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Popup),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Tile.GridLayer"),ViaMichelin.Api.MMap.Core.Layer.Tile.GridLayer=function(i){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer),this.initialize(i)},ViaMichelin.Api.MMap.Core.Layer.Tile.GridLayer.prototype={options:{pane:"tilePane",tileSize:256,opacity:1,updateInterval:150,zIndex:"auto",bounds:null},_tiles:null,_tileNumBounds:{},_tilesToLoad:0,initialize:function(i){i=i?i:{},typeof this.options.updateWhenIdle==""+void 0&&(this.options.updateWhenIdle=ViaMichelin.Api.Util.Browser.mobile),typeof this.options.unloadInvisibleTiles==""+void 0&&(this.options.unloadInvisibleTiles=ViaMichelin.Api.Util.Browser.mobile),ViaMichelin.Api.Util.Object.setOptions(this,i)},onAdd:function(){this._initContainer(),this.options.updateWhenIdle||(this._update=ViaMichelin.Api.Util.Core.throttle(this._update,this.options.updateInterval,this)),this._reset(),this._update()},beforeAdd:function(i){i._addZoomLimit(this)},onRemove:function(i){this._clearBgBuffer(),ViaMichelin.Api.Util.Dom.remove(this._container),i._removeZoomLimit(this),this._container=null},bringToFront:function(){return this._map&&(ViaMichelin.Api.Util.Dom.toFront(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(ViaMichelin.Api.Util.Dom.toBack(this._container),this._setAutoZIndex(Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(i){return this.options.opacity=i,this._map&&this._updateOpacity(),this},setZIndex:function(i){return this.options.zIndex=i,this._updateZIndex(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},getEvents:function(){var i={viewreset:this._reset,moveend:this._update};return this.options.updateWhenIdle||(i.move=this._update),this._zoomAnimated&&(i.zoomstart=this._startZoomAnim,i.zoomanim=this._animateZoom,i.zoomend=this._endZoomAnim),i},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(i){for(var t,e=this.getPane().children,n=-i(-1/0,1/0),o=0,a=e.length;a>o;o++)t=e[o].style.zIndex,e[o]!==this._container&&t&&(n=i(n,+t));isFinite(n)&&(this.options.zIndex=n+i(-1,1),this._updateZIndex())},_updateOpacity:function(){var i=this.options.opacity;if(ViaMichelin.Api.Util.Browser.ielt9)for(var t in this._tiles)ViaMichelin.Api.Util.Dom.setOpacity(this._tiles[t],i);else ViaMichelin.Api.Util.Dom.setOpacity(this._container,i)},_initContainer:function(){if(!this._container){if(this._container=ViaMichelin.Api.Util.Dom.create("div","mmap-layer"),this._updateZIndex(),this._zoomAnimated){var i="mmap-tile-container mmap-zoom-animated";this._bgBuffer=ViaMichelin.Api.Util.Dom.create("div",i,this._container),this._tileContainer=ViaMichelin.Api.Util.Dom.create("div",i,this._container),ViaMichelin.Api.Util.Dom.setTransform(this._tileContainer)}else this._tileContainer=this._container;this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container)}},_reset:function(i){for(var t in this._tiles)this.stimulate("tileunload",{tile:this._tiles[t]});this._abortLoading&&this._abortLoading(),this._tiles={},this._tilesToLoad=0,this._tilesTotal=0,ViaMichelin.Api.Util.Dom.empty(this._tileContainer),this._zoomAnimated&&i&&i.hard&&this._clearBgBuffer(),this._tileNumBounds=this._getTileNumBounds(),this._resetWrap()},_resetWrap:function(){var i=this._map,t=i.options.crs;if(!t.infinite){var e=this._getTileSize();t.wrapLon&&(this._wrapLon=[Math.floor(i.project([0,t.wrapLon[0]]).x/e),Math.ceil(i.project([0,t.wrapLon[1]]).x/e)]),t.wrapLat&&(this._wrapLat=[Math.floor(i.project([t.wrapLat[0],0]).y/e),Math.ceil(i.project([t.wrapLat[1],0]).y/e)])}},_getTileSize:function(){return this.options.tileSize},_update:function(){if(this._map){var i=this._map.getPixelBounds(),t=this._map.getZoom(),e=this._getTileSize();if(t>this.options.maxZoom||t<this.options.minZoom)return void this._clearBgBuffer();var n=new ViaMichelin.Api.MMap.Core.Geometry.Bounds(i.min.divideBy(e).floor(),i.max.divideBy(e).floor());this._addTiles(n),this.options.unloadInvisibleTiles&&this.options.keepInvisibleTilesRatio&&(n=n.multiplyBy(this.options.keepInvisibleTilesRatio)),this.options.unloadInvisibleTiles&&this._removeOtherTiles(n)}},_addTiles:function(i){var t,e,n,o=[],a=i.getCenter(),r=this._map.getZoom();for(t=i.min.y;t<=i.max.y;t++)for(e=i.min.x;e<=i.max.x;e++)n=new ViaMichelin.Api.MMap.Core.Geometry.Point(e,t),n.z=r,this._tileCoordsToKey(n)in this._tiles||!this._isValidTile(n)||o.push(n);var s=o.length;if(0!==s){this._tilesToLoad||this.stimulate("loading"),this._tilesToLoad+=s,this._tilesTotal+=s,o.sort(function(i,t){return i.distanceTo(a)-t.distanceTo(a)});var l=document.createDocumentFragment();for(e=0;s>e;e++)this._addTile(o[e],l);this._tileContainer.appendChild(l)}},_isValidTile:function(i){var t=this._map.options.crs;if(!t.infinite){var e=this._tileNumBounds;if(!t.wrapLon&&(i.x<e.min.x||i.x>e.max.x)||!t.wrapLat&&(i.y<e.min.y||i.y>e.max.y))return!1}if(!this.options.bounds)return!0;var n=this._tileCoordsToBounds(i);return new ViaMichelin.Api.MMap.Core.Geo.latLonBounds(this.options.bounds).intersects(n)},_tileCoordsToBounds:function(i){var t=this._map,e=this._getTileSize(),n=i.multiplyBy(e),o=n.add([e,e]),a=t.wrapLatLon(t.unproject(n,i.z)),r=t.wrapLatLon(t.unproject(o,i.z));return new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds(a,r)},_tileCoordsToKey:function(i){return i.x+":"+i.y},_keyToTileCoords:function(i){var t=i.split(":"),e=parseInt(t[0],10),n=parseInt(t[1],10);return new ViaMichelin.Api.MMap.Core.Geometry.Point(e,n)},_removeOtherTiles:function(i){for(var t in this._tiles)i.contains(this._keyToTileCoords(t))||this._removeTile(t)},_removeTile:function(i){var t=this._tiles[i];ViaMichelin.Api.Util.Dom.remove(t),delete this._tiles[i],this.stimulate("tileunload",{tile:t})},_initTile:function(i){var t=this._getTileSize();ViaMichelin.Api.Util.Dom.addClass(i,"mmap-tile"),i.style.width=t+"px",i.style.height=t+"px",i.onselectstart=ViaMichelin.Api.Util.Core.falseFn,i.onmousemove=ViaMichelin.Api.Util.Core.falseFn,ViaMichelin.Api.Util.Browser.ielt9&&this.options.opacity<1&&ViaMichelin.Api.Util.Dom.setOpacity(i,this.options.opacity),ViaMichelin.Api.Util.Browser.android&&!ViaMichelin.Api.Util.Browser.android23&&(i.style.WebkitBackfaceVisibility="hidden")},_addTile:function(i,t){var e=i.clone(),n=this._getTilePos(i);this._wrapCoords(i);var o=this.createTile(i,ViaMichelin.Api.Util.Core.bind(this._tileReady,this),e);this._initTile(o),this.createTile.length<2&&setTimeout(ViaMichelin.Api.Util.Core.bind(this._tileReady,this,null,o),0),ViaMichelin.Api.Util.Dom.setPosition(o,n,!0),this._tiles[this._tileCoordsToKey(e)]=o,t.appendChild(o),this.stimulate("tileloadstart",{tile:o})},_tileReady:function(i,t){i&&this.stimulate("tileerror",{error:i,tile:t}),ViaMichelin.Api.Util.Dom.addClass(t,"mmap-tile-loaded"),this.stimulate("tileload",{tile:t}),this._tilesToLoad--,0===this._tilesToLoad&&this._visibleTilesReady()},_visibleTilesReady:function(){this.stimulate("load"),this._zoomAnimated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(ViaMichelin.Api.Util.Core.bind(this._clearBgBuffer,this),300))},_getTilePos:function(i){return i.multiplyBy(this._getTileSize()).subtract(this._map.getPixelOrigin())},_wrapCoords:function(i){i.x=this._wrapLon?ViaMichelin.Api.Util.Core.wrapNum(i.x,this._wrapLon):i.x,i.y=this._wrapLat?ViaMichelin.Api.Util.Core.wrapNum(i.y,this._wrapLat):i.y},_getTileNumBounds:function(){var i=this._map.getPixelWorldBounds(),t=this.options.tileSize;return i?new ViaMichelin.Api.MMap.Core.Geometry.Bounds(i.min.divideBy(t).floor(),i.max.divideBy(t).ceil().subtract([1,1])):null},_startZoomAnim:function(){this._prepareBgBuffer(),this._prevTranslate=this._translate||new ViaMichelin.Api.MMap.Core.Geometry.Point(0,0),this._prevScale=this._scale},_animateZoom:function(i){this._translate=this._prevTranslate.multiplyBy(i.scale).add(i.origin.multiplyBy(1-i.scale)),this._scale=this._prevScale*i.scale,ViaMichelin.Api.Util.Dom.setTransform(this._bgBuffer,this._translate,this._scale)},_endZoomAnim:function(){var i=this._tileContainer;i.style.visibility="",ViaMichelin.Api.Util.Dom.toFront(i)},_clearBgBuffer:function(){var i=this._map,t=this._bgBuffer;i&&!i._animatingZoom&&!i.touchZoom._zooming&&t&&(ViaMichelin.Api.Util.Dom.empty(t),ViaMichelin.Api.Util.Dom.setTransform(t))},_prepareBgBuffer:function(){var i=this._tileContainer,t=this._bgBuffer;return this._abortLoading&&this._abortLoading(),this._tilesToLoad/this._tilesTotal>.5?void(i.style.visibility="hidden"):(t.style.visibility="hidden",ViaMichelin.Api.Util.Dom.setTransform(t),this._tileContainer=t,this._bgBuffer=i,this._translate=new ViaMichelin.Api.MMap.Core.Geometry.Point(0,0),this._scale=1,void clearTimeout(this._clearBgBufferTimer))},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Tile.GridLayer]"}},ViaMichelin.Api.MMap.Core.Layer.Tile.gridLayer=function(i){return new ViaMichelin.Api.MMap.Core.Layer.Tile.GridLayer(i)},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Tile.GridLayer),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Tile.TileLayer"),ViaMichelin.Api.MMap.Core.Layer.Tile.TileLayer=function(i,t){this._url=i,t=t?t:{},ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer.Tile.GridLayer,t),ViaMichelin.Api.Util.Object.setOptions(this,t),t.detectRetina&&ViaMichelin.Api.Util.Browser.retina&&t.maxZoom>0&&(t.tileSize=Math.floor(t.tileSize/2),t.zoomOffset++,t.minZoom=Math.max(0,t.minZoom),t.maxZoom--),"string"==typeof this.options.subdomains&&(this.options.subdomains=this.options.subdomains.split(""))},ViaMichelin.Api.MMap.Core.Layer.Tile.TileLayer.prototype={_url:null,options:{minZoom:0,maxZoom:18,subdomains:"",errorTileUrl:"",zoomOffset:0},setUrl:function(i,t){return this._url=i,t||this.redraw(),this},createTile:function(i,t){var e=document.createElement("img");return e.onload=ViaMichelin.Api.Util.Core.bind(this._tileOnLoad,this,t,e),e.onerror=ViaMichelin.Api.Util.Core.bind(this._tileOnError,this,t,e),this.options.crossOrigin&&(e.crossOrigin=""),e.alt="",e.src=this.getTileUrl(i),e},getTileUrl:function(i){var t=this._getSubdomain(i);return ViaMichelin.Api.Util.Core.template(this._url,ViaMichelin.Api.Util.Core.extend({subdomain:t,s:t,x:i.x,y:this.options.tms?this._tileNumBounds.max.y-i.y:i.y,z:this._getZoomForUrl(),quadkey:this._getQuadkey(i)},this.options))},_tileOnLoad:function(i,t){i(null,t)},_tileOnError:function(i,t,e){var n=this.options.errorTileUrl;n&&(t.src=n),i(e,t)},_getTileSize:function(){var i=this._map,t=this.options,e=i.getZoom()+t.zoomOffset,n=t.maxNativeZoom;return n&&e>n?Math.round(i.getZoomScale(e)/i.getZoomScale(n)*t.tileSize):t.tileSize},_removeTile:function(i){var t=this._tiles[i];ViaMichelin.Api.MMap.Core.Layer.Tile.GridLayer.prototype._removeTile.call(this,i),ViaMichelin.Api.Util.Browser.android||(t.onload=null,t.src=ViaMichelin.Api.Util.Core.emptyImageUrl)},_getQuadkey:function(i){for(var t="",e=i.z;e>0;e--){var n=0,o=1<<e-1;0!==(i.x&o)&&n++,0!==(i.y&o)&&(n+=2),t=t+""+n}return t},_getZoomForUrl:function(){var i=this.options,t=this._map.getZoom();return i.zoomReverse&&(t=i.maxZoom-t),t+=i.zoomOffset,i.maxNativeZoom?Math.min(t,i.maxNativeZoom):t},_getSubdomain:function(i){var t=Math.abs(i.x+i.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var i,t;for(i in this._tiles)t=this._tiles[i],t.onload=ViaMichelin.Api.Util.Core.falseFn,t.onerror=ViaMichelin.Api.Util.Core.falseFn,t.complete||(t.src=ViaMichelin.Api.Util.Core.emptyImageUrl,ViaMichelin.Api.Util.Dom.remove(t))},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Tile.TileLayer]"}},ViaMichelin.Api.MMap.Core.Layer.Tile.tileLayer=function(i,t){return new ViaMichelin.Api.MMap.Core.Layer.Tile.TileLayer(i,t)},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Tile.TileLayer),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Vector.Canvas"),ViaMichelin.Api.MMap.Core.Layer.Vector.Canvas=function(){this.extend(ViaMichelin.Api.MMap.Core.Layer.Vector.Renderer),ViaMichelin.Api.MMap.Core.Layer.Vector.Polyline.prototype._containsPoint=function(i,t){var e,n,o,a,r,s,l=this._clickTolerance();if(!this._pxBounds.contains(i))return!1;for(e=0,a=this._parts.length;a>e;e++)for(s=this._parts[e],n=0,r=s.length,o=r-1;r>n;o=n++)if((t||0!==n)&&ViaMichelin.Api.MMap.Core.Geometry.LineUtil.pointToSegmentDistance(i,s[o],s[n])<=l)return!0;return!1},this._addPath=ViaMichelin.Api.Util.Core.falseFn,this._bringToFront=ViaMichelin.Api.Util.Core.falseFn,this._bringToBack=ViaMichelin.Api.Util.Core.falseFn},ViaMichelin.Api.MMap.Core.Layer.Vector.Canvas.prototype={onAdd:function(){ViaMichelin.Api.MMap.Core.Layer.Vector.Renderer.prototype.onAdd.call(this),this._layers=this._layers||{},this._draw()},_initContainer:function(){var i=this._container=document.createElement("canvas");ViaMichelin.Api.Util.DomEvent.on(i,"mousemove",this._onMouseMove,this).on(i,"click dblclick mousedown mouseup contextmenu",this._onClick,this),this._ctx=i.getContext("2d")},_update:function(){if(!this._map._animatingZoom||!this._bounds){ViaMichelin.Api.MMap.Core.Layer.Vector.Renderer.prototype._update.call(this);var i=this._bounds,t=this._container,e=i.getSize(),n=ViaMichelin.Api.Util.Browser.retina?2:1;ViaMichelin.Api.Util.Dom.setPosition(t,i.min),t.width=n*e.x,t.height=n*e.y,t.style.width=e.x+"px",t.style.height=e.y+"px",ViaMichelin.Api.Util.Browser.retina&&this._ctx.scale(2,2),this._ctx.translate(-i.min.x,-i.min.y)}},_initPath:function(i){this._layers[ViaMichelin.Api.Util.Core.stamp(i)]=i},_removePath:function(i){i._removed=!0,this._requestRedraw(i)},_updatePath:function(i){this._redrawBounds=i._pxBounds,this._draw(!0),i._project(),i._update(),this._draw(),this._redrawBounds=null},_updateStyle:function(i){this._requestRedraw(i)},_requestRedraw:function(i){this._map&&(this._redrawBounds=this._redrawBounds||new ViaMichelin.Api.MMap.Core.Geometry.Bounds,this._redrawBounds.extend(i._pxBounds.min).extend(i._pxBounds.max),this._redrawRequest=this._redrawRequest||ViaMichelin.Api.Util.Core.requestAnimFrame(this._redraw,this))},_redraw:function(){this._redrawRequest=null,this._draw(!0),this._draw(),this._redrawBounds=null},_draw:function(i){this._clear=i;var t;for(var e in this._layers)t=this._layers[e],(!this._redrawBounds||t._pxBounds.intersects(this._redrawBounds))&&t._updatePath(),i&&t._removed&&(delete t._removed,delete this._layers[e])
},_updatePoly:function(i,t){var e,n,o,a,r=i._parts,s=r.length,l=this._ctx;if(s){for(l.beginPath(),e=0;s>e;e++){for(n=0,o=r[e].length;o>n;n++)a=r[e][n],l[n?"lineTo":"moveTo"](a.x,a.y);t&&l.closePath()}this._fillStroke(l,i)}},_updateCircle:function(i){if(!i._empty()){var t=i._point,e=this._ctx,n=i._radius,o=(i._radiusY||n)/n;1!==o&&(e.save(),e.scale(1,o)),e.beginPath(),e.arc(t.x,t.y/o,n,0,2*Math.PI,!1),1!==o&&e.restore(),this._fillStroke(e,i)}},_fillStroke:function(i,t){var e=this._clear,n=t.options;i.globalCompositeOperation=e?"destination-out":"source-over",n.fill&&(i.globalAlpha=e?1:n.fillOpacity,i.fillStyle=n.fillColor||n.color,i.fill("evenodd")),n.stroke&&(i.globalAlpha=e?1:n.opacity,t._prevWeight=i.lineWidth=e?t._prevWeight+1:n.weight,i.strokeStyle=n.color,i.lineCap=n.lineCap,i.lineJoin=n.lineJoin,i.stroke())},_onClick:function(i){var t=this._map.mouseEventToLayerPoint(i);for(var e in this._layers)this._layers[e]._containsPoint(t)&&this._layers[e]._fireMouseEvent(i)},_onMouseMove:function(i){if(this._map&&!this._map._animatingZoom){var t=this._map.mouseEventToLayerPoint(i);for(var e in this._layers)this._handleHover(this._layers[e],i,t)}},_handleHover:function(i,t,e){i.options.interactive&&(i._containsPoint(e)?(i._mouseInside||(ViaMichelin.Api.Util.Dom.addClass(this._container,"mmap-interactive"),i._fireMouseEvent(t,"mouseover"),i._mouseInside=!0),i._fireMouseEvent(t)):i._mouseInside&&(ViaMichelin.Api.Util.Dom.removeClass(this._container,"mmap-interactive"),i._fireMouseEvent(t,"mouseout"),i._mouseInside=!1))},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Vector.Canvas]"}},ViaMichelin.Api.MMap.Core.Layer.Vector.canvas=function(i){return ViaMichelin.Api.Util.Browser.canvas?new ViaMichelin.Api.MMap.Core.Layer.Vector.Canvas(i):null},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Vector.Canvas),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Vector.Circle"),ViaMichelin.Api.MMap.Core.Layer.Vector.Circle=function(i,t,e){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer.Vector.CircleMarker),this.setStyle=ViaMichelin.Api.MMap.Core.Layer.Vector.Path.prototype.setStyle,this.initialize(i,t,e)},ViaMichelin.Api.MMap.Core.Layer.Vector.Circle.prototype={initialize:function(i,t,e){ViaMichelin.Api.Util.Object.setOptions(this,e),this._latlon=ViaMichelin.Api.MMap.Core.Geo.latLon(i),this._mRadius=t},setRadius:function(i){return this._mRadius=i,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var i=[this._radius,this._radiusY];return new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds(this._map.layerPointToLatLon(this._point.subtract(i)),this._map.layerPointToLatLon(this._point.add(i)))},_project:function(){var i=this._latlon.lon,t=this._latlon.lat,e=this._map,n=e.options.crs;if(n.distance===ViaMichelin.Api.MMap.Core.Geo.Crs.Earth.prototype.distance){var o=Math.PI/180,a=this._mRadius/ViaMichelin.Api.MMap.Core.Geo.Crs.Earth.prototype.R/o,r=e.project([t+a,i]),s=e.project([t-a,i]),l=r.add(s).divideBy(2),h=e.unproject(l).lat,c=Math.acos((Math.cos(a*o)-Math.sin(t*o)*Math.sin(h*o))/(Math.cos(t*o)*Math.cos(h*o)))/o;this._point=l.subtract(e.getPixelOrigin()),this._radius=isNaN(c)?0:Math.max(Math.round(l.x-e.project([h,i-c]).x),1),this._radiusY=Math.max(Math.round(l.y-r.y),1)}else{var p=n.unproject(n.project(this._latlon).subtract([this._mRadius,0]));this._point=e.latLonToLayerPoint(this._latlon),this._radius=this._point.x-e.latLonToLayerPoint(p).x}this._updateBounds()},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Vector.Circle]"}},ViaMichelin.Api.MMap.Core.Layer.Vector.circle=function(i,t,e){return new ViaMichelin.Api.MMap.Core.Layer.Vector.Circle(i,t,e)},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Vector.Circle),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Vector.CircleMarker"),ViaMichelin.Api.MMap.Core.Layer.Vector.CircleMarker=function(i,t){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer.Vector.Path),this.initialize(i,t)},ViaMichelin.Api.MMap.Core.Layer.Vector.CircleMarker.prototype={options:{fill:!0,radius:10},initialize:function(i,t){ViaMichelin.Api.Util.Object.setOptions(this,t),this._latlon=ViaMichelin.Api.MMap.Core.Geo.latLon(i),this._radius=this.options.radius},setLatLon:function(i){return this._latlon=ViaMichelin.Api.MMap.Core.Geo.latLon(i),this.redraw(),this.stimulate("move",{latlon:this._latlon})},getLatLon:function(){return this._latlon},setRadius:function(i){return this.options.radius=this._radius=i,this.redraw()},getRadius:function(){return this._radius},setStyle:function(i){var t=i&&i.radius||this._radius;return ViaMichelin.Api.MMap.Core.Layer.Vector.Path.prototype.setStyle.call(this,i),this.setRadius(t),this},_project:function(){this._point=this._map.latLonToLayerPoint(this._latlon),this._updateBounds()},_updateBounds:function(){var i=this._radius,t=this._radiusY||i,e=this._clickTolerance(),n=[i+e,t+e];this._pxBounds=new ViaMichelin.Api.MMap.Core.Geometry.Bounds(this._point.subtract(n),this._point.add(n))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Vector.CircleMarker]"}},ViaMichelin.Api.MMap.Core.Layer.Vector.circleMarker=function(i,t){return new ViaMichelin.Api.MMap.Core.Layer.Vector.CircleMarker(i,t)},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Vector.CircleMarker),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Vector.Path"),ViaMichelin.Api.MMap.Core.Layer.Vector.Path=function(){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer)},ViaMichelin.Api.MMap.Core.Layer.Vector.Path.prototype={options:{stroke:!0,color:"#1095F9",weight:3,opacity:1,lineCap:"round",lineJoin:"round",fillOpacity:.2,interactive:!0},onAdd:function(){this._renderer=this._map.getRenderer(this),this._renderer._initPath(this),this._project(),this._update(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},getEvents:function(){return{viewreset:this._project,moveend:this._update}},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(i){return ViaMichelin.Api.Util.Object.setOptions(this,i),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer._bringToBack(this),this},_fireMouseEvent:function(i,t){this._map&&this._map._fireMouseEvent(this,i,t,!0)},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(ViaMichelin.Api.Util.Browser.touch?10:0)}},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Vector.Path),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Vector.Polygon"),ViaMichelin.Api.MMap.Core.Layer.Vector.Polygon=function(i,t){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer.Vector.Polyline,i,t)},ViaMichelin.Api.MMap.Core.Layer.Vector.Polygon.prototype={options:{fill:!0},getCenter:function(){var i,t,e,n,o,a,r,s,l,h=this._rings[0];for(r=s=l=0,i=0,e=h.length,t=e-1;e>i;t=i++)n=h[i],o=h[t],a=n.y*o.x-o.y*n.x,s+=(n.x+o.x)*a,l+=(n.y+o.y)*a,r+=3*a;return this._map.layerPointToLatLon([s/r,l/r])},_convertLatLons:function(i){var t=ViaMichelin.Api.MMap.Core.Layer.Vector.Polyline.prototype._convertLatLons.call(this,i),e=t.length;return e>=2&&t[0]instanceof ViaMichelin.Api.MMap.Core.Geo.LatLon&&t[0].equals(t[e-1])&&t.pop(),t},_clipPoints:function(){if(this.options.noClip)return void(this._parts=this._rings);var i=this._renderer._bounds,t=this.options.weight,e=new ViaMichelin.Api.MMap.Core.Geometry.Point(t,t);i=new ViaMichelin.Api.MMap.Core.Geometry.Bounds(i.min.subtract(e),i.max.add(e)),this._parts=[];for(var n,o=0,a=this._rings.length;a>o;o++)n=ViaMichelin.Api.MMap.Core.Geometry.PolyUtil.clipPolygon(this._rings[o],i),n.length&&this._parts.push(n)},_updatePath:function(){this._renderer._updatePoly(this,!0)},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Vector.Polygon]"}},ViaMichelin.Api.MMap.Core.Layer.Vector.polygon=function(i,t){return new ViaMichelin.Api.MMap.Core.Layer.Vector.Polygon(i,t)},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Vector.Polygon),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Vector.Polyline"),ViaMichelin.Api.MMap.Core.Layer.Vector.Polyline=function(i,t){i&&(ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer.Vector.Path),this.initialize(i,t))},ViaMichelin.Api.MMap.Core.Layer.Vector.Polyline.prototype={options:{smoothFactor:1,noClip:!1},initialize:function(i,t){ViaMichelin.Api.Util.Object.setOptions(this,t),this._setLatLons(i)},getLatLons:function(){return this._latlons},setLatLons:function(i){return this._setLatLons(i),this.redraw()},addLatLon:function(i){return i=ViaMichelin.Api.MMap.Core.Geo.latLon(i),this._latlons.push(i),this._bounds.extend(i),this.redraw()},spliceLatLons:function(){var i=[].splice.apply(this._latlons,arguments);return this._setLatLons(this._latlons),this.redraw(),i},closestLayerPoint:function(i){for(var t,e,n=1/0,o=null,a=ViaMichelin.Api.MMap.Core.Geometry.LineUtil._sqClosestPointOnSegment,r=0,s=this._parts.length;s>r;r++)for(var l=this._parts[r],h=1,c=l.length;c>h;h++){t=l[h-1],e=l[h];var p=a(i,t,e,!0);n>p&&(n=p,o=a(i,t,e))}return o&&(o.distance=Math.sqrt(n)),o},getCenter:function(){var i,t,e,n,o,a,r,s=this._rings[0],l=s.length;for(i=0,t=0;l-1>i;i++)t+=s[i].distanceTo(s[i+1])/2;for(i=0,n=0;l-1>i;i++)if(o=s[i],a=s[i+1],e=o.distanceTo(a),n+=e,n>t)return r=(n-t)/e,this._map.layerPointToLatLon([a.x-r*(a.x-o.x),a.y-r*(a.y-o.y)])},getBounds:function(){return this._bounds},_setLatLons:function(i){this._bounds=new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds,this._latlons=this._convertLatLons(i)},_convertLatLons:function(i){for(var t=[],e=this._flat(i),n=0,o=i.length;o>n;n++)e?(t[n]=ViaMichelin.Api.MMap.Core.Geo.latLon(i[n]),this._bounds.extend(t[n])):t[n]=this._convertLatLons(i[n]);return t},_flat:function(i){return!ViaMichelin.Api.Util.Core.isArray(i[0])||"object"!=typeof i[0][0]},_project:function(){this._rings=[],this._projectLatlons(this._latlons,this._rings);var i=this._clickTolerance(),t=new ViaMichelin.Api.MMap.Core.Geometry.Point(i,-i);this._latlons.length&&(this._pxBounds=new ViaMichelin.Api.MMap.Core.Geometry.Bounds(this._map.latLonToLayerPoint(this._bounds.getSouthWest())._subtract(t),this._map.latLonToLayerPoint(this._bounds.getNorthEast())._add(t)))},_projectLatlons:function(i,t){var e,n,o=i[0]instanceof ViaMichelin.Api.MMap.Core.Geo.LatLon,a=i.length;if(o){for(n=[],e=0;a>e;e++)n[e]=this._map.latLonToLayerPoint(i[e]);t.push(n)}else for(e=0;a>e;e++)this._projectLatlons(i[e],t)},_clipPoints:function(){if(this.options.noClip)return void(this._parts=this._rings);this._parts=[];var i,t,e,n,o,a,r,s=this._parts,l=this._renderer._bounds;for(i=0,e=0,n=this._rings.length;n>i;i++)for(r=this._rings[i],t=0,o=r.length;o-1>t;t++)a=ViaMichelin.Api.MMap.Core.Geometry.LineUtil.clipSegment(r[t],r[t+1],l,t),a&&(s[e]=s[e]||[],s[e].push(a[0]),(a[1]!==r[t+1]||t===o-2)&&(s[e].push(a[1]),e++))},_simplifyPoints:function(){for(var i=this._parts,t=this.options.smoothFactor,e=0,n=i.length;n>e;e++)i[e]=ViaMichelin.Api.MMap.Core.Geometry.LineUtil.simplify(i[e],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)}},ViaMichelin.Api.MMap.Core.Layer.Vector.polyline=function(i,t){return new ViaMichelin.Api.MMap.Core.Layer.Vector.Polyline(i,t)},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Vector.Polyline),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Vector.Renderer"),ViaMichelin.Api.MMap.Core.Layer.Vector.Renderer=function(i){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer),this.initialize(i)},ViaMichelin.Api.MMap.Core.Layer.Vector.Renderer.prototype={options:{padding:0},initialize:function(i){ViaMichelin.Api.Util.Object.setOptions(this,i),ViaMichelin.Api.Util.Core.stamp(this)},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&ViaMichelin.Api.Util.Dom.addClass(this._container,"mmap-zoom-animated")),this.getPane().appendChild(this._container),this._update()},onRemove:function(){ViaMichelin.Api.Util.Dom.remove(this._container)},getEvents:function(){var i={moveend:this._update};return this._zoomAnimated&&(i.zoomanim=this._animateZoom),i},_animateZoom:function(i){var t=i.origin.subtract(this._map._getCenterLayerPoint()),e=this._bounds.min.add(t.multiplyBy(1-i.scale));ViaMichelin.Api.Util.Dom.setTransform(this._container,e,i.scale)},_update:function(){var i=this.options.padding,t=this._map.getSize(),e=this._map.containerPointToLayerPoint(t.multiplyBy(-i)).round();this._bounds=new ViaMichelin.Api.MMap.Core.Geometry.Bounds(e,e.add(t.multiplyBy(1+2*i)).round())},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Vector.Renderer]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Vector.Renderer),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Vector.SVG"),ViaMichelin.Api.MMap.Core.Layer.Vector.SVG=function(){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer.Vector.Renderer),ViaMichelin.Api.Util.Browser.vml&&ViaMichelin.Api.Util.Core.extend(this,ViaMichelin.Api.MMap.Core.Layer.Vector.VML)},ViaMichelin.Api.MMap.Core.Layer.Vector.SVG.prototype={_initContainer:function(){this._container=this.create("svg"),this._paths={},this._initEvents(),this._container.setAttribute("pointer-events","none")},_update:function(){if(!this._map._animatingZoom||!this._bounds){ViaMichelin.Api.MMap.Core.Layer.Vector.Renderer.prototype._update.call(this);var i=this._bounds,t=i.getSize(),e=this._container,n=this.getPane();ViaMichelin.Api.Util.Browser.mobileWebkit&&n.removeChild(e),ViaMichelin.Api.Util.Dom.setPosition(e,i.min),this._svgSize&&this._svgSize.equals(t)||(this._svgSize=t,e.setAttribute("width",t.x),e.setAttribute("height",t.y)),ViaMichelin.Api.Util.Dom.setPosition(e,i.min),e.setAttribute("viewBox",[i.min.x,i.min.y,t.x,t.y].join(" ")),ViaMichelin.Api.Util.Browser.mobileWebkit&&n.appendChild(e)}},_initPath:function(i){var t=i._path=this.create("path");i.options.className&&ViaMichelin.Api.Util.Dom.addClass(t,i.options.className),i.options.interactive&&ViaMichelin.Api.Util.Dom.addClass(t,"mmap-interactive"),this._updateStyle(i)},_addPath:function(i){var t=i._path;this._container.appendChild(t),this._paths[ViaMichelin.Api.Util.Core.stamp(t)]=i},_removePath:function(i){var t=i._path;ViaMichelin.Api.Util.Dom.remove(t),delete this._paths[ViaMichelin.Api.Util.Core.stamp(t)]},_updatePath:function(i){i._project(),i._update()},_updateStyle:function(i){var t=i._path,e=i.options;t&&(e.stroke?(t.setAttribute("stroke",e.color),t.setAttribute("stroke-opacity",e.opacity),t.setAttribute("stroke-width",e.weight),t.setAttribute("stroke-linecap",e.lineCap),t.setAttribute("stroke-linejoin",e.lineJoin),e.dashArray?t.setAttribute("stroke-dasharray",e.dashArray):t.removeAttribute("stroke-dasharray"),e.dashOffset?t.setAttribute("stroke-dashoffset",e.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),e.fill?(t.setAttribute("fill",e.fillColor||e.color),t.setAttribute("fill-opacity",e.fillOpacity),t.setAttribute("fill-rule","evenodd")):t.setAttribute("fill","none"),t.setAttribute("pointer-events",e.pointerEvents||(e.interactive?"visiblePainted":"none")))},_updatePoly:function(i,t){this._setPath(i,ViaMichelin.Api.MMap.Core.Layer.Vector.SVG.prototype.pointsToPath(i._parts,t))},_updateCircle:function(i){var t=i._point,e=i._radius,n=i._radiusY||e,o="a"+e+","+n+" 0 1,0 ",a=i._empty()?"M0 0":"M"+(t.x-e)+","+t.y+o+2*e+",0 "+o+2*-e+",0 ";this._setPath(i,a)},_setPath:function(i,t){i._path.setAttribute("d",t)},_bringToFront:function(i){ViaMichelin.Api.Util.Dom.toFront(i._path)},_bringToBack:function(i){ViaMichelin.Api.Util.Dom.toBack(i._path)},_initEvents:function(){ViaMichelin.Api.Util.DomEvent.on(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu",this._fireMouseEvent,this)},_fireMouseEvent:function(i,t){var e=this._paths[ViaMichelin.Api.Util.Core.stamp(i.target||i.srcElement)];e&&this._map._fireMouseEvent(e,i,t,!0)},create:function(i){return document.createElementNS("http://www.w3.org/2000/svg",i)},pointsToPath:function(i,t){var e,n,o,a,r,s,l="";for(e=0,o=i.length;o>e;e++){for(r=i[e],n=0,a=r.length;a>n;n++)s=r[n],l+=(n?"L":"M")+s.x+" "+s.y;l+=t?ViaMichelin.Api.Util.Browser.svg?"z":"x":""}return l||"M0 0"},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Vector.SVG]"}},ViaMichelin.Api.MMap.Core.Layer.Vector.svg=function(i){return ViaMichelin.Api.Util.Browser.svg||ViaMichelin.Api.Util.Browser.vml?new ViaMichelin.Api.MMap.Core.Layer.Vector.SVG(i):null},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Vector.SVG),JSEPackage("ViaMichelin.Api.MMap.Core.Layer.Vector.VML"),ViaMichelin.Api.MMap.Core.Layer.Vector.VML={create:function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(i){return document.createElement("<lvml:"+i+' class="lvml">')}}catch(i){return function(i){return document.createElement("<"+i+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initContainer:function(){this._container=ViaMichelin.Api.Util.Dom.create("div","mmap-vml-container"),this._paths={},this._initEvents()},_update:function(){this._map._animatingZoom||ViaMichelin.Api.MMap.Core.Layer.Vector.Renderer.prototype._update.call(this)},_initPath:function(i){var t=i._container=this.create("shape");ViaMichelin.Api.Util.Dom.addClass(t,"mmap-vml-shape "+(this.options.className||"")),t.coordsize="1 1",i._path=this.create("path"),t.appendChild(i._path),this._updateStyle(i)},_addPath:function(i){var t=i._container;this._container.appendChild(t),this._paths[ViaMichelin.Api.Util.Core.stamp(t)]=i},_removePath:function(i){var t=i._container;ViaMichelin.Api.Util.Dom.remove(t),delete this._paths[ViaMichelin.Api.Util.Core.stamp(t)]},_updateStyle:function(i){var t=i._stroke,e=i._fill,n=i.options,o=i._container;o.stroked=!!n.stroke,o.filled=!!n.fill,n.stroke?(t||(t=i._stroke=this.create("stroke"),o.appendChild(t)),t.weight=n.weight+"px",t.color=n.color,t.opacity=n.opacity,t.dashStyle=n.dashArray?ViaMichelin.Api.Util.Core.isArray(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):"",t.endcap=n.lineCap.replace("butt","flat"),t.joinstyle=n.lineJoin):t&&(o.removeChild(t),i._stroke=null),n.fill?(e||(e=i._fill=this.create("fill"),o.appendChild(e)),e.color=n.fillColor||n.color,e.opacity=n.fillOpacity):e&&(o.removeChild(e),i._fill=null)},_updateCircle:function(i){var t=i._point.round(),e=Math.round(i._radius),n=Math.round(i._radiusY||e);this._setPath(i,i._empty()?"M0 0":"AL "+t.x+","+t.y+" "+e+","+n+" 0,23592600")},_setPath:function(i,t){i._path.v=t},toString:function(){return"[ViaMichelin.Api.MMap.Core.Layer.Vector.VML]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Layer.Vector.VML),JSEPackage("ViaMichelin.Api.MMap.Core.Map"),ViaMichelin.Api.MMap.Core.Map=function(i){this.extend(ViaMichelin.Api.MMap.Core.Map.Modular);var t={container:null,center:null,zoom:null,trackResize:!0,crs:null,maxBoundsStyle:"elastic",navigationMode:"DRAG",dragging:!0,inertia:null,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:null,easeLinearity:.25,worldCopyJump:!1,zoomAnimation:!0,zoomAnimationThreshold:4,markerZoomAnimation:!0,scrollWheel:!0,closePopupOnClick:!0};t.fadeAnimation=ViaMichelin.Api.Util.Dom.TRANSITION&&!ViaMichelin.Api.Util.Browser.android23,ViaMichelin.Api.Util.Browser.android23||(t.inertia=!0),t.inertiaThreshold=ViaMichelin.Api.Util.Browser.touch?32:18,t.crs=new ViaMichelin.Api.MMap.Core.Geo.Crs.EPSG3857,this.options=t,"undefined"!=typeof i&&i&&i.container&&this.initialize(i)},ViaMichelin.Api.MMap.Core.Map.prototype={options:"",_container:null,dragging:null,_handlers:[],_initialCenter:null,_initialTopLeftPoint:null,_layers:{},_layersMinZoom:void 0,_layersMaxZoom:void 0,_loaded:!1,_mapPane:null,_navigationMode:null,_panes:null,_sizeChanged:!1,touchZoom:{},_zoom:null,_zoomBoundLayers:{},initialize:function(i){return"undefined"==typeof i?!1:(this._setOptions(i),this.loadModule(ViaMichelin.Api.MMap.Core.Map.Module.Animation.Pan),this.loadModule(ViaMichelin.Api.MMap.Core.Map.Module.Animation.Zoom),this.loadModule(ViaMichelin.Api.MMap.Core.Map.Module.Control),this.loadModule(ViaMichelin.Api.MMap.Core.Map.Module.Layer),this.loadModule(ViaMichelin.Api.MMap.Core.Map.Module.Popup),this.loadModule(ViaMichelin.Api.MMap.Core.Map.Module.Css),this.loadModule(ViaMichelin.Api.MMap.Core.Map.Module.Geolocation),this.loadModule(ViaMichelin.Api.MMap.Core.Map.Module.Renderer),this._initContainer(),this._initLayout(),this._onResize=ViaMichelin.Api.Util.Core.bind(this._onResize,this),this._initEvents(),this.options.maxBounds&&this.setMaxBounds(this.options.maxBounds),void 0!==i.zoom&&(this._zoom=this._limitZoom(i.zoom)),this.options.center&&void 0!==this.options.zoom&&this.setView(this.options.center,this.options.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this.callInitHooks(),void this._loadHandler())},_setOptions:function(i){ViaMichelin.Api.Util.Object.mixAttributes(this.options,i),this._navigationMode=this.options.navigationMode},setView:function(i,t){return t=void 0===t?this.getZoom():t,this._resetView(i,this._limitZoom(t)),this},setZoom:function(i,t){return this._loaded?this.setView(this.getCenter(),i,{zoom:t}):(this._zoom=this._limitZoom(i),this)},zoomIn:function(i,t){return this.setZoom(this._zoom+(i||1),t)},zoomOut:function(i,t){return this.setZoom(this._zoom-(i||1),t)},setZoomAround:function(i,t,e){var n=this.getZoomScale(t),o=this.getSize().divideBy(2),a=i instanceof ViaMichelin.Api.MMap.Core.Geometry.Point?i:this.latLonToContainerPoint(i),r=a.subtract(o).multiplyBy(1-1/n),s=this.containerPointToLatLon(o.add(r));return this.setView(s,t,{zoom:e})},fitLayers:function(i){var t=null;return this.eachLayer(function(i){i.getBounds&&(t?t.extend(i.getBounds()):t=i.getBounds())},this),this.fitBounds(t,i)},fitBounds:function(i,t){t=t||{},i=i.getBounds?i.getBounds():ViaMichelin.Api.MMap.Core.Geo.latLonBounds(i);var e=ViaMichelin.Api.MMap.Core.Geometry.point(t.paddingTopLeft||t.padding||[0,0]),n=ViaMichelin.Api.MMap.Core.Geometry.point(t.paddingBottomRight||t.padding||[0,0]),o=this.getBoundsZoom(i,!1,e.add(n));o=t.maxZoom?Math.min(t.maxZoom,o):o;var a=n.subtract(e).divideBy(2),r=this.project(i.getSouthWest(),o),s=this.project(i.getNorthEast(),o),l=this.unproject(r.add(s).divideBy(2).add(a),o);return this.setView(l,o,t)},fitWorld:function(i){return this.fitBounds([[-90,-180],[90,180]],i)},getZoom:function(){return this._zoom},getBounds:function(){var i=this.getPixelBounds(),t=this.unproject(i.getBottomLeft()),e=this.unproject(i.getTopRight());return new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds(t,e)},getMinZoom:function(){return void 0===this.options.minZoom?void 0===this._layersMinZoom?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(i,t,e){i=ViaMichelin.Api.MMap.Core.Geo.latLonBounds(i);var n,o=this.getMinZoom()-(t?1:0),a=this.getMaxZoom(),r=this.getSize(),s=i.getNorthWest(),l=i.getSouthEast(),h=!0;e=ViaMichelin.Api.MMap.Core.Geometry.point(e||[0,0]);do o++,n=this.project(l,o).subtract(this.project(s,o)).add(e),h=t?n.x<r.x||n.y<r.y:r.contains(n);while(h&&a>=o);return h&&t?null:t?o:o-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new ViaMichelin.Api.MMap.Core.Geometry.Point(this._container.clientWidth,this._container.clientHeight,!1),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var i=this._getTopLeftPoint();return new ViaMichelin.Api.MMap.Core.Geometry.Bounds(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPixelWorldBounds:function(){return this.options.crs.getProjectedBounds(this.getZoom())},getPane:function(i){return"string"==typeof i?this._panes[i]:i},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(i){var t=this.options.crs;return t.scale(i)/t.scale(this._zoom)},getScaleZoom:function(i){return this._zoom+Math.log(i)/Math.LN2},panTo:function(i,t){return this.setView(i,this._zoom,{pan:t})},panBy:function(i){return this.stimulate("movestart"),this._rawPanBy(ViaMichelin.Api.Model.point(i)),this.stimulate("move"),this.stimulate("moveend")},setMaxBounds:function(i){return i=ViaMichelin.Api.MMap.Core.Geo.latLonBounds(i),this.options.maxBounds=i,i?(this._loaded&&this._panInsideMaxBounds(),this.plugWire("moveend",this._panInsideMaxBounds,this)):this.unplugWire("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(i,t){var e=this.getCenter(),n=this._limitCenter(e,this._zoom,i);return e.equals(n)?this:this.panTo(n,t)},wrapLatLon:function(i){return this.options.crs.wrapLatLon(i)},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_loadHandler:function(){this.dragging=new ViaMichelin.Api.MMap.Core.Map.Handler.Drag(this),this._handlers.push(this.dragging),ViaMichelin.Api.Util.Object.mixAttributes(this.options,this.dragging.mergeOptions),this.options.dragging&&this._navigationMode===ViaMichelin.Api.Constants.Map.NAVIGATION.DRAG&&this._handlers[0].enable(),this._navigationModeChanged(),this.scrollWheelZoom=new ViaMichelin.Api.MMap.Core.Map.Handler.ScrollWheelZoom(this),this._handlers.push(this.scrollWheelZoom),ViaMichelin.Api.Util.Object.mixAttributes(this.options,this.scrollWheelZoom.mergeOptions),this.options.scrollWheel&&this.scrollWheelZoom.enable(),this.boxZoom=new ViaMichelin.Api.MMap.Core.Map.Handler.BoxZoom(this),this._handlers.push(this.boxZoom),ViaMichelin.Api.Util.Object.mixAttributes(this.options,this.boxZoom.mergeOptions),this.boxZoom.enable(),this.touchZoom=new ViaMichelin.Api.MMap.Core.Map.Handler.TouchZoom(this),this._handlers.push(this.touchZoom),ViaMichelin.Api.Util.Object.mixAttributes(this.options,this.touchZoom.mergeOptions),this.options.touchZoom&&this.touchZoom.enable(),ViaMichelin.Api.Util.Browser.touch&&!ViaMichelin.Api.Util.Browser.pointer&&(this.tap=new ViaMichelin.Api.MMap.Core.Map.Handler.Tap(this),this._handlers.push(this.tap),ViaMichelin.Api.Util.Object.mixAttributes(this.options,this.tap.mergeOptions),this.tap.enable()),ViaMichelin.Api.Util.Browser.touch&&(this.dualTap=new ViaMichelin.Api.MMap.Core.Map.Handler.DualTap(this),this._handlers.push(this.dualTap),ViaMichelin.Api.Util.Object.mixAttributes(this.options,this.dualTap.mergeOptions),this.dualTap.enable())},_initContainer:function(){var i=this._container=ViaMichelin.Api.Util.Dom.get(this.options.container);if(!i)throw new Error("Map container not found.");if(i._mmap)throw new Error("Map container is already initialized.");i._mmap=!0},_exception:function(i,t){this.stimulate("onError",new ViaMichelin.Api.Exception(i,t)),this.remove()},_initLayout:function(){var i=this._container;ViaMichelin.Api.Util.Dom.addClass(i,"vmapi vmapi-mmap mmap-container"+(ViaMichelin.Api.Util.Browser.touch?" mmap-touch":"")+(ViaMichelin.Api.Util.Browser.retina?" mmap-retina":"")+(ViaMichelin.Api.Util.Browser.ielt9?" mmap-oldie":"")+(this.options.fadeAnimation?" mmap-fade-anim":""));var t=ViaMichelin.Api.Util.Dom.getStyle(i,"position");"absolute"!==t&&"relative"!==t&&"fixed"!==t&&(i.style.position="relative"),this._initPanes(),this._initControls&&this._initControls()},_initPanes:function(){var i=this._panes={};this._mapPane=this.createPane("mapPane",this._container),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ViaMichelin.Api.Util.Dom.addClass(i.markerPane,"mmap-zoom-hide"),ViaMichelin.Api.Util.Dom.addClass(i.shadowPane,"mmap-zoom-hide"))},_initEvents:function(i){ViaMichelin.Api.Util.DomEvent&&(i=i||"on",ViaMichelin.Api.Util.DomEvent[i](this._container,"click dblclick mousedown mouseup mouseenter mouseleave mousemove contextmenu",this._handleMouseEvent,this),this.options.trackResize&&ViaMichelin.Api.Util.DomEvent[i](window,"resize",this._onResize,this))},_onResize:function(){ViaMichelin.Api.Util.Core.cancelAnimFrame(this._resizeRequest),this._resizeRequest=ViaMichelin.Api.Util.Core.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_handleMouseEvent:function(i){this._loaded&&this._fireMouseEvent(this,i,"mouseenter"===i.type?"mouseover":"mouseleave"===i.type?"mouseout":i.type)},_fireMouseEvent:function(i,t,e,n,o){if(e=e||t.type,!ViaMichelin.Api.Util.DomEvent._skipped(t)){if("click"===e){var a=i.options.draggable===!0?i:this;if(!t._simulated&&(a.dragging&&a.dragging.moved()||this.boxZoom&&this.boxZoom.moved()))return;i.stimulate("preclick")}if(!i.JSEwireHub[e]||0!==i.JSEwireHub[e].length){"contextmenu"===e&&ViaMichelin.Api.Util.DomEvent.preventDefault(t),("click"===e||"dblclick"===e||"contextmenu"===e)&&ViaMichelin.Api.Util.DomEvent.stopPropagation(t);var r={originalEvent:t,containerPoint:this.mouseEventToContainerPoint(t)};r.layerPoint=this.containerPointToLayerPoint(r.containerPoint),r.latlon=o||this.layerPointToLatLon(r.layerPoint),i.stimulate(e,r,n)}}},_clearHandlers:function(){for(var i=0,t=this._handlers.length;t>i;i++)this._handlers[i].disable()},whenReady:function(i,t){return this._loaded?i.call(t||this,{target:this}):this.plugWire("load",i,t),this},_limitCenter:function(i,t,e){if(!e)return i;var n=this.project(i,t),o=this.getSize().divideBy(2),a=new ViaMichelin.Api.MMap.Core.Geometry.Bounds(n.subtract(o),n.add(o)),r=this._getBoundsOffset(a,e,t);return this.unproject(n.add(r),t)},_limitOffset:function(i,t){if(!t)return i;var e=this.getPixelBounds(),n=new ViaMichelin.Api.MMap.Core.Geometry.Bounds(e.min.add(i),e.max.add(i));return i.add(this._getBoundsOffset(n,t))},_getBoundsOffset:function(i,t,e){var n=this.project(t.getNorthWest(),e).subtract(i.min),o=this.project(t.getSouthEast(),e).subtract(i.max),a=this._rebound(n.x,-o.x),r=this._rebound(n.y,-o.y);return new ViaMichelin.Api.MMap.Core.Geometry.Point(a,r)},_rebound:function(i,t){return i+t>0?Math.round(i-t)/2:Math.max(0,Math.ceil(i))-Math.max(0,Math.floor(t))},_limitZoom:function(i){var t=this.getMinZoom(),e=this.getMaxZoom();return Math.max(t,Math.min(e,i))},_getMapPanePos:function(){return ViaMichelin.Api.Util.Dom.getPosition(this._mapPane)},_moved:function(){var i=this._getMapPanePos();return i&&!i.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(i,t){var e=this.getSize()._divideBy(2);return this.project(i,t)._subtract(e)._round()},_latLonToNewLayerPoint:function(i,t,e){var n=this._getNewTopLeftPoint(e,t).add(this._getMapPanePos());return this.project(i,t)._subtract(n)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(i){return this.latLonToLayerPoint(i).subtract(this._getCenterLayerPoint())},project:function(i,t){return t=void 0===t?this._zoom:t,this.options.crs.latLonToPoint(ViaMichelin.Api.MMap.Core.Geo.latLon(i),t)},unproject:function(i,t){return t=void 0===t?this._zoom:t,this.options.crs.pointToLatLon(ViaMichelin.Api.MMap.Core.Geometry.point(i),t)},_resetView:function(i,t,e,n){var o=this._zoom!==t;n||(this.stimulate("movestart"),o&&this.stimulate("zoomstart")),this._zoom=t,this._initialCenter=i,this._initialTopLeftPoint=this._getNewTopLeftPoint(i,t),e?this._initialTopLeftPoint._add(this._getMapPanePos()):ViaMichelin.Api.Util.Dom.setPosition(this._mapPane,new ViaMichelin.Api.MMap.Core.Geometry.Point(0,0));var a=!this._loaded;this._loaded=!0,this.stimulate("viewreset",{hard:!e}),a&&this.stimulate("load"),this.stimulate("move"),(o||n)&&this.stimulate("zoomend"),this.stimulate("moveend",{hard:!e})},_rawPanBy:function(i){ViaMichelin.Api.Util.Dom.setPosition(this._mapPane,this._getMapPanePos().subtract(i))
},invalidateSize:function(i){if(!this._loaded)return this;i=ViaMichelin.Api.Util.Core.extend({animate:!1,pan:!0},i===!0?{animate:!0}:i);var t=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var e=this.getSize(),n=t.divideBy(2).round(),o=e.divideBy(2).round(),a=n.subtract(o);return a.x||a.y?(i.animate&&i.pan?this.panBy(a):(i.pan&&this._rawPanBy(a),this.stimulate("move"),i.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(ViaMichelin.Api.Util.Core.bind(this.stimulate,this,"moveend"),200)):this.stimulate("moveend")),this.stimulate("resize",{oldSize:t,newSize:e})):this},remove:function(){this._initEvents("off");try{delete this._container._mmap}catch(i){this._container._mmap=void 0}return ViaMichelin.Api.Util.Dom.remove(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this._loaded&&this.stimulate("unload"),this},createPane:function(i,t){var e="mmap-pane"+(i?" mmap-"+i.replace("Pane","")+"-pane":""),n=ViaMichelin.Api.Util.Dom.create("div",e,t||this._mapPane);return i&&(this._panes[i]=n),n},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLon(this._getCenterLayerPoint())},_clearPanes:function(){this._container&&this._mapPane&&this._container.removeChild(this._mapPane)},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_getDeltaZoom:function(){var i=this.getSize(),t=this._getScaleZoom();return new ViaMichelin.Api.MMap.Core.Geometry.Point(-(t*i.x/2),-(t*i.y/2))},_getScaleZoom:function(){return this.getZoom()-Math.floor(this.getZoom())},containerPointToLayerPoint:function(i){return ViaMichelin.Api.MMap.Core.Geometry.point(i).subtract(this._getMapPanePos())},latLonToLayerPoint:function(i){var t=this.project(ViaMichelin.Api.MMap.Core.Geo.latLon(i))._round();return t._subtract(this.getPixelOrigin())},layerPointToLatLon:function(i){var t=ViaMichelin.Api.MMap.Core.Geometry.point(i).add(this.getPixelOrigin());return this.unproject(t)},layerPointToContainerPoint:function(i){return ViaMichelin.Api.MMap.Core.Geometry.point(i).add(this._getMapPanePos())},containerPointToLatLon:function(i){var t=this.containerPointToLayerPoint(ViaMichelin.Api.MMap.Core.Geometry.point(i));return this.layerPointToLatLon(t)},latLonToContainerPoint:function(i){return this.layerPointToContainerPoint(this.latLonToLayerPoint(ViaMichelin.Api.MMap.Core.Geo.latLon(i)))},mouseEventToContainerPoint:function(i){return ViaMichelin.Api.Util.DomEvent.getMousePosition(i,this._container)},mouseEventToLayerPoint:function(i){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(i))},addInitHook:function(i){var t=Array.prototype.slice.call(arguments,1),e="function"==typeof i?i:function(){this[i].apply(this,t)};this._initHooks=this._initHooks||[],this._initHooks.push(e)},callInitHooks:function(){if(this._initHooks)for(var i=0,t=this._initHooks.length;t>i;i++)this._initHooks[i].call(this)},getNavigationMode:function(){return this._navigationMode},setNavigationMode:function(i){this._navigationMode=i,this._navigationModeChanged(),this._navigationMode===ViaMichelin.Api.Constants.Map.NAVIGATION.DRAG?this.dragging.enable():this._navigationMode===ViaMichelin.Api.Constants.Map.NAVIGATION.DRAGZOOM&&this.dragging.disable(),this.stimulate("navigationmodechange")},_navigationModeChanged:function(){ViaMichelin.Api.Util.Dom.removeClass(this._container,"ui-navigation-zoom"),ViaMichelin.Api.Util.Dom.removeClass(this._container,"ui-navigation-bound"),this.getNavigationMode()===ViaMichelin.Api.Constants.Map.NAVIGATION.DRAG?ViaMichelin.Api.Util.Dom.addClass(this._container,"ui-navigation-bound"):ViaMichelin.Api.Util.Dom.addClass(this._container,"ui-navigation-zoom")}},ViaMichelin.Api.MMap.Core.map=function(i){return new ViaMichelin.Api.MMap.Core.Map(i)},ToJSEObject(ViaMichelin.Api.MMap.Core.Map),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Handler"),ViaMichelin.Api.MMap.Core.Map.Handler.prototype={initialize:function(i){this._map=i},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Handler),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Handler.BoxZoom"),ViaMichelin.Api.MMap.Core.Map.Handler.BoxZoom=function(i){this.extend(ViaMichelin.Api.MMap.Core.Map.Handler),this._map=i,this.initialize(i)},ViaMichelin.Api.MMap.Core.Map.Handler.BoxZoom.prototype={mergeOptions:{scrollWheelZoom:!0},initialize:function(i){this._map=i,this._container=i._container,this._pane=i._panes.overlayPane},addHooks:function(){ViaMichelin.Api.Util.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){ViaMichelin.Api.Util.DomEvent.off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_onMouseDown:function(i){return this._moved=!1,this._map._navigationMode===ViaMichelin.Api.Constants.Map.NAVIGATION.DRAGZOOM||i.shiftKey&&(1===i.which||1===i.button)?(ViaMichelin.Api.Util.Dom.disableTextSelection(),ViaMichelin.Api.Util.Dom.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(i),void ViaMichelin.Api.Util.DomEvent.on(document,{contextmenu:ViaMichelin.Api.Util.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)):!1},_onMouseMove:function(i){this._moved||(this._moved=!0,this._box=ViaMichelin.Api.Util.Dom.create("div","mmap-zoom-box",this._container),ViaMichelin.Api.Util.Dom.addClass(this._container,"mmap-crosshair"),this._map.stimulate("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(i);var t=new ViaMichelin.Api.MMap.Core.Geometry.Bounds(this._point,this._startPoint),e=t.getSize();ViaMichelin.Api.Util.Dom.setPosition(this._box,t.min),this._box.style.width=e.x+"px",this._box.style.height=e.y+"px"},_finish:function(){this._moved&&(ViaMichelin.Api.Util.Dom.remove(this._box),ViaMichelin.Api.Util.Dom.removeClass(this._container,"mmap-crosshair")),ViaMichelin.Api.Util.Dom.enableTextSelection(),ViaMichelin.Api.Util.Dom.enableImageDrag(),ViaMichelin.Api.Util.DomEvent.off(document,{contextmenu:ViaMichelin.Api.Util.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(){if(this._finish(),this._moved){var i=new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds(this._map.containerPointToLatLon(this._startPoint),this._map.containerPointToLatLon(this._point));this._map.fitBounds(i),this._map.stimulate("boxzoomend",{boxZoomBounds:i})}},_onKeyDown:function(i){27===i.keyCode&&this._finish()},toString:function(){return"[ViaMichelin.Api.MMap.Core.Map.Handler.BoxZoom]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Handler.BoxZoom),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Handler.Drag"),ViaMichelin.Api.MMap.Core.Map.Handler.Drag=function(i){this.extend(ViaMichelin.Api.MMap.Core.Map.Handler),this._map=i},ViaMichelin.Api.MMap.Core.Map.Handler.Drag.prototype={addHooks:function(){if(!this._draggable){var i=this._map;this._draggable=new ViaMichelin.Api.MMap.Core.Dom.Draggable(i._mapPane,i._container),this._draggable.plugWire("down",this._onDown,this),this._draggable.plugWire("dragstart",this._onDragStart,this),this._draggable.plugWire("drag",this._onDrag,this),this._draggable.plugWire("dragend",this._onDragEnd,this),i.options.maxBounds&&i.options.maxBoundsStyle&&"stop"===i.options.maxBoundsStyle&&this._loadStyleStopProcess(),i.options.worldCopyJump&&(this._draggable.plugWire("predrag",this._onPreDrag,this),i.plugWire("viewreset",this._onViewReset,this),i.whenReady(this._onViewReset,this))}this._draggable.enable()},_loadStyleStopProcess:function(){var i,t,e,n,o,a,r,s,l,h,c,p,u,M,m;m=this,this._draggable.plugWire("dragstart",function(){M=this._draggable._newPos,i=this._draggable._newPos.y,t=this._draggable._newPos.x,e=this._draggable._newPos.y,n=this._draggable._newPos.x,r=m._map.getZoom(),s=m._map.getPixelWorldBounds(),l=m._map.getSize(),h=new ViaMichelin.Api.MMap.Core.Geometry.Point(0,0),u=ViaMichelin.Api.MMap.Core.Geo.latLonBounds(m._map.options.maxBounds),c=new ViaMichelin.Api.MMap.Core.Geometry.Bounds([0,s-(this._map._initialTopLeftPoint.y+l.y)],[0,this._map._initialTopLeftPoint.y]),p=new ViaMichelin.Api.MMap.Core.Geometry.Bounds(m._map.project(u.getSouthWest(),m._map.getZoom()),m._map.project(u.getNorthEast(),m._map.getZoom()))},this),this._draggable.plugWire("predrag",function(){h=new ViaMichelin.Api.MMap.Core.Geometry.Point(Math.floor(l.x-p.getSize().x)/2,Math.floor(l.y-p.getSize().y)/2),o=this._draggable._newPos.y-i,i=this._draggable._newPos.y,e+=o,a=this._draggable._newPos.x-t,t=this._draggable._newPos.x,n+=a,p.getSize().y<=l.y?this._draggable._newPos.y=M.y:e-this._map._initialTopLeftPoint.y+Math.ceil(p.min.y)>=0?(e=this._map._initialTopLeftPoint.y-Math.ceil(p.min.y),this._draggable._newPos.y=e):Math.ceil(p.max.y)-(this._map._initialTopLeftPoint.y+l.y)+e<=0?(e=-(Math.ceil(p.max.y)-(this._map._initialTopLeftPoint.y+l.y)),this._draggable._newPos.y=e):this._draggable._newPos.y=e,p.getSize().x<=l.x?this._draggable._newPos.x=M.x:n-this._map._initialTopLeftPoint.x+Math.ceil(p.min.x)>=0?(n=this._map._initialTopLeftPoint.x-Math.ceil(p.min.x),this._draggable._newPos.x=n):Math.ceil(p.max.x)-(this._map._initialTopLeftPoint.x+l.x)+n<=0?(n=-(Math.ceil(p.max.x)-(this._map._initialTopLeftPoint.x+l.x)),this._draggable._newPos.x=n):this._draggable._newPos.x=n},this)},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDown:function(){this._map._panAnim&&this._map._panAnim.stop()},_onDragStart:function(){var i=this._map;i.stimulate("movestart"),i.stimulate("dragstart"),i.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var i=this._lastTime=+new Date,t=this._lastPos=this._draggable._newPos;this._positions.push(t),this._times.push(i),i-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.stimulate("move"),this._map.stimulate("drag")},_onViewReset:function(){var i=this._map.getSize().divideBy(2),t=this._map.latLonToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(i).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_onPreDrag:function(){var i=this._worldWidth,t=Math.round(i/2),e=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-t+e)%i+t-e,a=(n+t+e)%i-t-e,r=Math.abs(o+e)<Math.abs(a+e)?o:a;this._draggable._newPos.x=r},_onDragEnd:function(i){var t=this._map,e=t.options,n=+new Date-this._lastTime,o=!e.inertia||n>e.inertiaThreshold||!this._positions[0];if(t.stimulate("dragend",i),o)t.stimulate("moveend");else{var a=this._lastPos.subtract(this._positions[0]),r=(this._lastTime+n-this._times[0])/1e3,s=e.easeLinearity,l=a.multiplyBy(s/r),h=l.distanceTo([0,0]),c=Math.min(e.inertiaMaxSpeed,h),p=l.multiplyBy(c/h),u=c/(e.inertiaDeceleration*s),M=p.multiplyBy(-u/2).round();M.x&&M.y?(M=t._limitOffset(M,t.options.maxBounds),ViaMichelin.Api.Util.Core.requestAnimFrame(function(){t.panBy(M,{duration:u,easeLinearity:s,noMoveStart:!0})})):t.stimulate("moveend")}},toString:function(){return"[ViaMichelin.Api.MMap.Core.Map.Handler.Drag]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Handler.Drag),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Handler.DualTap"),ViaMichelin.Api.MMap.Core.Map.Handler.DualTap=function(i){this.extend(ViaMichelin.Api.MMap.Core.Map.Handler),this._map=i},ViaMichelin.Api.MMap.Core.Map.Handler.DualTap.prototype={mergeOptions:{dualTap:{timeTolerance:400,tapTolerance:15}},_activated:!1,addHooks:function(){ViaMichelin.Api.Util.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ViaMichelin.Api.Util.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(i){if(i.touches){if(ViaMichelin.Api.Util.DomEvent.preventDefault(i),this._fireClick=!0,this._timer=new Date,i.touches.length<=1)return void(this._fireClick=!1);if(!this._activated){var t=i.touches[0],e=i.touches[1];this._startPos=this._newPos=[this._map.mouseEventToContainerPoint(t),this._map.mouseEventToContainerPoint(e)],this._activated=!0,ViaMichelin.Api.Util.DomEvent.on(document,{touchmove:this._onMove,touchend:this._onUp},this)}}},_onMove:function(i){var t,e;i.touches&&2===i.touches.length&&(t=i.touches[0],e=i.touches[1],this._newPos=[this._map.mouseEventToContainerPoint(t),this._map.mouseEventToContainerPoint(e)],this._isTapValid(this._startPos[0],this._newPos[0])&&this._isTapValid(this._startPos[1],this._newPos[1])||(this._fireClick=!1))},_isTapValid:function(i,t){return i.distanceTo(t)<=this._map.options.dualTap.tapTolerance},_onUp:function(i){var t;if(0===i.touches.length&&this._activated&&(this._activated=!1,ViaMichelin.Api.Util.DomEvent.off(document,{touchmove:this._onMove,touchend:this._onUp},this),t=Date.now()-this._timer,t<=this._map.options.dualTap.timeTolerance&&this._fireClick)){var e={containerPoint:this._startPos[0]._add(this._startPos[1])._divideBy(2)};e.layerPoint=this._map.containerPointToLayerPoint(e.containerPoint),e.latlon=this._map.layerPointToLatLon(e.layerPoint),this._map.stimulate("dualTap",e)}},toString:function(){return"[ViaMichelin.Api.MMap.Core.Map.Handler.DualTap]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Handler.DualTap),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Handler.ScrollWheelZoom"),ViaMichelin.Api.MMap.Core.Map.Handler.ScrollWheelZoom=function(i){this.extend(ViaMichelin.Api.MMap.Core.Map.Handler),this._map=i},ViaMichelin.Api.MMap.Core.Map.Handler.ScrollWheelZoom.prototype={mergeOptions:{scrollWheelZoom:!0,wheelDebounceTime:40},addHooks:function(){ViaMichelin.Api.Util.DomEvent.on(this._map._container,{mousewheel:this._onWheelScroll,MozMousePixelScroll:ViaMichelin.Api.Util.DomEvent.preventDefault},this),this._delta=0},removeHooks:function(){ViaMichelin.Api.Util.DomEvent.off(this._map._container,{mousewheel:this._onWheelScroll,MozMousePixelScroll:ViaMichelin.Api.Util.DomEvent.preventDefault},this)},_onWheelScroll:function(i){var t=ViaMichelin.Api.Util.DomEvent.getWheelDelta(i),e=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(i),this._startTime||(this._startTime=+new Date);var n=Math.max(e-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(ViaMichelin.Api.Util.Core.bind(this._performZoom,this),n),ViaMichelin.Api.Util.DomEvent.stop(i)},_performZoom:function(){var i=this._map,t=this._delta,e=i.getZoom();t=t>0?Math.ceil(t):Math.floor(t),t=Math.max(Math.min(t,4),-4),t=i._limitZoom(e+t)-e,this._delta=0,this._startTime=null,t&&("center"===i.options.scrollWheelZoom?i.setZoom(e+t):i.setZoomAround(this._lastMousePos,e+t))},toString:function(){return"[ViaMichelin.Api.MMap.Core.Map.Handler.ScrollWheelZoom]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Handler.ScrollWheelZoom),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Handler.Tap"),ViaMichelin.Api.MMap.Core.Map.Handler.Tap=function(i){this.extend(ViaMichelin.Api.MMap.Core.Map.Handler),this._map=i},ViaMichelin.Api.MMap.Core.Map.Handler.Tap.prototype={mergeOptions:{tap:!0,tapTolerance:15},addHooks:function(){ViaMichelin.Api.Util.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){ViaMichelin.Api.Util.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(i){if(i.touches){if(ViaMichelin.Api.Util.DomEvent.preventDefault(i),this._fireClick=!0,i.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var t=i.touches[0],e=t.target;this._startPos=this._newPos=new ViaMichelin.Api.MMap.Core.Geometry.Point(t.clientX,t.clientY),e.tagName&&"a"===e.tagName.toLowerCase()&&ViaMichelin.Api.Util.Dom.addClass(e,"mmap-active"),this._holdTimeout=setTimeout(ViaMichelin.Api.Util.Core.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",t))},this),1e3),this._simulateEvent("mousedown",t),ViaMichelin.Api.Util.DomEvent.on(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(i){if(clearTimeout(this._holdTimeout),ViaMichelin.Api.Util.DomEvent.off(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&i&&i.changedTouches){var t=i.changedTouches[0],e=t.target;e&&e.tagName&&"a"===e.tagName.toLowerCase()&&ViaMichelin.Api.Util.Dom.removeClass(e,"mmap-active"),this._simulateEvent("mouseup",t),this._isTapValid()&&this._simulateEvent("click",t)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(i){var t=i.touches[0];this._newPos=new ViaMichelin.Api.MMap.Core.Geometry.Point(t.clientX,t.clientY)},_simulateEvent:function(i,t){var e=document.createEvent("MouseEvents");e._simulated=!0,t.target._simulatedClick=!0,e.initMouseEvent(i,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(e)},toString:function(){return"[ViaMichelin.Api.MMap.Core.Map.Handler.Tap]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Handler.Tap),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Handler.TouchZoom"),ViaMichelin.Api.MMap.Core.Map.Handler.TouchZoom=function(i){this.extend(ViaMichelin.Api.MMap.Core.Map.Handler),this._map=i},ViaMichelin.Api.MMap.Core.Map.Handler.TouchZoom.prototype={mergeOptions:{touchZoom:{pixelTolerance:10,percentTolerance:.2}},_moveActivated:!1,addHooks:function(){ViaMichelin.Api.Util.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){ViaMichelin.Api.Util.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(i){var t=this._map;if(i.touches&&2===i.touches.length&&!t._animatingZoom&&!this._zooming){var e=t.mouseEventToLayerPoint(i.touches[0]),n=t.mouseEventToLayerPoint(i.touches[1]),o=t._getCenterLayerPoint();this._startCenter=e.add(n)._divideBy(2),this._startDist=e.distanceTo(n),this._moved=!1,this._zooming=!0,this._centerOffset=o.subtract(this._startCenter),t._panAnim&&t._panAnim.stop(),ViaMichelin.Api.Util.DomEvent.on(document,"touchmove",this._onTouchMove,this).on(document,"touchend",this._onTouchEnd,this),ViaMichelin.Api.Util.DomEvent.preventDefault(i)}},_onTouchMove:function(i){if(i.touches&&2===i.touches.length&&this._zooming){var t=this._map,e=t.mouseEventToLayerPoint(i.touches[0]),n=t.mouseEventToLayerPoint(i.touches[1]);if(this._scale=e.distanceTo(n)/this._startDist,this._delta=e._add(n)._divideBy(2)._subtract(this._startCenter),!(1===this._scale||t.getZoom()===t.getMinZoom()&&this._scale<1||t.getZoom()===t.getMaxZoom()&&this._scale>1)){if(!this._moveActivated){if(!(this._scale>1+t.options.touchZoom.percentTolerance||this._scale<1-t.options.touchZoom.percentTolerance||this._delta.x>t.options.touchZoom.pixelTolerance||this._delta.x<-t.options.touchZoom.pixelTolerance||this._delta.y>t.options.touchZoom.pixelTolerance||this._delta.y<-t.options.touchZoom.pixelTolerance))return;this._moveActivated=!0}if(!t.options.bounceAtZoomLimits){var o=t.getScaleZoom(this._scale);if(o<=t.getMinZoom()&&this._scale<1||o>=t.getMaxZoom()&&this._scale>1)return}this._moved||(t.stimulate("movestart"),t.stimulate("zoomstart"),this._moved=!0),ViaMichelin.Api.Util.Core.cancelAnimFrame(this._animRequest),this._animRequest=ViaMichelin.Api.Util.Core.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),ViaMichelin.Api.Util.DomEvent.preventDefault(i)}}},_updateOnMove:function(){var i=this._map;this._center="center"===i.options.touchZoom?i.getCenter():i.layerPointToLatLon(this._getTargetCenter()),this._zoom=i.getScaleZoom(this._scale),i._animateZoom(this._center,this._zoom)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);this._moveActivated=!1,this._zooming=!1,ViaMichelin.Api.Util.Core.cancelAnimFrame(this._animRequest),ViaMichelin.Api.Util.DomEvent.off(document,"touchmove",this._onTouchMove).off(document,"touchend",this._onTouchEnd);var i=this._map,t=i.getZoom(),e=this._zoom-t,n=i._limitZoom(t+(e>0?Math.ceil(e):Math.floor(e)));i._animateZoom(this._center,n,!0)},_getTargetCenter:function(){var i=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(i)},toString:function(){return"[ViaMichelin.Api.MMap.Core.Map.Handler.TouchZoom]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Handler.TouchZoom),JSEPackage("ViaMichelin.Api.MMap.Core.Map.ILayer"),ViaMichelin.Api.MMap.Core.Map.ILayer=function(){},ViaMichelin.Api.MMap.Core.Map.ILayer.prototype={addLayer:function(){},removeLayer:function(){},hasLayer:function(){},eachLayer:function(){}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.ILayer),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Modular"),ViaMichelin.Api.MMap.Core.Map.Modular=function(){},ViaMichelin.Api.MMap.Core.Map.Modular.prototype={loadModule:function(i){var t=new i(this);t.mergeOptions&&ViaMichelin.Api.Util.Object.mixAttributes(this.options,t.mergeOptions),ViaMichelin.Api.Util.Core.extend(this,t.load(this))},toString:function(){return"[ViaMichelin.Api.MMap.Core.Map.Modular]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Modular),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Module.Animation.Pan"),ViaMichelin.Api.MMap.Core.Map.Module.Animation.Pan=function(){},ViaMichelin.Api.MMap.Core.Map.Module.Animation.Pan.prototype={load:function(){return{setView:function(i,t,e){if(t=void 0===t?this._zoom:this._limitZoom(t),i=this._limitCenter(ViaMichelin.Api.MMap.Core.Geo.latLon(i),t,this.options.maxBounds),e=e||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!e.reset&&e!==!0){void 0!==e.animate&&(e.zoom=ViaMichelin.Api.Util.Core.extend({animate:e.animate},e.zoom),e.pan=ViaMichelin.Api.Util.Core.extend({animate:e.animate},e.pan));var n=this._zoom!==t?e.animatedZoom!==!1&&this._tryAnimatedZoom&&this._tryAnimatedZoom(i,t,e.zoom):this._tryAnimatedPan(i,e.pan);if(n)return clearTimeout(this._sizeTimer),this}return this._resetView(i,t),this},panBy:function(i,t){if(i=ViaMichelin.Api.MMap.Core.Geometry.point(i).round(),t=t||{},!i.x&&!i.y)return this;if(t.animate!==!0&&!this.getSize().contains(i))return this._resetView(this.unproject(this.project(this.getCenter()).add(i)),this.getZoom());if(this._panAnim||(this._panAnim=new ViaMichelin.Api.MMap.Core.Dom.Animation.Position,this._panAnim.plugWire("step",this._onPanTransitionStep,this),this._panAnim.plugWire("end",this._onPanTransitionEnd,this)),t.noMoveStart||this.stimulate("movestart"),t.animate!==!1){ViaMichelin.Api.Util.Dom.addClass(this._mapPane,"mmap-pan-anim");var e=this._getMapPanePos().subtract(this._limitOffset(i));this._panAnim.run(this._mapPane,e,t.duration||.25,t.easeLinearity)}else this._rawPanBy(this._limitOffset(i)),this.stimulate("move"),this.stimulate("moveend");return this},_limitOffset:function(i){if(this.options.maxBounds){var t,e,n=this.getSize();return t=ViaMichelin.Api.MMap.Core.Geo.latLonBounds(this.options.maxBounds),e=new ViaMichelin.Api.MMap.Core.Geometry.Bounds(this.project(t.getSouthWest(),this.getZoom()),this.project(t.getNorthEast(),this.getZoom())),e.getSize().y<=n.y?i.y=0:i.y<0&&Math.ceil(e.min.y)-this._getTopLeftPoint().y>=i.y?i.y=Math.ceil(e.min.y)-this._getTopLeftPoint().y:i.y>0&&Math.ceil(e.max.y)-(this._getTopLeftPoint().y+n.y+i.y)<=0&&(i.y=Math.ceil(e.max.y)-(this._getTopLeftPoint().y+n.y)),e.getSize().x<=n.x?i.x=0:i.x<0&&this._getTopLeftPoint().x+i.x<=Math.ceil(e.min.x)?i.x=Math.ceil(e.min.x)-this._getTopLeftPoint().x:i.x>0&&Math.ceil(e.max.x)-(this._getTopLeftPoint().x+n.x+i.x)<=0&&(i.x=Math.ceil(e.max.x)-(this._getTopLeftPoint().x+n.x)),i}return i},_onPanTransitionStep:function(){this.stimulate("move")},_onPanTransitionEnd:function(){ViaMichelin.Api.Util.Dom.removeClass(this._mapPane,"mmap-pan-anim"),this.stimulate("moveend")},_tryAnimatedPan:function(i,t){var e=this._getCenterOffset(i)._floor();return(t&&t.animate)===!0||this.getSize().contains(e)?(this.panBy(e,t),!0):!1}}}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Module.Animation.Pan),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Module.Animation.Zoom"),ViaMichelin.Api.MMap.Core.Map.Module.Animation.Zoom=function(i){ViaMichelin.Api.MMap.Core.Map.Module.Animation.Zoom.prototype.isZoomAnimated()&&i.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation,this._zoomAnimated&&ViaMichelin.Api.Util.DomEvent.on(this._mapPane,ViaMichelin.Api.Util.Dom.TRANSITION_END,this._catchTransitionEnd,this)})},ViaMichelin.Api.MMap.Core.Map.Module.Animation.Zoom.prototype={isZoomAnimated:function(){return ViaMichelin.Api.Util.Dom.TRANSITION&&ViaMichelin.Api.Util.Browser.any3d&&!ViaMichelin.Api.Util.Browser.mobileOpera},load:function(){return ViaMichelin.Api.MMap.Core.Map.Module.Animation.Zoom.prototype.isZoomAnimated()?{_catchTransitionEnd:function(i){this._animatingZoom&&i.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("mmap-zoom-animated").length},_tryAnimatedZoom:function(i,t,e){if(this._animatingZoom)return!0;if(e=e||{},!this._zoomAnimated||e.animate===!1||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(t),o=this._getCenterOffset(i)._divideBy(1-1/n);return e.animate===!0||this.getSize().contains(o)?(ViaMichelin.Api.Util.Core.requestAnimFrame(function(){this.stimulate("movestart"),this.stimulate("zoomstart"),this._animateZoom(i,t,!0)},this),!0):!1},_animateZoom:function(i,t,e){e&&(this._animatingZoom=!0,this._animateToCenter=i,this._animateToZoom=t,ViaMichelin.Api.MMap.Core.Dom.Draggable&&(ViaMichelin.Api.MMap.Core.Dom.Draggable._disabled=!0),ViaMichelin.Api.Util.Dom.addClass(this._mapPane,"mmap-zoom-anim"));var n=this.getZoomScale(t),o=this._getCenterLayerPoint().add(this._getCenterOffset(i)._divideBy(1-1/n));isFinite(o.x)&&isFinite(o.y)?this.stimulate("zoomanim",{center:i,zoom:t,origin:o,scale:n}):(this._animateToCenter=this.getCenter(),this._animateToZoom=this.getZoom(),this._onZoomTransitionEnd())},_onZoomTransitionEnd:function(){this._animatingZoom=!1,ViaMichelin.Api.Util.Dom.removeClass(this._mapPane,"mmap-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),ViaMichelin.Api.MMap.Core.Dom.Draggable&&(ViaMichelin.Api.MMap.Core.Dom.Draggable._disabled=!1)}}:{}},toString:function(){return"[ViaMichelin.Api.MMap.Core.Map.Module.Animation.Zoom]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Module.Animation.Zoom),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Module.Control"),ViaMichelin.Api.MMap.Core.Map.Module.Control=function(i){this._map=i},ViaMichelin.Api.MMap.Core.Map.Module.Control.prototype={load:function(){return{addControl:function(i){return i.addTo(this),this},removeControl:function(i){return i.removeFrom(this),this},_initControls:function(){function i(i,o){var a=e+i+" "+e+o;t[i+o]=ViaMichelin.Api.Util.Dom.create("div",a,n)}var t=this._controlCorners={},e="position-",n=this._controlContainer=ViaMichelin.Api.Util.Dom.create("div","map-control-container",this._container);i("top","left"),i("top","right"),i("bottom","left"),i("bottom","right")},_clearControlPos:function(){this._container.hasChildNodes(this._controlContainer)&&this._container.removeChild(this._controlContainer)}}},toString:function(){return"[ViaMichelin.Api.MMap.Core.Map.Module.Control]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Module.Control),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Module.Css"),ViaMichelin.Api.MMap.Core.Map.Module.Css=function(){},ViaMichelin.Api.MMap.Core.Map.Module.Css.prototype={load:function(){return{loadCss:function(i){if($isDefined(this.options.loadInternalCss)&&this.options.loadInternalCss){var t,e,n,o,a="ApiMMap";t=e=200,n=ViaMichelin.Api.Util.Css.generateUrlCss(a,""),ViaMichelin.Api.Util.Css.loadCss(a,n);var r=setInterval(function(){o=ViaMichelin.Api.Util.Css.isDefinedSelector("is"+a+"Imported"),(o||t>=1e3)&&(clearInterval(r),i()),t+=e},e);n=ViaMichelin.Api.Util.Css.generateUrlCss("skin/"+this.options.skin,""),ViaMichelin.Api.Util.Css.loadCss(this.options.skin,n)}}}}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Module.Css),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Module.Geolocation"),JSEImportApi("ViaMichelin.Api.Constants.Exception"),ViaMichelin.Api.MMap.Core.Map.Module.Geolocation=function(){},ViaMichelin.Api.MMap.Core.Map.Module.Geolocation.prototype={load:function(){var i={timeout:1e4,watch:!1};return{_locationWatchId:-1,locate:function(t){if(-1!==this._locationWatchId)return this;if(t=this._locateOptions=ViaMichelin.Api.Util.Core.extend(ViaMichelin.Api.Util.Object.clone(i),t),!navigator.geolocation)return this._handleGeolocationError({code:ViaMichelin.Api.Constants.Exception.GEOLOCATION_NOT_SUPPORTED,message:"Geolocation not supported."}),this;var e=ViaMichelin.Api.Util.Core.bind(this._handleGeolocationResponse,this),n=ViaMichelin.Api.Util.Core.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,n,t):navigator.geolocation.getCurrentPosition(e,n,t),this},stopLocate:function(){return navigator.geolocation&&(navigator.geolocation.clearWatch(this._locationWatchId),this._locationWatchId=-1),this._locateOptions&&(this._locateOptions.setView=!1),this._locateCircle&&(this._locateCircle.removeFrom(this),this._locateCircle=null),this},_handleGeolocationError:function(i){var t=i.code,e=i.message||(1===t?"permission denied":2===t?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.stimulate("locationerror",{code:t,message:"Geolocation error: "+e+"."})},_handleGeolocationResponse:function(i){var t=i.coords.latitude,e=i.coords.longitude,n=new ViaMichelin.Api.MMap.Core.Geo.LatLon(t,e),o=i.coords.accuracy,a=180*i.coords.accuracy/40075017,r=a/Math.cos(Math.PI/180*t),s=ViaMichelin.Api.MMap.Core.Geo.latLonBounds([t-a,e-r],[t+a,e+r]),l=this._locateOptions;if(l.setView){var h=this.getBoundsZoom(s);this.setView(n,l.maxZoom?Math.min(h,l.maxZoom):h)}l.setMarker&&(this._locateCircle||(this._locateCircle=new ViaMichelin.Api.MMap.Core.Layer.Vector.Circle(n,o),this._locateCircle.addTo(this)),this._locateCircle.setLatLon(n),this._locateCircle.setRadius(o));var c={latlon:n,bounds:s,timestamp:i.timestamp};for(var p in i.coords)"number"==typeof i.coords[p]&&(c[p]=i.coords[p]);this.stimulate("locationfound",c)}}},toString:function(){return"[ViaMichelin.Api.MMap.Core.Map.Module.Geolocation]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Module.Geolocation),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Module.Layer"),ViaMichelin.Api.MMap.Core.Map.Module.Layer=function(){},ViaMichelin.Api.MMap.Core.Map.Module.Layer.prototype={load:function(){return{addLayer:function(i){var t=ViaMichelin.Api.Util.Core.stamp(i);return this._layers[t]?i:(this._layers[t]=i,i._map=this,i.beforeAdd&&i.beforeAdd(this),this.whenReady(i._layerAdd,i),this)},removeLayer:function(i){var t=ViaMichelin.Api.Util.Core.stamp(i);if(!this._layers[t])return this;if(this._loaded&&i.onRemove(this),i.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(i.getAttribution()),i.getEvents){var e,n=i.getEvents();for(e in n)this.unplugWire(e,n[e],i)}return delete this._layers[t],this._loaded&&(this.stimulate("layerremove",{layer:i}),i.stimulate("remove")),i._map=null,this},hasLayer:function(i){return!!i&&ViaMichelin.Api.Util.Core.stamp(i)in this._layers},eachLayer:function(i,t){for(var e in this._layers)i.call(t,this._layers[e]);return this},_addLayers:function(i){i=i?ViaMichelin.Api.Util.Core.isArray(i)?i:[i]:[];for(var t=0,e=i.length;e>t;t++)this.addLayer(i[t])},_addZoomLimit:function(i){(isNaN(i.options.maxZoom)||!isNaN(i.options.minZoom))&&(this._zoomBoundLayers[ViaMichelin.Api.Util.Core.stamp(i)]=i,this._updateZoomLevels())},_removeZoomLimit:function(i){var t=ViaMichelin.Api.Util.Core.stamp(i);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var i=1/0,t=-1/0,e=this._getZoomSpan();for(var n in this._zoomBoundLayers){var o=this._zoomBoundLayers[n].options;i=void 0===o.minZoom?i:Math.min(i,o.minZoom),t=void 0===o.maxZoom?t:Math.max(t,o.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=1/0===i?void 0:i,e!==this._getZoomSpan()&&this.stimulate("zoomlevelschange")
}}}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Module.Layer),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Module.Popup"),ViaMichelin.Api.MMap.Core.Map.Module.Popup=function(){},ViaMichelin.Api.MMap.Core.Map.Module.Popup.prototype={load:function(){return{_popup:null,openPopup:function(i,t,e){return i instanceof ViaMichelin.Api.MMap.Core.Layer.Popup||(i=new ViaMichelin.Api.MMap.Core.Layer.Popup(e).setContent(i)),t&&i.setLatLon(t),this.hasLayer(i)?this:(this.closePopup(),this._popup=i,this.addLayer(i))},closePopup:function(i){return i&&i!==this._popup||(i=this._popup,this._popup=null),i&&this.removeLayer(i),this},getPopup:function(){return this._popup}}},toString:function(){return"[ViaMichelin.Api.MMap.Core.Map.Module.Popup]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Module.Popup),JSEPackage("ViaMichelin.Api.MMap.Core.Map.Module.Renderer"),ViaMichelin.Api.MMap.Core.Map.Module.Renderer=function(){},ViaMichelin.Api.MMap.Core.Map.Module.Renderer.prototype={load:function(){return{getRenderer:function(i){var t=i.options.renderer||this.options.renderer||this._renderer;return t||(t=this._renderer=ViaMichelin.Api.MMap.Core.Layer.Vector.SVG&&ViaMichelin.Api.MMap.Core.Layer.Vector.svg()||ViaMichelin.Api.MMap.Core.Layer.Vector.Canvas&&ViaMichelin.Api.MMap.Core.Layer.Vector.canvas()),this.hasLayer(t)||this.addLayer(t),t}}},toString:function(){return"[ViaMichelin.Api.MMap.Core.Map.Module.Renderer]"}},ToJSEObject(ViaMichelin.Api.MMap.Core.Map.Module.Renderer),JSEPackage("ViaMichelin.Api.MMap.Module.Control.Copyright"),ViaMichelin.Api.MMap.Module.Control.Copyright=function(i){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Control),ViaMichelin.Api.Util.Object.setOptions(this,i)},ViaMichelin.Api.MMap.Module.Control.Copyright.prototype={options:{position:"bottomright"},onAdd:function(i){var t="mmap-control-copyright",e=this.options,n=ViaMichelin.Api.Util.Dom.create("div",t);return this._container=n,this._map=i,i.plugWire(e.updateWhenIdle?"moveend":"move",this._update,this),i.plugWire("layeradd",this._update,this),i.plugWire("layerremove",this._update,this),i.whenReady(this._update,this),n},onRemove:function(i){i.unplugWire(this.options.updateWhenIdle?"moveend":"move",this._update,this),i.unplugWire("layeradd",this._update,this),i.unplugWire("layerremove",this._update,this)},toString:function(){return"[ViaMichelin.Api.MMap.Module.Control.Copyright]"},_update:function(){var i,t,e,n="",o=this._container.innerHTML;i=this._map._microCatalog.getLocaleCopyrights(),i&&i.list&&(t=this._map.getLocale(),e=i.list[t],e||(e=i.list[i["default"]]),e=e.replace(/https:\/\//,"http://"),n=this._getCopyrightsLogo(e,this._map._microCatalog.getCopyright(this._map.options.mapStyle).join(" "))),o!==n&&(this._container.innerHTML=n)},_getCopyrightsLogo:function(i,t){return'<a href="'+i+'" class="mmap-copyright-logo" target="_blank"></a><span class="mmap-label">'+t+"</span>"}},ToJSEObject(ViaMichelin.Api.MMap.Module.Control.Copyright),JSEPackage("ViaMichelin.Api.MMap.Module.Control.Logo"),ViaMichelin.Api.MMap.Module.Control.Logo=function(i){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Control),ViaMichelin.Api.Util.Object.setOptions(this,i)},ViaMichelin.Api.MMap.Module.Control.Logo.prototype={onAdd:function(i){var t="mmap-control-logo",e=ViaMichelin.Api.Util.Dom.create("div",t);return this._container=e,this._map=i,e},toString:function(){return"[ViaMichelin.Api.MMap.Module.Control.Logo]"}},ToJSEObject(ViaMichelin.Api.MMap.Module.Control.Logo),JSEPackage("ViaMichelin.Api.MMap.Module.Control.Scale"),ViaMichelin.Api.MMap.Module.Control.Scale=function(i){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Control),ViaMichelin.Api.Util.Object.setOptions(this,i)},ViaMichelin.Api.MMap.Module.Control.Scale.prototype={options:{position:"bottomright",maxWidth:70,metric:!0,imperial:!0},onAdd:function(i){var t="mmap-control-scale",e=ViaMichelin.Api.Util.Dom.create("div",t),n=this.options;return this._addScales(n,t+"-line",e),i.plugWire(n.updateWhenIdle?"moveend":"move",this._update,this),i.whenReady(this._update,this),e},onRemove:function(i){i.unplugWire(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(i,t,e){var n;ViaMichelin.Api.Util.Css.isIE8CSS()&&(e.className+=" ie8"),i.metric&&(n={type:"radio",name:"mmap-control-scale",id:"mmap-control-scale-metric",checked:"checked"},this._mScaleRadio=ViaMichelin.Api.Util.Dom.createCompatibleFieldElement("input",n),e.appendChild(this._mScaleRadio)),i.imperial&&(n={type:"radio",name:"mmap-control-scale",id:"mmap-control-scale-imperial",checked:""},this._iScaleRadio=ViaMichelin.Api.Util.Dom.createCompatibleFieldElement("input",n),e.appendChild(this._iScaleRadio)),i.metric&&(n={name:"mmap-control-scale",htmlFor:"mmap-control-scale-imperial"},this._mScale=ViaMichelin.Api.Util.Dom.createCompatibleFieldElement("label",n),this._mScale.className=t+" metric",e.appendChild(this._mScale)),i.imperial&&(n={name:"mmap-control-scale",htmlFor:"mmap-control-scale-metric"},this._iScale=ViaMichelin.Api.Util.Dom.createCompatibleFieldElement("label",n),this._iScale.className=t+" imperial",e.appendChild(this._iScale))},_update:function(){var i,t=this._map,e=t.getSize().y/2;i="bottomleft"===this.options.position||"bottomright"===this.options.position?[[0,e],[this.options.maxWidth,e]]:[[0,0],[this.options.maxWidth,0]];var n=ViaMichelin.Api.MMap.Core.Geo.Crs.Earth.prototype.distance(t.containerPointToLatLon(i[0]),t.containerPointToLatLon(i[1]));this._updateScales(n)},_updateScales:function(i){this.options.metric&&i&&this._updateMetric(i),this.options.imperial&&i&&this._updateImperial(i)},_updateMetric:function(i){var t=this._getRoundNum(i),e=1e3>t?t+" m":t/1e3+" km";this._updateScale(this._mScale,e,t/i)},_updateImperial:function(i){var t,e,n,o=3.2808399*i;o>5280?(t=o/5280,e=this._getRoundNum(t),this._updateScale(this._iScale,e+" mi",e/t)):(n=this._getRoundNum(o),this._updateScale(this._iScale,n+" ft",n/o))},_updateScale:function(i,t,e){i.style.width=Math.round(this.options.maxWidth*e)+"px",i.innerHTML=t},_getRoundNum:function(i){var t=Math.pow(10,(Math.floor(i)+"").length-1),e=i/t;return e=e>=10?10:e>=5?5:e>=3?3:e>=2?2:1,t*e},toString:function(){return"[ViaMichelin.Api.MMap.Module.Control.Scale]"}},ToJSEObject(ViaMichelin.Api.MMap.Module.Control.Scale),JSEPackage("ViaMichelin.Api.MMap.Module.Core.Traffic"),JSEImportApi("ViaMichelin.Api.MMap.Module.ClusteredPois.Layer"),JSEImportApi("ViaMichelin.Api.MMap.Module.ClusteredPois.Configuration"),ViaMichelin.Api.MMap.Module.Core.Traffic=function(){},ViaMichelin.Api.MMap.Module.Core.Traffic.prototype={mergeOptions:{traffic:!1,trafficOptions:{traficolor:!0,events:!1,typesEvents:["MSGEVT_FRANCE_BS"],stylesEvents:{MSGEVT_FRANCE_BS:{style:{color:"#000",weight:1,fillColor:"#D3932D",fill:!0,fillOpacity:1,radius:4}}},fireEvents:!1}},load:function(i){return function(){function t(){var i,t,e;n._trafficLayers&&(n._trafficLayers.removeFrom(this),n._trafficLayers=null);try{n.options.trafficOptions&&(i=n._microCatalog.getMapStyle(n.options.mapStyle),i&&(t=i.getLayer("traffic")),t&&(o=!0,e=n.options.trafficOptions,e.microCatalogStyleLayer=t,n._trafficLayers=new ViaMichelin.Api.MMap.Module.Traffic.Layer(e),n._trafficLayers.addTo(n)))}catch(a){o=!1,n.removeLayer(n._trafficLayers),n._eraseMicroCatalogStorage()}}function e(){n._trafficLayers&&(o=!1,n._trafficLayers.removeFrom(n),n._trafficLayers="")}var n=i,o=!1;return{hasTraffic:function(){return o?!0:!1},setTraffic:function(i,n){this.options.traffic=i,ViaMichelin.Api.Util.Core.extend(this.options.trafficOptions,n),i?this.hasTraffic()||t():e()}}}()},toString:function(){return"[ViaMichelin.Api.MMap.Module.Core.Traffic]"}},ToJSEObject(ViaMichelin.Api.MMap.Module.Core.Traffic),JSEPackage("ViaMichelin.Api.MMap.Module.Core.Weather"),ViaMichelin.Api.MMap.Module.Core.Weather=function(){},ViaMichelin.Api.MMap.Module.Core.Weather.prototype={load:function(){return function(){function i(i,e,n){function o(t,e,n,o){"on"===n?i.plugWire(t,e,o):i.unplugWire(t,e,o)}var a;for(n=n||"on",a=0;a<e.length;a++)o(e[a],t,n,this)}function t(){var i=ViaMichelin.Api.Util.Object.clone(n),t=e.getBounds(),o=ViaMichelin.Api.MMap.Core.Geo.latLonBounds([-90,-180],[90,180]);t=t.constraint(o),i.geobounds={ne:t.getNorthEast(),sw:t.getSouthWest()},i.zoomLevel=e.getZoom(),JSELaunch("ViaMichelin.Api.Service.Weather",i,{onSuccess:function(i){e.stimulate("weatherfound",i)},onInitError:function(i,t){e.stimulate("weathererror",t)},onError:function(i){e.stimulate("weathererror",i)}},ViaMichelin.Api.Constants.System.ApiJSEPath)}var e,n,o=!1,a=["resize","moveend"];return{activateWeather:function(r){return o?this:(n=r?r:{},o=!0,e=this,i(this,a,"on"),t(),this)},deactivateWeather:function(){return o=!1,i(this,a,"off"),this}}}()},toString:function(){return"[ViaMichelin.Api.MMap.Module.Core.Weather]"}},ToJSEObject(ViaMichelin.Api.MMap.Module.Core.Weather),JSEPackage("ViaMichelin.Api.MMap.Module.Michelin"),ViaMichelin.Api.MMap.Module.Michelin=function(i){if(!i.mapStyle)throw"'mapStyle' must be specified";if(!i.lang)throw"'lang' must be specified";if(!i.microCatalog)throw"'microCatalog' must be specified";ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer.LayerGroup),ViaMichelin.Api.Util.Object.setOptions(this,i)},ViaMichelin.Api.MMap.Module.Michelin.prototype={_defaultLayers:null,_layersCreator:function(){var i,t,e,n;for(ViaMichelin.Api.MMap.Core.Layer.prototype._layerAdd.call(this,this._map),t=this.microCatalog.getMapStyle(this.options.mapStyle),e=t.getLayers({required:!0}),this._backgroundLayers=e,i=this._backgroundLayers.length-1;i>=0;i--)n=new ViaMichelin.Api.MMap.Module.Michelin.Layer.Tile(e[i]),n.addTo(this),n.setZIndex(e[i].getZOrder())},_layerAdd:function(i){return i=this._map?this._map:i.target,i&&(this.microCatalog=this.options.microCatalog,this._layersCreator()),this}},ToJSEObject(ViaMichelin.Api.MMap.Module.Michelin),JSEPackage("ViaMichelin.Api.MMap.Module.Michelin.Layer.Tile"),ViaMichelin.Api.MMap.Module.Michelin.Layer.Tile=function(i,t){var e=i.getPattern();this.options={subdomains:i.getSubdomains(),zIndex:i.zOrder,minZoom:1,maxZoom:19,keepInvisibleTilesRatio:3,unloadInvisibleTiles:!0},ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer.Tile.TileLayer,e,t),this._config=i},ViaMichelin.Api.MMap.Module.Michelin.Layer.Tile.prototype={getVersion:function(){return this._config.getVersion()},getFormat:function(){return this._config.getFormat()},getLocale:function(i){var t,e;return e=this,t={getZoom:function(){return i.z},getBounds:function(){var t,n,o,a;return t=new ViaMichelin.Api.MMap.Core.Geometry.Bounds([256*i.x,256*i.y+256-1],[256*i.x+256-1,256*i.y]),o=e._map.unproject(t.getBottomLeft(),i.z),a=e._map.unproject(t.getTopRight(),i.z),n=new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds(new ViaMichelin.Api.MMap.Core.Geo.LatLon(o.lat,o.lon),new ViaMichelin.Api.MMap.Core.Geo.LatLon(a.lat,a.lon))}},this._config.getLocale(t)},getTileUrl:function(i){var t=this._getSubdomain(i),e=ViaMichelin.Api.Util.Core.template(this._url,ViaMichelin.Api.Util.Core.extend({subdomain:t,version:this.getVersion(),format:this.getFormat(),z:this._getZoomForUrl(),x:i.x,y:i.y,quadkey:this._getQuadkey(i),locale:this.getLocale(i)},this.options));return ViaMichelin.Api.Util.Http.protocolAdapter(e)},beforeAdd:function(i){ViaMichelin.Api.MMap.Core.Layer.Tile.GridLayer.prototype.beforeAdd.call(this,i)},onRemove:function(i){ViaMichelin.Api.MMap.Core.Layer.Tile.GridLayer.prototype.onRemove.call(this,i)},toString:function(){return"[ViaMichelin.Api.MMap.Module.Michelin.Layer.Tile]"}},ToJSEObject(ViaMichelin.Api.MMap.Module.Michelin.Layer.Tile),JSEPackage("ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog"),ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog=function(i,t,e){if(!i)throw"'data' must be define";if(!t)throw"'map' must be define";if(!e)throw"'lang' must be define";this._data=i,this._map=t,this._lg=e,this._initialize()},ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.prototype={_initialize:function(){var m,i,j,k,copyrights,copyright,copyrightData,layer,layerObj,config,layerData,serverGroup,layerDescription;for(this.list=[],i=0;i<this._data.maps.length;i++){for(m=new ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle(this._data.maps[i],this._map,this._lg,this._locale),j=0;j<this._data.maps[i].layers.length;j++){if(layer=this._data.maps[i].layers[j],layerData={id:layer.id,_default:"string"==typeof layer.byDefault?eval(layer["default"]):layer["default"],_required:"string"==typeof layer.required?eval(layer.required):layer.required,_zOrder:layer.zOrder,_lg:this._lg},layer.refreshDelay&&(layerData._refreshDelay=layer.refreshDelay),config=this._getConfig(m.id,layer.id),ViaMichelin.Api.Util.Core.extend(layerData,{_params:config.params,_formats:config.formats,_versions:config.versions}),serverGroup=this._getServerGroup(config.serverGroupId),ViaMichelin.Api.Util.Core.extend(layerData,{_serverGroup:serverGroup}),layerDescription=this._getLayerDescription(layer.id),layerDescription&&layerDescription.labels&&ViaMichelin.Api.Util.Core.extend(layerData,{_labels:layerDescription.labels}),copyrights=[],config.copyrightIds){for(k=0;k<config.copyrightIds.length;k++)copyrightData=this._getCopyright(config.copyrightIds[k]),copyright=new ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle.Layer.Copyright(copyrightData,this._map),copyrights.push(copyright);ViaMichelin.Api.Util.Core.extend(layerData,{_copyrights:copyrights})}layerData._locale=this._getLocale(config.localeGroupId),layerObj=new ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle.Layer(layerData,this._map),m.addLayer(layerObj)}this.list.push(m)}},getLang:function(){return this._lg},getLocale:function(){return this._map.getLocale()},getLocaleCopyrights:function(){return this._data.localeCopyrights},getCopyright:function(i){for(var t=[],e=[],n=0;n<this.list.length;n++)if(this.list[n].id===i){var o,a,r=this.list[n];for(o=0;o<r.layers.length;o++){var s=r.layers[o];("traffic"!==s.id||this._map.hasTraffic())&&(t=t.concat(s.getCopyright(this._lg)))}var l;for(o=0;o<t.length;o++){for(l=!1,a=0;a<e.length;a++)e[a]===t[o]&&(l=!0);l||e.push(t[o])}break}return e},getMapStyle:function(i){if(!this._map)throw"you must load the microCatalog before";var t,e;for(t=0;t<this.list.length;t++)if(e=this.list[t],e.id===i)return e;return null},getMapStyleList:function(){if(!this._map)throw"you must load the microCatalog before";return this.list},toString:function(){return"[ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog]"},_getConfig:function(i,t){var e=this._getLayer(i,t);if(e)for(var n=0;n<this._data.configs.length;n++)if(e.confId===this._data.configs[n].id)return this._data.configs[n];return null},_getCopyright:function(i){for(var t=0;t<this._data.copyrights.length;t++)if(this._data.copyrights[t].id===i)return this._data.copyrights[t];return null},_getMap:function(i){for(var t=0;t<this._data.maps.length;t++)if(this._data.maps[t].id===i)return this._data.maps[t];return null},_getLayer:function(i,t){var e=this._getMap(i);if(e)for(var n=0;n<e.layers.length;n++)if(e.layers[n].id===t)return e.layers[n];return null},_getLayerDescription:function(i){for(var t=0;t<this._data.layerDescriptions.length;t++)if(this._data.layerDescriptions[t].id===i)return this._data.layerDescriptions[t];return null},_getLocale:function(i){if(this._data.localeGroups)for(var t=0;t<this._data.localeGroups.length;t++)if(this._data.localeGroups[t].id===i)return this._data.localeGroups[t];return null},_getServerGroup:function(i){for(var t=0;t<this._data.serverGroups.length;t++)if(this._data.serverGroups[t].id===i)return this._data.serverGroups[t];return null}},ToJSEObject(ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog),JSEPackage("ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle"),ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle=function(i,t,e){this.id=i.id,this.type=i.type,this.layers=[],this._map=t,this.lg=e,this.labels=i.labels},ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle.prototype={addLayer:function(i){return this.hasLayer(i)||this.layers.push(i),this},hasLayer:function(i){for(var t=0;t<this.layers.length;t++)if(this.layers[t].id===i.id)return!0;return!1},getLabel:function(i){return!i&&this.lg&&(i=this.lg),ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Util.getLabel(this.labels,i)},getLayer:function(i){for(var t=0;t<this.layers.length;t++)if(this.layers[t].id===i)return this.layers[t];return null},getLayers:function(i){if(i&&"boolean"==typeof i.required){var t,e,n,o=[];for(n=i.required,e=0;e<this.layers.length;e++)t=this.layers[e],t.isRequired()===n&&o.push(t);return o}return this.layers}},ToJSEObject(ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle),JSEPackage("ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle.Layer"),ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle.Layer=function(i,t){for(var e in i)i.hasOwnProperty(e)&&(this[e]=i[e]);this._map=t},ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle.Layer.prototype={id:"",_copyrights:null,_default:null,_formats:null,_labels:"",_lg:"",_params:null,_required:null,_serverGroup:null,_versions:null,_zOrder:0,_refreshDelay:0,getCopyright:function(i){var t,e,n=[];!i&&this._lg&&(i=this._lg);for(var o=0;o<this._copyrights.length;o++)t=this._copyrights[o],e=t.getLabel(i),t.isValid()&&n.push(e);return n},getLabel:function(i){return!i&&this._lg&&(i=this._lg),ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Util.getLabel(this._labels,i)},getLang:function(){return this._lg},getLocale:function(i){var t;if(this._locale){for(var e=0;e<this._locale.locales.length;e++)if(t=this._locale.locales[e],this._map.getLocale()===t.pattern&&ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Util.isRestrictionValid(t,i))return t.pattern;return this._locale.byDefault}return""},getFormat:function(){return"png"},getRefreshDelay:function(){return this._refreshDelay?this._refreshDelay:0},setRefreshDelay:function(i){this._refreshDelay=i},getVersion:function(){var i,t;if(this._versions)for(t=0;t<this._versions.length;t++)if(i=this._versions[t],ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Util.isRestrictionValid(i,this._map))return i.v;return""},getPattern:function(){var i=this._serverGroup.servers[0].pattern;if(this._params){var t=/\{ *([\w_]+) *\}/g,e={};for(var n in this._params)this._params.hasOwnProperty(n)&&(e[n]=this._params[n]);i=i.replace(t,function(i){for(var t in e)if(e.hasOwnProperty(t)&&i==="{"+t+"}")return e[t];return i})}return i},getSubdomains:function(){return this._serverGroup.subdomains?this._serverGroup.subdomains:[]},getZOrder:function(){return this._zOrder},isDefault:function(){return this._default},isRequired:function(){return this._required}},ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle.Layer.Copyright=function(i,t){for(var e in i)i.hasOwnProperty(e)&&(this[e]=i[e]);this._map=t},ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle.Layer.Copyright.prototype={getLabel:function(i){return ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Util.getLabel(this.labels,i)},isValid:function(){return ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Util.isRestrictionValid(this,this._map)}},ToJSEObject(ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.MapStyle.Layer),JSEPackage("ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Request"),ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Request=function(){this._storage=new ViaMichelin.Api.StorageManager},ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Request.prototype={_key:"microCatalog",request:function(i,t){var e=new JSE.HTTP.ApiRestRequest,n=this;if(!t){var o=this._get();if(o&&o.localeCopyrights)return i(o),!0}e.plugWire("responseLoaded",function(t){n._set(t),i(t)}),e.plugWire("responseCancelled",function(t){i({error:t})}),e.plugWire("responseError",function(t){i({error:t})}),e.request("MicroCatalog.json2","",10)},_get:function(){var i;return"object"==typeof JSON&&(i=this._storage.getItem(this._key))?i=i?JSON.parse(i):null:null},_set:function(i){return"object"==typeof JSON?this._storage.setItem(this._key,JSON.stringify(i)):void 0},getStoredVersion:function(){return this._get()},toString:function(){return"[ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Request]"}},ToJSEObject(ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Request),JSEPackage("ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Util"),ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Util={getLabel:function(i,t){for(var e="",n=0;n<i.length;n++){if(i[n].lg===t)return i[n].text;"*"===i[n].lg&&(e=i[n].text)}return e},isRestrictionValid:function(i,t){function e(i){return"number"==typeof i&&isFinite(i)}function n(i){var t,e;return t=ViaMichelin.Api.Util.Core.wrapNum(i.lat,[-90,90],!0),e=ViaMichelin.Api.Util.Core.wrapNum(i.lon,[-180,180],!0),new ViaMichelin.Api.MMap.Core.Geo.LatLon(t,e)}function o(i){var t,n,o,a,r;return e(i.longMin)&&e(i.longMax)?(a=i.longMax,n=i.longMin):(a=180,n=-180),e(i.latMin)&&e(i.latMax)?(r=i.latMax,o=i.latMin):(r=90,o=-90),t=new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds({lat:o,lon:n},{lat:r,lon:a})}function a(i,t){if(!i)return!0;var a,r,s,l,h,c,p,u=!0;if(a=t.getZoom(),p=t.getBounds(),i.boxes)for(var M=0;M<i.boxes.length;M++)if(u=!0,r=i.boxes[M],h=n(p.getSouthWest()),c=n(p.getNorthEast()),e(r.zoomMin)&&e(r.zoomMax)&&(r.zoomMin<=a&&r.zoomMax>=a||(u=!1)),u&&(s=o(r),l=new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds({lat:h.lat,lon:h.lon},{lat:c.lat,lon:c.lon}),s.intersects(l)))return!0;return!1}function r(i,t){if(!i)return!0;var a,r,s,l,h,c,p,u,M;if(a=t.getZoom(),h=t.getBounds(),i.boxes)for(var m=0;m<i.boxes.length;m++)if(s=0,r=i.boxes[m],l=o(r),p=!0,u=n(h.getSouthWest()),M=n(h.getNorthEast()),e(r.zoomMin)&&e(r.zoomMax)&&(r.zoomMin<=a&&r.zoomMax>=a||(p=!1)),p&&(c=new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds({lat:u.lat,lon:u.lon},{lat:M.lat,lon:M.lon}),l.contains(c)))return!1;return!0}var s,l,h=i.restriction;return h?(s=a(h.includes,t),l=r(h.excludes,t),s&&l):!0}},ToJSEObject(ViaMichelin.Api.MMap.Module.Michelin.MicroCatalog.Util),JSEPackage("ViaMichelin.Api.MMap.Module.Traffic.Layer"),JSEImportApi("ViaMichelin.Api.MMap.Module.ClusteredPois.Configuration"),JSEImportApi("ViaMichelin.Api.MMap.Module.Traffic.Layer.RefreshTraffic"),ViaMichelin.Api.MMap.Module.Traffic.Layer=function(i){if(!i.microCatalogStyleLayer)throw"Parameter required : 'microCatalogStyleLayer'";ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer.LayerGroup),ViaMichelin.Api.Util.Object.setOptions(this,i)},ViaMichelin.Api.MMap.Module.Traffic.Layer.prototype={_layerTraffic:"",_layerEvents:"",_refreshTraffic:"",_service:"",beforeAdd:function(){var i=this;this.plugWire("remove",this.release,this),this.options.traficolor&&(this._layerTraffic=new ViaMichelin.Api.MMap.Module.Michelin.Layer.Tile(this.options.microCatalogStyleLayer),this._layerTraffic.addTo(this),this._layerTraffic.setZIndex(this.options.microCatalogStyleLayer.getZOrder())),this.options.events&&(this._layerEvents=new ViaMichelin.Api.MMap.Module.Traffic.Layer.Events(this.options.stylesEvents),this._layerEvents.bindTitle(i._map),this.search()),(this.options.traficolor||this.options.events)&&(this._refreshTraffic=new ViaMichelin.Api.MMap.Module.Traffic.Layer.RefreshTraffic(this.options.microCatalogStyleLayer,i._map,function(){i._layerEvents&&i._service._search(),i._layerTraffic&&i._layerTraffic.redraw()}))},release:function(){this.unplugWire("remove",this.release,this),this._layerTraffic&&(this._refreshTraffic&&(this._refreshTraffic.release(),this._refreshTraffic=""),this._layerTraffic=""),this._layerEvents&&(this._layerEvents=""),this._service&&(this._service.release(),this._service="")},search:function(){function i(i){for(var t=[],e=0;e<i.typesEvents.length;e++){var n={param:{type:i.typesEvents[e]},type:"pod"};t.push(n)}return t}var t,e=this;t={search:i(e._map.options.trafficOptions),map:e._map},JSELaunch("ViaMichelin.Api.MMap.ServiceManager.GeoBoundedPois",t,{onInit:function(i){e._service=i,e._service.start()},data:function(i){e.options.fireEvents&&e._map.stimulate("trafficEvents",i),e._map.hasLayer(this._layerEvents)||e._layerEvents.addTo(e),e._layerEvents.setData(i,e._map.getZoom())}},ViaMichelin.Api.Constants.System.ApiJSEPath)}},ToJSEObject(ViaMichelin.Api.MMap.Module.Traffic.Layer),JSEPackage("ViaMichelin.Api.MMap.Module.Traffic.Layer.Events"),ViaMichelin.Api.MMap.Module.Traffic.Layer.Events=function(i){ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Core.Layer.LayerGroup),ViaMichelin.Api.Util.Object.extend(this,ViaMichelin.Api.MMap.Module.ClusteredPois.Layer.LayerTitle),this.keyList={},this._circleList=[],this.style=i},ViaMichelin.Api.MMap.Module.Traffic.Layer.Events.prototype={keyList:null,options:{pane:"overlayPane"},beforeAdd:function(i){this._renderer=ViaMichelin.Api.MMap.Core.Layer.Vector.SVG&&ViaMichelin.Api.MMap.Core.Layer.Vector.svg()||ViaMichelin.Api.MMap.Core.Layer.Vector.Canvas&&ViaMichelin.Api.MMap.Core.Layer.Vector.canvas(),i.plugWire("zoomstart",this._deletePopup,this)},onRemove:function(i){i.removeLayer(this._renderer),this._renderer="",this.clearLayers(),this._popup&&(this._popup.onRemove(i),this._popup="")},draw:function(){if(this._circleList.length>0){for(var i=0;i<this._circleList.length;i++)this._circleList[i].removeFrom(this._map);this._circleList=[]}if($isNotEmpty(this.keyList)){var t=this._map.getZoom(),e=this;for(var n in this.keyList)if(this.keyList.hasOwnProperty(n)&&this.keyList[n].list&&this.keyList[n].list.length>0)for(var o=0;o<this.keyList[n].list.length;o++){var a,r=this.keyList[n].list[o];if(t>=12)a=new ViaMichelin.Api.MMap.Core.Layer.Marker(r.coords,{icon:new ViaMichelin.Api.MMap.Core.Layer.Marker.Icon({iconUrl:ViaMichelin.Api.Constants.System.ApiImgPath+"all/traffic/"+r.p+".png",iconSize:[30,30]})}),a.addTo(this),this._circleList.push(a);else{var s;for(var l in this.style)this.style.hasOwnProperty(l)&&l===r.param&&(s=this.style[l].style);s.renderer=this._renderer,a=new ViaMichelin.Api.MMap.Core.Layer.Vector.Circle(r.coords,s.radius,s),this._circleList.push(a),a._project=function(){var i=this._map;this._point=i.latLonToLayerPoint(this._latlon),this._radius=this._mRadius,this._updateBounds()},a.getBounds=function(){var i=[this._radius,this._radius];return new ViaMichelin.Api.MMap.Core.Geo.LatLonBounds(this._map.layerPointToLatLon(this._point.subtract(i)),this._map.layerPointToLatLon(this._point.add(i)))},a._containsPoint=function(i){var t=s.radius,n=e._map.latLonToLayerPoint(this._latlon);return Math.abs(n.x-i.x)<=t&&Math.abs(n.y-i.y)<=t},a.addTo(this._map)}!function(i){var t;t={poi:i,latlon:i.coords},a.plugWire("mouseout",function(){e.stimulate("PoiOutEvent",t)},e),a.plugWire("mousemove",function(){e.stimulate("PoiMoveEvent",t)},e),a.plugWire("mouseover",function(){e.stimulate("PoiOverEvent",t)},e),a.plugWire("click",function(){var i=t;setTimeout(function(){var t='<div class="mmap-traffic-popup"><div class="mmap-traffic-picto"><img src="'+ViaMichelin.Api.Constants.System.ApiImgPath+"all/traffic/"+i.poi.p+'.png"/></div><div class="mmap-traffic-description">'+i.poi.desc+'</div><br class="clear"/></div>';e._popup=(new ViaMichelin.Api.MMap.Core.Layer.Popup).setLatLon(i.latlon).setContent(t).openOn(e._map)},200)},e)}(r)}this.stimulate("draw")}},getEvents:function(){var i={};return this._zoomAnimated&&(i.zoomstart=this._animateZoomStart,i.zoomend=this._animateZoomEnd),i},_animateZoomStart:function(){this._startAnim=!0},_animateZoomEnd:function(){this._startAnim=!1},setData:function(i,t){for(var e in i)i.hasOwnProperty(e)&&(this.keyList[e]=i[e]);this._startAnim||(this.zoomFactor=t||1,this.draw())},_deletePopup:function(){this._popup&&this._map.removeLayer(this._popup)}},ToJSEObject(ViaMichelin.Api.MMap.Module.Traffic.Layer.Events),JSEPackage("ViaMichelin.Api.StorageManager"),ViaMichelin.Api.StorageManager=function(i){i=i?i:{},this._method=i.method?i.method:"LOCAL_STORAGE"},ViaMichelin.Api.StorageManager.prototype={_method:null,setItem:function(i,t){return ViaMichelin.Api.Util.Browser.localStorage?(window.localStorage.setItem(i,t),!0):!1},getItem:function(i){return ViaMichelin.Api.Util.Browser.localStorage?window.localStorage[i]:""},removeItem:function(i){return ViaMichelin.Api.Util.Browser.localStorage?(window.localStorage.removeItem(i),!0):!1},toString:function(){return"[ViaMichelin.Api.StorageManager]"}},ToJSEObject(ViaMichelin.Api.StorageManager),JSEPackage("ViaMichelin.Api.Util.Animation"),JSEImportApi("ViaMichelin.Api.Util.HTML"),ViaMichelin.Api.Util.Animation=function(){},ViaMichelin.Api.Util.Animation.prototype={bodyStyle:document.body.style,cssPrefix:function(i){if(!i)return"";var t,e;if(i.indexOf("-")>=0){var n=(""+i).split("-");for(t=1,e=n.length;e>t;t++)n[t]=n[t].substr(0,1).toUpperCase()+n[t].substr(1);i=n.join("")}if(i in ViaMichelin.Api.Util.Animation.prototype.bodyStyle)return i;i=i.substr(0,1).toUpperCase()+i.substr(1);var o=["webkit","Moz","ms","O"];for(t=0,e=o.length;e>t;t++)if(o[t]+i in ViaMichelin.Api.Util.Animation.prototype.bodyStyle)return o[t]+i;return""},rotation:function(i,t){for(var e=[],n=(function(){var i=function(){var i=["","-webkit-","-moz-"];return function(t,e){var n,o;for(n=0;n<i.length;n++)if(o=i[n]+t,o in document.body.style)return e?i[n]:o;return null}}(),t=function(i,t){i.className+=" throbbage-"+t},e=function(i,t){i.style.visibility=t?"visible":"hidden"},n=function(i){var n=document.createElement("b"),o=i.style,a=n.style;return o.position="relative",a.position="absolute",t(i,"container"),e(n,!1),i.appendChild(n),n},o=function(t,n,o){var a=document.styleSheets[document.styleSheets.length-1],r=i("transform"),s=i("animation"),l=n.style;return l.left=0,l.top="50%",l.marginTop=-n.offsetHeight/2+"px",a.insertRule("@"+i("animation",!0)+"keyframes throbbage-spin { from { "+r+": rotateZ(0); } to {"+r+": rotateZ(-360deg);} }",a.cssRules.length),l[s]="throbbage-spin "+o+"ms infinite linear",l[i("transform-origin")]=t.offsetWidth/2+"px",{play:function(){e(n,!0)},pause:function(){e(n,!1)}}},a=function(i,t,n){var o=0,a=(i.offsetWidth-t.offsetWidth)/2,r=a,s=Date.now(),l=null,h=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(i){window.setTimeout(i,0)}}(),c=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}();return{play:function(){var i=2*Math.PI;e(t,!0),function c(){var e=t.style,p=r+Math.cos(o)*a,u=r+Math.sin(o)*a;o+=i/n*(+new Date-s),o%=i,e.left=p+"px",e.top=u+"px",s=+new Date,l=h(c)}()},pause:function(){c(l),e(t,!1)}}},r=function(t,e){var r=n(t),s=!!i("animation");return s?o(t,r,e):a(t,r,e)};return r}()),o=0;o<i.length;o++)e.push(new n(i[o],t));return{play:function(){for(var i=0;i<e.length;i++)e[i].play()},pause:function(){for(var i=0;i<e.length;i++)e[i].pause()}}},transition:function(i,t,e){function n(i){var t=/-([a-z])/gi;return i.replace(t,function(i,t){return 0!==t?t.toUpperCase():i})}function o(i,t){for(var e=0;e<t.length;e++){var o=n(t[e].property);i.style[o]="opacity"===o?t[e].value:t[e].value+"px"}}if(!i)return void e();var a=ViaMichelin.Api.Util.Animation.prototype.cssPrefix("transition"),r={transition:"transitionend",webkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd"}[a];if(r){for(var s=ViaMichelin.Api.Util.HTML.styleSupport("transition"),l=[],h=0;h<t.length;h++){var c=t[h];l.push(c.property+" "+c.duration+"s "+c.timingFunction)}i.style[s]=l.join(",");var p=function(){i.style[s]="",e(),i.removeEventListener(r,p)};i.addEventListener(r,p,!1),o(i,t)}else o(i,t),e()},toString:function(){return"[ViaMichelin.Api.Util.Animation]"}},ToJSEObject(ViaMichelin.Api.Util.Animation),JSEPackage("ViaMichelin.Api.Util.Browser"),ViaMichelin.Api.Util.Browser={},function(){var i=navigator.userAgent.toLowerCase(),t=document.documentElement,e="ActiveXObject"in window,n=-1!==i.indexOf("webkit"),o=-1!==i.indexOf("phantom"),a=-1!==i.search("android [23]"),r=-1!==i.indexOf("chrome"),s="undefined"!=typeof window.orientation,l=navigator.msPointerEnabled&&navigator.msMaxTouchPoints&&!window.PointerEvent,h=window.PointerEvent&&navigator.pointerEnabled&&navigator.maxTouchPoints||l,c=e&&"transition"in t.style,p="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!a,u="MozPerspective"in t.style,M="OTransition"in t.style,m="devicePixelRatio"in window&&window.devicePixelRatio>1;
if(!m&&"matchMedia"in window){var d=window.matchMedia("(min-resolution:144dpi)");m=d&&d.matches}var _=!window.L_NO_TOUCH&&!o&&(h||"ontouchstart"in t||window.DocumentTouch&&document instanceof window.DocumentTouch);ViaMichelin.Api.Util.Browser={ie:e,ielt9:e&&!document.addEventListener,webkit:n,gecko:-1!==i.indexOf("gecko")&&!n&&!window.opera&&!e,android:-1!==i.indexOf("android"),android23:a,chrome:r,ie3d:c,webkit3d:p,gecko3d:u,opera3d:M,any3d:!window.L_DISABLE_3D&&(c||p||u||M)&&!o,mobile:s,mobileWebkit:s&&n,mobileWebkit3d:s&&p,mobileOpera:s&&window.opera,touch:!!_,msPointer:!!l,pointer:!!h,retina:!!m,isHttps:function(){return-1!=window.location.protocol.indexOf("https")}}}(),ViaMichelin.Api.Util.Browser.svg=!(!document.createElementNS||!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect),ViaMichelin.Api.Util.Browser.vml=function(){if(ViaMichelin.Api.Util.Browser.svg)return!1;try{var i=document.createElement("div");i.innerHTML='<v:shape adj="1"/>';var t=i.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"==typeof t.adj}catch(e){return!1}}(),ViaMichelin.Api.Util.Browser.canvas=function(){return!!document.createElement("canvas").getContext}(),ViaMichelin.Api.Util.Browser.localStorage=function(){try{var i="apiTest",t=window.localStorage;return t.setItem(i,"1"),t.removeItem(i),!0}catch(e){return!1}}(),ViaMichelin.Api.Util.Browser.ieversion=function(){if("undefined"!=typeof window&&window.ActiveXObject&&!window.opera&&/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var i=Number(RegExp.$1);if(i>=8)return i;if(i>=7)return 7;if(i>=6)return 6}return 0}(),ToJSEObject(ViaMichelin.Api.Util.Browser),JSEPackage("ViaMichelin.Api.Util.Core"),ViaMichelin.Api.Util.Core={bind:function(i,t){var e=Array.prototype.slice;if(i.bind)return i.bind.apply(i,e.call(arguments,1));var n=e.call(arguments,2);return function(){return i.apply(t,n.length?n.concat(e.call(arguments)):arguments)}},extend:function(i){var t,e,n,o;for(e=1,n=arguments.length;n>e;e++){o=arguments[e];for(t in o)o.hasOwnProperty(t)&&(i[t]=o[t])}return i},falseFn:function(){return!1},formatNum:function(i,t){var e=Math.pow(10,t||5);return Math.round(i*e)/e},invokeEach:function(i,t,e){var n,o;if("object"==typeof i){o=Array.prototype.slice.call(arguments,3);for(n in i)t.apply(e,[n,i[n]].concat(o));return!0}return!1},isArray:Array.isArray||function(i){return"[object Array]"===Object.prototype.toString.call(i)},lpad:function(i,t,e){for(;i.length<e;)i=t+i;return i},throttle:function(i,t,e){var n,o,a,r;return r=function(){n=!1,o&&(a.apply(e,o),o=!1)},a=function(){n?o=arguments:(i.apply(e,arguments),setTimeout(r,t),n=!0)}},stamp:function(){var i=0,t="_mmap_id";return function(e){return e[t]=e[t]||++i,e[t]}}(),trim:function(i){return i.trim?i.trim():i.replace(/^\s+|\s+$/g,"")},splitWords:function(i){return this.trim(i).split(/\s+/)},getParamString:function(i,t,e){var n=[];for(var o in i)i.hasOwnProperty(o)&&n.push(encodeURIComponent(e?o.toUpperCase():o)+"="+encodeURIComponent(i[o]));return(t&&-1!==t.indexOf("?")?"&":"?")+n.join("&")},template:function(i,t){return i.replace(ViaMichelin.Api.Util.Core.templateRe,function(i,e){var n=t[e];if(void 0===n)throw new Error("No value provided for variable "+i);return"function"==typeof n&&(n=n(t)),n})},templateRe:/\{ *([\w_]+) *\}/g,wrapNum:function(i,t,e){var n=t[1],o=t[0],a=n-o;return i===n&&e?i:((i-o)%a+a)%a+o},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function i(i){return window["webkit"+i]||window["moz"+i]||window["ms"+i]}function t(i){var t=+new Date,n=Math.max(0,16-(t-e));return e=t+n,window.setTimeout(i,n)}if("undefined"!=typeof window){var e=0,n=window.requestAnimationFrame||i("RequestAnimationFrame")||t,o=window.cancelAnimationFrame||i("CancelAnimationFrame")||i("CancelRequestAnimationFrame")||function(i){window.clearTimeout(i)};ViaMichelin.Api.Util.Core.requestAnimFrame=function(i,e,o){return o&&n===t?void i.call(e):n.call(window,ViaMichelin.Api.Util.Core.bind(i,e))},ViaMichelin.Api.Util.Core.cancelAnimFrame=function(i){i&&o.call(window,i)}}}(),ToJSEObject(ViaMichelin.Api.Util.Core),JSEPackage("ViaMichelin.Api.Util.Css"),ViaMichelin.Api.Util.Css={loadedCss:[],generateUrlCss:function(i,t,e){var n,o=[],a="";return a=t?i+"V"+t+".css":i+".css",n=ViaMichelin.Api.Constants.System.ApiCssRoot+"all/"+a,o.push(n),e&&(n="",ViaMichelin.Api.Util.Css.getVersionIECSS()&&e.ie&&(n=ViaMichelin.Api.Constants.System.ApiCssRoot+"ie/"+a),6==ViaMichelin.Api.Util.Css.getVersionIECSS()&&e.ie6&&(n=ViaMichelin.Api.Constants.System.ApiCssRoot+"ie6/"+a),7==ViaMichelin.Api.Util.Css.getVersionIECSS()&&e.ie7&&(n=ViaMichelin.Api.Constants.System.ApiCssRoot+"ie7/"+a),8==ViaMichelin.Api.Util.Css.getVersionIECSS()&&e.ie8&&(n=ViaMichelin.Api.Constants.System.ApiCssRoot+"ie8/"+a),n&&o.push(n)),o},getVersionIECSS:function(){if("undefined"!=typeof window&&window.ActiveXObject&&!window.opera&&/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var i=Number(RegExp.$1);if(i>=9)return 9;if(i>=8)return 8;if(i>=7)return 7;if(i>=6)return 6}return 0},isDefinedSelector:function(i,t,e){var n,o=document.createElement("div"),a=null;return o.className=i,document.body.appendChild(o),t=t?t:"display",e=e?e:"none",o.currentStyle?(a=o,n=a.currentStyle[t]===e):window.getComputedStyle?(a=window.getComputedStyle(o,null),n=a.getPropertyValue(t)===e):document.defaultView&&document.defaultView.getComputedStyle?(a=document.defaultView.getComputedStyle(o,null),n=a.getPropertyValue(t)===e):n=!1,document.body.removeChild(o),n},isIE6CSS:function(){return 6==ViaMichelin.Api.Util.Css.getVersionIECSS()?!0:!1},isIE7CSS:function(){return 7==ViaMichelin.Api.Util.Css.getVersionIECSS()?!0:!1},isIE8CSS:function(){return 8==ViaMichelin.Api.Util.Css.getVersionIECSS()?!0:!1},loadCss:function(i,t,e){if("undefined"!=typeof document){var n=ViaMichelin.Api.Util.Css.isDefinedSelector("is"+i+"Imported"),o=$isDefined(ViaMichelin.Api.Util.Css.loadedCss[i]);if(n||o)return!1;for(var a=0;a<t.length;a++){var r=t[a],s=document.createElement("link");if(s.type="text/css",s.rel="stylesheet",s.href=r,"undefined"!=typeof e)for(var l in e)s[l]=e[l];var h=document.getElementsByTagName("head")[0];h.appendChild(s)}return ViaMichelin.Api.Util.Css.loadedCss[i]=!0,!0}return!1}},ToJSEObject(ViaMichelin.Api.Util.Css),JSEPackage("ViaMichelin.Api.Util.Dom"),ViaMichelin.Api.Util.Dom={get:function(i){return"string"==typeof i?document.getElementById(i):i},getStyle:function(i,t){var e=i.style[t]||i.currentStyle&&i.currentStyle[t];if((!e||"auto"===e)&&document.defaultView){var n=document.defaultView.getComputedStyle(i,null);e=n?n[t]:null}return"auto"===e?null:e},create:function(i,t,e){var n=document.createElement(i);return n.className=t,e&&e.appendChild(n),n},createCompatibleFieldElement:function(i,t){var e,n,o;try{o="";for(n in t)o+="htmlFor"===n?" for="+t[n]:" "+n+"="+t[n];e=document.createElement("<"+i+o+" >")}catch(a){e=document.createElement(i);for(n in t)e[n]=t[n]}return e},remove:function(i){var t=i.parentNode;t&&t.removeChild(i)},empty:function(i){for(;i.firstChild;)i.removeChild(i.firstChild)},toFront:function(i){i.parentNode.appendChild(i)},toBack:function(i){var t=i.parentNode;t.insertBefore(i,t.firstChild)},addClass:function(i,t){if(void 0!==i.classList)for(var e=ViaMichelin.Api.Util.Core.splitWords(t),n=0,o=e.length;o>n;n++)i.classList.add(e[n]);else if(!ViaMichelin.Api.Util.Dom.hasClass(i,t)){var a=ViaMichelin.Api.Util.Dom.getClass(i);ViaMichelin.Api.Util.Dom.setClass(i,(a?a+" ":"")+t)}},getClass:function(i){return void 0===i.className.baseVal?i.className:i.className.baseVal},hasClass:function(i,t){if(void 0!==i.classList)return i.classList.contains(t);var e=ViaMichelin.Api.Util.Dom.getClass(i);return e.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(e)},removeClass:function(i,t){void 0!==i.classList?i.classList.remove(t):ViaMichelin.Api.Util.Dom.setClass(i,ViaMichelin.Api.Util.Core.trim((" "+ViaMichelin.Api.Util.Dom.getClass(i)+" ").replace(" "+t+" "," ")))},setClass:function(i,t){void 0===i.className.baseVal?i.className=t:i.className.baseVal=t},getViewportOffset:function(i){var t,e=0,n=0,o=i,a=document.body,r=document.documentElement;do{if(e+=o.offsetTop||0,n+=o.offsetLeft||0,e+=parseInt(ViaMichelin.Api.Util.Dom.getStyle(o,"borderTopWidth"),10)||0,n+=parseInt(ViaMichelin.Api.Util.Dom.getStyle(o,"borderLeftWidth"),10)||0,t=ViaMichelin.Api.Util.Dom.getStyle(o,"position"),o.offsetParent===a&&"absolute"===t)break;if("fixed"===t){e+=a.scrollTop||r.scrollTop||0,n+=a.scrollLeft||r.scrollLeft||0;break}if("relative"===t&&!o.offsetLeft){var s=ViaMichelin.Api.Util.Dom.getStyle(o,"width"),l=ViaMichelin.Api.Util.Dom.getStyle(o,"max-width"),h=o.getBoundingClientRect();("none"!==s||"none"!==l)&&(n+=h.left+o.clientLeft),e+=h.top+(a.scrollTop||r.scrollTop||0);break}o=o.offsetParent}while(o);o=i;do{if(o===a)break;e-=o.scrollTop||0,n-=o.scrollLeft||0,o=o.parentNode}while(o);return new ViaMichelin.Api.MMap.Core.Geometry.Point(n,e)},documentIsLtr:function(){return ViaMichelin.Api.Util.Dom._docIsLtr=ViaMichelin.Api.Util.Dom._docIsLtr||"ltr"===ViaMichelin.Api.Util.Dom.getStyle(document.body,"direction"),ViaMichelin.Api.Util.Dom._docIsLtr},getTranslateString:function(i){var t=ViaMichelin.Api.Util.Browser.webkit3d;return"translate"+(t?"3d(":"(")+i.x+"px,"+i.y+"px"+(t?",0)":")")},getScaleString:function(i,t){return ViaMichelin.Api.Util.Dom.getTranslateString(t.multiplyBy(1-i))+" scale("+i+") "},setPosition:function(i,t,e){i._mmap_pos=t,!e&&ViaMichelin.Api.Util.Browser.any3d?i.style[ViaMichelin.Api.Util.Dom.TRANSFORM]=ViaMichelin.Api.Util.Dom.getTranslateString(t):(i.style.left=t.x+"px",i.style.top=t.y+"px")},getPosition:function(i){return i._mmap_pos},setOpacity:function(i,t){if("opacity"in i.style)i.style.opacity=t;else if("filter"in i.style){var e=!1,n="DXImageTransform.Microsoft.Alpha";try{e=i.filters.item(n)}catch(o){if(1===t)return}t=Math.round(100*t),e?(e.Enabled=100!==t,e.Opacity=t):i.style.filter+=" progid:"+n+"(opacity="+t+")"}},testProp:function(i){for(var t=document.documentElement.style,e=0;e<i.length;e++)if(i[e]in t)return i[e];return!1},setTransform:function(i,t,e){var n=t||new ViaMichelin.Api.MMap.Core.Geometry.Point(0,0);i.style[ViaMichelin.Api.Util.Dom.TRANSFORM]="translate3d("+n.x+"px,"+n.y+"px,0)"+(e?" scale("+e+")":"")}},function(){ViaMichelin.Api.Util.Dom.TRANSFORM=ViaMichelin.Api.Util.Dom.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]);var i=ViaMichelin.Api.Util.Dom.TRANSITION=ViaMichelin.Api.Util.Dom.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);if(ViaMichelin.Api.Util.Dom.TRANSITION_END="webkitTransition"===i||"OTransition"===i?i+"End":"transitionend","onselectstart"in document)ViaMichelin.Api.Util.Dom.disableTextSelection=function(){ViaMichelin.Api.Util.DomEvent.on(window,"selectstart",ViaMichelin.Api.Util.DomEvent.preventDefault)},ViaMichelin.Api.Util.Dom.enableTextSelection=function(){ViaMichelin.Api.Util.DomEvent.off(window,"selectstart",ViaMichelin.Api.Util.DomEvent.preventDefault)};else{var t=ViaMichelin.Api.Util.Dom.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ViaMichelin.Api.Util.Dom.disableTextSelection=function(){if(t){var i=document.documentElement.style;this._userSelect=i[t],i[t]="none"}},ViaMichelin.Api.Util.Dom.enableTextSelection=function(){t&&(document.documentElement.style[t]=this._userSelect,delete this._userSelect)}}ViaMichelin.Api.Util.Dom.disableImageDrag=function(){ViaMichelin.Api.Util.DomEvent.on(window,"dragstart",ViaMichelin.Api.Util.DomEvent.preventDefault)},ViaMichelin.Api.Util.Dom.enableImageDrag=function(){ViaMichelin.Api.Util.DomEvent.off(window,"dragstart",ViaMichelin.Api.Util.DomEvent.preventDefault)}}(),ToJSEObject(ViaMichelin.Api.Util.Dom),JSEPackage("ViaMichelin.Api.Util.DomEvent"),ViaMichelin.Api.Util.DomEvent={eventsKey:"_mmap_events",on:function(i,t,e,n){if("object"==typeof t)for(var o in t)this._on(i,o,t[o],e);else{t=ViaMichelin.Api.Util.Core.splitWords(t);for(var a=0,r=t.length;r>a;a++)this._on(i,t[a],e,n)}return this},off:function(i,t,e,n){if("object"==typeof t)for(var o in t)this._off(i,o,t[o],e);else{t=ViaMichelin.Api.Util.Core.splitWords(t);for(var a=0,r=t.length;r>a;a++)this._off(i,t[a],e,n)}return this},_on:function(i,t,e,n){var o=t+ViaMichelin.Api.Util.Core.stamp(e)+(n?"_"+ViaMichelin.Api.Util.Core.stamp(n):"");if(i[this.eventsKey]&&i[this.eventsKey][o])return this;var a=function(t){return e.call(n||i,t||window.event)},r=a;return ViaMichelin.Api.Util.Browser.pointer&&0===t.indexOf("touch")?this.addPointerListener(i,t,a,o):ViaMichelin.Api.Util.Browser.touch&&"dblclick"===t&&this.addDoubleTapListener?this.addDoubleTapListener(i,a,o):"addEventListener"in i?"mousewheel"===t?(i.addEventListener("DOMMouseScroll",a,!1),i.addEventListener(t,a,!1)):"mouseenter"===t||"mouseleave"===t?(a=function(t){return t=t||window.event,ViaMichelin.Api.Util.DomEvent._checkMouse(i,t)?r(t):void 0},i.addEventListener("mouseenter"===t?"mouseover":"mouseout",a,!1)):("click"===t&&ViaMichelin.Api.Util.Browser.android&&(a=function(i){return ViaMichelin.Api.Util.DomEvent._filterClick(i,r)}),i.addEventListener(t,a,!1)):"attachEvent"in i&&i.attachEvent("on"+t,a),i[this.eventsKey]=i[this.eventsKey]||{},i[this.eventsKey][o]=a,this},_off:function(i,t,e,n){var o=t+ViaMichelin.Api.Util.Core.stamp(e)+(n?"_"+ViaMichelin.Api.Util.Core.stamp(n):""),a=i[this.eventsKey]&&i[this.eventsKey][o];return a?(ViaMichelin.Api.Util.Browser.pointer&&0===t.indexOf("touch")?this.removePointerListener(i,t,o):ViaMichelin.Api.Util.Browser.touch&&"dblclick"===t&&this.removeDoubleTapListener?this.removeDoubleTapListener(i,o):"removeEventListener"in i?"mousewheel"===t?(i.removeEventListener("DOMMouseScroll",a,!1),i.removeEventListener(t,a,!1)):i.removeEventListener("mouseenter"===t?"mouseover":"mouseleave"===t?"mouseout":t,a,!1):"detachEvent"in i&&i.detachEvent("on"+t,a),i[this.eventsKey][o]=null,this):this},stopPropagation:function(i){return i.stopPropagation?i.stopPropagation():i.cancelBubble=!0,ViaMichelin.Api.Util.DomEvent._skipped(i),this},disableScrollPropagation:function(i){return ViaMichelin.Api.Util.DomEvent.on(i,"mousewheel MozMousePixelScroll",ViaMichelin.Api.Util.DomEvent.stopPropagation)},disableClickPropagation:function(i){var t=ViaMichelin.Api.Util.DomEvent.stopPropagation;return ViaMichelin.Api.Util.DomEvent.on(i,ViaMichelin.Api.MMap.Core.Dom.Draggable.prototype.START().join(" "),t),ViaMichelin.Api.Util.DomEvent.on(i,{click:ViaMichelin.Api.Util.DomEvent._fakeStop,dblclick:t})},preventDefault:function(i){return i.preventDefault?i.preventDefault():i.returnValue=!1,this},stop:function(i){return ViaMichelin.Api.Util.DomEvent.preventDefault(i).stopPropagation(i)},getMousePosition:function(i,t){if(!t)return new ViaMichelin.Api.MMap.Core.Geometry.Point(i.clientX,i.clientY);var e=t.getBoundingClientRect();return new ViaMichelin.Api.MMap.Core.Geometry.Point(i.clientX-e.left-t.clientLeft,i.clientY-e.top-t.clientTop)},getWheelDelta:function(i){var t=0;return i.wheelDelta&&(t=i.wheelDelta/120),i.detail&&(t=-i.detail/3),t},_skipEvents:{},_fakeStop:function(i){ViaMichelin.Api.Util.DomEvent._skipEvents[i.type]=!0},_skipped:function(i){var t=this._skipEvents[i.type];return this._skipEvents[i.type]=!1,t},_checkMouse:function(i,t){var e=t.relatedTarget;if(!e)return!0;try{for(;e&&e!==i;)e=e.parentNode}catch(n){return!1}return e!==i},_filterClick:function(i,t){var e=i.timeStamp||i.originalEvent.timeStamp,n=ViaMichelin.Api.Util.DomEvent._lastClick&&e-ViaMichelin.Api.Util.DomEvent._lastClick;return n&&n>100&&500>n||i.target._simulatedClick&&!i._simulated?void ViaMichelin.Api.Util.DomEvent.stop(i):(ViaMichelin.Api.Util.DomEvent._lastClick=e,t(i))}},ViaMichelin.Api.Util.DomEvent.addListener=ViaMichelin.Api.Util.DomEvent.on,ViaMichelin.Api.Util.DomEvent.removeListener=ViaMichelin.Api.Util.DomEvent.off,ViaMichelin.Api.Util.DomEvent.DoubleTap={},ViaMichelin.Api.Util.DomEvent.DoubleTap.prototype={_touchStart:function(){return ViaMichelin.Api.Util.Browser.msPointer?"MSPointerDown":ViaMichelin.Api.Util.Browser.pointer?"pointerdown":"touchstart"},_touchEnd:function(){return ViaMichelin.Api.Util.Browser.msPointer?"MSPointerUp":ViaMichelin.Api.Util.Browser.pointer?"pointerup":"touchend"},addDoubleTapListener:function(i,t,e){function n(i){var t;if(ViaMichelin.Api.Util.Browser.pointer?(h.push(i.pointerId),t=h.length):t=i.touches.length,!(t>1)){var e=Date.now(),n=e-(a||e);r=i.touches?i.touches[0]:i,s=n>0&&l>=n,a=e}}function o(i){if(ViaMichelin.Api.Util.Browser.pointer){var e=h.indexOf(i.pointerId);if(-1===e)return;h.splice(e,1)}if(s){if(ViaMichelin.Api.Util.Browser.pointer){var n,o,l={};for(o in r)n=r[o],l[o]=n&&n.bind?n.bind(r):n;r=l}r.type="dblclick",t(r),a=null}}var a,r,s=!1,l=250,h=[],c="_mmap_",p=ViaMichelin.Api.Util.DomEvent._touchStart(),u=ViaMichelin.Api.Util.DomEvent._touchEnd();i[c+p+e]=n,i[c+u+e]=o;var M=ViaMichelin.Api.Util.Browser.pointer?document.documentElement:i;return i.addEventListener(p,n,!1),M.addEventListener(u,o,!1),ViaMichelin.Api.Util.Browser.pointer&&M.addEventListener(ViaMichelin.Api.Util.DomEvent.POINTER_CANCEL(),o,!1),this},removeDoubleTapListener:function(i,t){var e="_mmap_",n=ViaMichelin.Api.Util.DomEvent._touchStart(),o=ViaMichelin.Api.Util.DomEvent._touchEnd(),a=ViaMichelin.Api.Util.Browser.pointer?document.documentElement:i,r=i[e+o+t];return i.removeEventListener(n,i[e+n+t],!1),a.removeEventListener(o,r,!1),ViaMichelin.Api.Util.Browser.pointer&&a.removeEventListener(ViaMichelin.Api.Util.DomEvent.POINTER_CANCEL(),r,!1),this}},JSE.extend(ViaMichelin.Api.Util.DomEvent,ViaMichelin.Api.Util.DomEvent.DoubleTap),ViaMichelin.Api.Util.DomEvent.Pointer={},ViaMichelin.Api.Util.DomEvent.Pointer.prototype={_pointers:{},POINTER_DOWN:function(){return ViaMichelin.Api.Util.Browser.msPointer?"MSPointerDown":"pointerdown"},POINTER_MOVE:function(){return ViaMichelin.Api.Util.Browser.msPointer?"MSPointerMove":"pointermove"},POINTER_UP:function(){return ViaMichelin.Api.Util.Browser.msPointer?"MSPointerUp":"pointerup"},POINTER_CANCEL:function(){return ViaMichelin.Api.Util.Browser.msPointer?"MSPointerCancel":"pointercancel"},addPointerListener:function(i,t,e,n){return"touchstart"===t?this._addPointerStart(i,e,n):"touchmove"===t?this._addPointerMove(i,e,n):"touchend"===t&&this._addPointerEnd(i,e,n),this},removePointerListener:function(i,t,e){var n=i["_mmap_"+t+e];return"touchstart"===t?i.removeEventListener(this.POINTER_DOWN(),n,!1):"touchmove"===t?i.removeEventListener(this.POINTER_MOVE(),n,!1):"touchend"===t&&(i.removeEventListener(this.POINTER_UP(),n,!1),i.removeEventListener(this.POINTER_CANCEL(),n,!1)),this},_addPointerStart:function(i,t,e){var n=ViaMichelin.Api.Util.Core.bind(function(i){ViaMichelin.Api.Util.DomEvent.preventDefault(i),this._pointers[i.pointerId]=i,this._handlePointer(i,t)},this);if(i["_mmap_touchstart"+e]=n,i.addEventListener(this.POINTER_DOWN(),n,!1),!this._pointerDocListener){var o=ViaMichelin.Api.Util.Core.bind(function(i){delete this._pointers[i.pointerId]},this);document.documentElement.addEventListener(this.POINTER_UP(),o,!1),document.documentElement.addEventListener(this.POINTER_CANCEL(),o,!1),this._pointerDocListener=!0}},_handlePointer:function(i,t){i.touches=[];for(var e in this._pointers)i.touches.push(this._pointers[e]);i.changedTouches=[i],t(i)},_addPointerMove:function(i,t,e){var n=ViaMichelin.Api.Util.Core.bind(function(i){(i.pointerType!==i.MSPOINTER_TYPE_MOUSE&&"mouse"!==i.pointerType||0!==i.buttons)&&(this._pointers[i.pointerId]=i,this._handlePointer(i,t))},this);i["_mmap_touchmove"+e]=n,i.addEventListener(this.POINTER_MOVE(),n,!1)},_addPointerEnd:function(i,t,e){var n=ViaMichelin.Api.Util.Core.bind(function(i){delete this._pointers[i.pointerId],this._handlePointer(i,t)},this);i["_mmap_touchend"+e]=n,i.addEventListener(this.POINTER_UP(),n,!1),i.addEventListener(this.POINTER_CANCEL(),n,!1)}},JSE.extend(ViaMichelin.Api.Util.DomEvent,ViaMichelin.Api.Util.DomEvent.Pointer),ToJSEObject(ViaMichelin.Api.Util.DomEvent),JSEPackage("ViaMichelin.Api.Util.Http"),ViaMichelin.Api.Util.Http={protocolAdapter:function(i){var t;return i&&"string"==typeof i?(t=-1==i.indexOf("?")?"?":"&",-1!=this.get_current_location().indexOf("https")&&-1==i.indexOf("https")?i.replace("http://","https://")+t+"protocol=https":0===i.indexOf("https")?i+t+"protocol=https":i):i},get_current_location:function(){return window.location.protocol},toString:function(){return"[ViaMichelin.Api.Util.Http]"}},ToJSEObject(ViaMichelin.Api.Util.Http),JSEPackage("ViaMichelin.Api.Util.Object"),ViaMichelin.Api.Util.Object={clone:function(i){var t;if(null==i||"object"!=typeof i)return i;if(i instanceof Date)return t=new Date,t.setTime(i.getTime()),t;if(i instanceof Array){t=[];for(var e=0,n=i.length;n>e;e++)t[e]=ViaMichelin.Api.Util.Object.clone(i[e]);return t}if(i instanceof Object){t={};for(var o in i)i.hasOwnProperty(o)&&(t[o]=ViaMichelin.Api.Util.Object.clone(i[o]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")},extend:function(i,t){var e=null;if("function"!=typeof t&&(e=t),t.prototype&&(e=t.prototype),null!=e){var n;for(n in e)i[n]||(i[n]=e[n])}if("function"==typeof t){if(t.prototype&&t.prototype.options){var o=ViaMichelin.Api.Util.Object.clone(t.prototype.options),a=ViaMichelin.Api.Util.Object.clone(i.options);i.options={},i.options=o,ViaMichelin.Api.Util.Object.mixAttributes(i.options,a)}1==arguments.length?t.call(i):t.apply(i,Array.prototype.slice.apply(arguments,[2]))}},mixAttributes:function(i,t){if($isNotEmpty(t))for(var e in t)if(t[e]instanceof Object&&!$isDomElement(t[e]))if($isDefined(i[e]))if(t[e]instanceof Array)i[e]=t[e].slice(0);else{$isNotEmpty(i[e])||(i[e]={});for(var n in t[e])i[e][n]=t[e][n]}else i[e]=t[e];else i[e]=t[e]},setOptions:function(i,t){i.options?this.mixAttributes(i.options,t):i.options=t}},ToJSEObject(ViaMichelin.Api.Util.Object),JSEPackage("ViaMichelin.Api.Util.TaskRunner"),ViaMichelin.Api.Util.TaskRunner=function(){this._state=this.STATE_PENDING},ViaMichelin.Api.Util.TaskRunner.prototype={STATE_IN_PROGRESS:"state in progress",STATE_END:"state end",STATE_PENDING:"state pending",_state:"",_workQueue:[],error:function(i){this._state=this.STATE_END,this.stimulate("error",i)},push:function(i){this._workQueue.push(i)},run:function(){function i(){e._state===e.STATE_IN_PROGRESS&&(e._workQueue.shift(),e.run())}function t(i){e._workQueue=[],e.stimulate("error",i)}var e=this;this._state===this.STATE_PENDING&&(this._state=this.STATE_IN_PROGRESS),this._workQueue.length>0?this._workQueue[0](i,t):(this._state=this.STATE_END,this.stimulate("end"))},stop:function(){this._state=this.STATE_END,this._workQueue=[],this.stimulate("end")},toString:function(){return"[ViaMichelin.Api.Util.TaskRunner]"}},ToJSEObject(ViaMichelin.Api.Util.TaskRunner);